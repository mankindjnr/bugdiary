{"payload":{"allShortcutsEnabled":false,"fileTree":{"":{"items":[{"name":"alxinter.md","path":"alxinter.md","contentType":"file"},{"name":"fastapi.md","path":"fastapi.md","contentType":"file"},{"name":"git","path":"git","contentType":"file"}],"totalCount":3}},"fileTreeProcessingTime":1.330232,"foldersToFetch":[],"reducedMotionEnabled":null,"repo":{"id":716924449,"defaultBranch":"main","name":"markdown-blog","ownerLogin":"mankindjnr","currentUserCanPush":false,"isFork":false,"isEmpty":false,"createdAt":"2023-11-10T06:55:39.000Z","ownerAvatar":"https://avatars.githubusercontent.com/u/109144534?v=4","public":true,"private":false,"isOrgOwned":false},"symbolsExpanded":false,"treeExpanded":true,"refInfo":{"name":"main","listCacheKey":"v0:1699599775.0","canEdit":false,"refType":"branch","currentOid":"2d38485205f4c72258a04e54b47979e5713959e1"},"path":"fastapi.md","currentUser":null,"blob":{"rawLines":null,"stylingDirectives":null,"csv":null,"csvError":null,"dependabotInfo":{"showConfigurationBanner":false,"configFilePath":null,"networkDependabotPath":"/mankindjnr/markdown-blog/network/updates","dismissConfigurationNoticePath":"/settings/dismiss-notice/dependabot_configuration_notice","configurationNoticeDismissed":null,"repoAlertsPath":"/mankindjnr/markdown-blog/security/dependabot","repoSecurityAndAnalysisPath":"/mankindjnr/markdown-blog/settings/security_analysis","repoOwnerIsOrg":false,"currentUserCanAdminRepo":false},"displayName":"fastapi.md","displayUrl":"https://github.com/mankindjnr/markdown-blog/blob/main/fastapi.md?raw=true","headerInfo":{"blobSize":"47.8 KB","deleteInfo":{"deleteTooltip":"You must be signed in to make or propose changes"},"editInfo":{"editTooltip":"You must be signed in to make or propose changes"},"ghDesktopPath":"https://desktop.github.com","gitLfsPath":null,"onBranch":true,"shortPath":"e9cb9b6","siteNavLoginPath":"/login?return_to=https%3A%2F%2Fgithub.com%2Fmankindjnr%2Fmarkdown-blog%2Fblob%2Fmain%2Ffastapi.md","isCSV":false,"isRichtext":true,"toc":[{"level":1,"text":"API DEVELOPMENT WITH FASTAPI","anchor":"api-development-with-fastapi","htmlText":"API DEVELOPMENT WITH FASTAPI"},{"level":2,"text":"INSTALLATION","anchor":"installation","htmlText":"INSTALLATION"},{"level":2,"text":"Introduction","anchor":"introduction","htmlText":"Introduction"},{"level":3,"text":"starting the server","anchor":"starting-the-server","htmlText":"starting the server"},{"level":3,"text":"TESTING","anchor":"testing","htmlText":"TESTING"},{"level":2,"text":"POST REQUESTS","anchor":"post-requests","htmlText":"POST REQUESTS"},{"level":2,"text":"SCHEMA","anchor":"schema","htmlText":"SCHEMA"},{"level":3,"text":"OPTIONAL FIELDS","anchor":"optional-fields","htmlText":"OPTIONAL FIELDS"},{"level":2,"text":"CRUD OPERATIONS","anchor":"crud-operations","htmlText":"CRUD OPERATIONS"},{"level":3,"text":"creating and retrieving","anchor":"creating-and-retrieving","htmlText":"creating and retrieving"},{"level":3,"text":"DELETING","anchor":"deleting","htmlText":"DELETING"},{"level":3,"text":"UPDATING","anchor":"updating","htmlText":"UPDATING"},{"level":2,"text":"STRUCTURE","anchor":"structure","htmlText":"STRUCTURE"},{"level":1,"text":"DATABASE","anchor":"database","htmlText":"DATABASE"},{"level":3,"text":"POSTGRES","anchor":"postgres","htmlText":"POSTGRES"},{"level":3,"text":"accessing the postgres db from our python file","anchor":"accessing-the-postgres-db-from-our-python-file","htmlText":"accessing the postgres db from our python file"},{"level":3,"text":"retrieving all data from the database","anchor":"retrieving-all-data-from-the-database","htmlText":"retrieving all data from the database"},{"level":3,"text":"retrieving a single item from the database","anchor":"retrieving-a-single-item-from-the-database","htmlText":"retrieving a single item from the database"},{"level":3,"text":"inserting data into the database","anchor":"inserting-data-into-the-database","htmlText":"inserting data into the database"},{"level":3,"text":"DELETING DATA FROM THE DATABASE","anchor":"deleting-data-from-the-database","htmlText":"DELETING DATA FROM THE DATABASE"},{"level":3,"text":"UPDATING DATA IN THE DATABASE","anchor":"updating-data-in-the-database","htmlText":"UPDATING DATA IN THE DATABASE"},{"level":2,"text":"OBJECT RELATIONAL MAPPER (ORM)","anchor":"object-relational-mapper-orm","htmlText":"OBJECT RELATIONAL MAPPER (ORM)"},{"level":2,"text":"SQLALCHEMY","anchor":"sqlalchemy","htmlText":"SQLALCHEMY"},{"level":3,"text":"INSTALLATION","anchor":"installation-1","htmlText":"INSTALLATION"},{"level":3,"text":"Connecting to the database","anchor":"connecting-to-the-database","htmlText":"Connecting to the database"},{"level":3,"text":"testing if our connection worked","anchor":"testing-if-our-connection-worked","htmlText":"testing if our connection worked"},{"level":3,"text":"testing","anchor":"testing-1","htmlText":"testing"},{"level":3,"text":"retrieving all items with orm","anchor":"retrieving-all-items-with-orm","htmlText":"retrieving all items with orm"},{"level":3,"text":"creating a single item with orm","anchor":"creating-a-single-item-with-orm","htmlText":"creating a single item with orm"},{"level":3,"text":"retrieving a single item with orm","anchor":"retrieving-a-single-item-with-orm","htmlText":"retrieving a single item with orm"},{"level":3,"text":"Deleting a single item with orm","anchor":"deleting-a-single-item-with-orm","htmlText":"Deleting a single item with orm"},{"level":3,"text":"Updating a single item with orm","anchor":"updating-a-single-item-with-orm","htmlText":"Updating a single item with orm"},{"level":2,"text":"pydantic/schema model","anchor":"pydanticschema-model","htmlText":"pydantic/schema model"},{"level":2,"text":"sqlalchemy model","anchor":"sqlalchemy-model","htmlText":"sqlalchemy model"},{"level":3,"text":"separating the schemas","anchor":"separating-the-schemas","htmlText":"separating the schemas"},{"level":4,"text":"REASON","anchor":"reason","htmlText":"REASON"},{"level":3,"text":"A better way to structure multiple related schemas","anchor":"a-better-way-to-structure-multiple-related-schemas","htmlText":"A better way to structure multiple related schemas"},{"level":2,"text":"SENDING A RESPONSE BACK","anchor":"sending-a-response-back","htmlText":"SENDING A RESPONSE BACK"},{"level":1,"text":"USER FUNCTIONALITY","anchor":"user-functionality","htmlText":"USER FUNCTIONALITY"},{"level":2,"text":"Creating a User","anchor":"creating-a-user","htmlText":"Creating a User"},{"level":3,"text":"fetching user data","anchor":"fetching-user-data","htmlText":"fetching user data"},{"level":2,"text":"ROUTERS","anchor":"routers","htmlText":"ROUTERS"},{"level":3,"text":"STYLING THE DOCS SO THAT ALL ROUTES ARE SECTIONED ACCORDING TO THEIR ACTIONS","anchor":"styling-the-docs-so-that-all-routes-are-sectioned-according-to-their-actions","htmlText":"STYLING THE DOCS SO THAT ALL ROUTES ARE SECTIONED ACCORDING TO THEIR ACTIONS"},{"level":1,"text":"IMPORTANT SECTION","anchor":"important-section","htmlText":"IMPORTANT SECTION"},{"level":2,"text":"AUTHENTICATION","anchor":"authentication","htmlText":"AUTHENTICATION"},{"level":2,"text":"JWT TOKEN AUTHENTICATION","anchor":"jwt-token-authentication","htmlText":"JWT TOKEN AUTHENTICATION"},{"level":4,"text":"How it's used","anchor":"how-its-used","htmlText":"How it's used"},{"level":3,"text":"logging user","anchor":"logging-user","htmlText":"logging user"},{"level":3,"text":"implementing oauth2","anchor":"implementing-oauth2","htmlText":"implementing oauth2"},{"level":3,"text":"update to login route due to OAUTH2","anchor":"update-to-login-route-due-to-oauth2","htmlText":"update to login route due to OAUTH2"},{"level":3,"text":"verifying the token (its not tampered with and not expired)","anchor":"verifying-the-token-its-not-tampered-with-and-not-expired","htmlText":"verifying the token (its not tampered with and not expired)"},{"level":3,"text":"testing","anchor":"testing-2","htmlText":"testing"},{"level":2,"text":"POSTMAN","anchor":"postman","htmlText":"POSTMAN"},{"level":3,"text":"environment","anchor":"environment","htmlText":"environment"},{"level":3,"text":"env variables/access_token","anchor":"env-variablesaccess_token","htmlText":"env variables/access_token"},{"level":1,"text":"RELATIONSHIPS","anchor":"relationships","htmlText":"RELATIONSHIPS"},{"level":1,"text":"QUERY PARAMETERS","anchor":"query-parameters","htmlText":"QUERY PARAMETERS"},{"level":3,"text":"LIMIT","anchor":"limit","htmlText":"LIMIT"},{"level":3,"text":"SKIP/OFFSET","anchor":"skipoffset","htmlText":"SKIP/OFFSET"},{"level":3,"text":"search","anchor":"search","htmlText":"search"},{"level":3,"text":"using spaces in search","anchor":"using-spaces-in-search","htmlText":"using spaces in search"},{"level":1,"text":"VOTING SYSTEM","anchor":"voting-system","htmlText":"VOTING SYSTEM"},{"level":3,"text":"Composite Keys","anchor":"composite-keys","htmlText":"Composite Keys"},{"level":1,"text":"JOINS","anchor":"joins","htmlText":"JOINS"},{"level":3,"text":"counting in the route","anchor":"counting-in-the-route","htmlText":"counting in the route"},{"level":1,"text":"migrations with alembic","anchor":"migrations-with-alembic","htmlText":"migrations with alembic"},{"level":1,"text":"CORS","anchor":"cors","htmlText":"CORS"},{"level":1,"text":"DEPLOYING THE API","anchor":"deploying-the-api","htmlText":"DEPLOYING THE API"},{"level":1,"text":"DOCKERIZING OUR API","anchor":"dockerizing-our-api","htmlText":"DOCKERIZING OUR API"},{"level":2,"text":"BUILDING THE IMAGE","anchor":"building-the-image","htmlText":"BUILDING THE IMAGE"},{"level":3,"text":"docker compose | CONTAINERS","anchor":"docker-compose--containers","htmlText":"docker compose | CONTAINERS"},{"level":3,"text":"DATABASE SETUP IN A CONTAINER","anchor":"database-setup-in-a-container","htmlText":"DATABASE SETUP IN A CONTAINER"},{"level":1,"text":"REPOSITORY FOR IMAGES","anchor":"repository-for-images","htmlText":"REPOSITORY FOR IMAGES"}],"lineInfo":{"truncatedLoc":"1411","truncatedSloc":"1052"},"mode":"file"},"image":false,"isCodeownersFile":null,"isPlain":false,"isValidLegacyIssueTemplate":false,"issueTemplateHelpUrl":"https://docs.github.com/articles/about-issue-and-pull-request-templates","issueTemplate":null,"discussionTemplate":null,"language":"Markdown","languageID":222,"large":false,"loggedIn":false,"newDiscussionPath":"/mankindjnr/markdown-blog/discussions/new","newIssuePath":"/mankindjnr/markdown-blog/issues/new","planSupportInfo":{"repoIsFork":null,"repoOwnedByCurrentUser":null,"requestFullPath":"/mankindjnr/markdown-blog/blob/main/fastapi.md","showFreeOrgGatedFeatureMessage":null,"showPlanSupportBanner":null,"upgradeDataAttributes":null,"upgradePath":null},"publishBannersInfo":{"dismissActionNoticePath":"/settings/dismiss-notice/publish_action_from_dockerfile","dismissStackNoticePath":"/settings/dismiss-notice/publish_stack_from_file","releasePath":"/mankindjnr/markdown-blog/releases/new?marketplace=true","showPublishActionBanner":false,"showPublishStackBanner":false},"rawBlobUrl":"https://github.com/mankindjnr/markdown-blog/raw/main/fastapi.md","renderImageOrRaw":false,"richText":"<article class=\"markdown-body entry-content container-lg\" itemprop=\"text\"><h1 tabindex=\"-1\" id=\"user-content-api-development-with-fastapi\" dir=\"auto\"><a class=\"heading-link\" href=\"#api-development-with-fastapi\">API DEVELOPMENT WITH FASTAPI<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h1>\n<h2 tabindex=\"-1\" id=\"user-content-installation\" dir=\"auto\"><a class=\"heading-link\" href=\"#installation\">INSTALLATION<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h2>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"pip install fastapi[all]\"><pre>pip install fastapi[all]</pre></div>\n<p dir=\"auto\">With the all option, you will install even the optional dependancies that you may or may not need.</p>\n<h2 tabindex=\"-1\" id=\"user-content-introduction\" dir=\"auto\"><a class=\"heading-link\" href=\"#introduction\">Introduction<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h2>\n<p dir=\"auto\">FastAPI is a modern, fast (high-performance), web framework for building APIs with Python 3.6+ based on standard Python type hints.</p>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"from fastapi import FastAPI\n\napp = FastAPI()\n\n@app.get(&quot;/&quot;)\nasync def root():\n    return {&quot;message&quot;: &quot;Hello World&quot;}\"><pre><span class=\"pl-k\">from</span> <span class=\"pl-s1\">fastapi</span> <span class=\"pl-k\">import</span> <span class=\"pl-v\">FastAPI</span>\n\n<span class=\"pl-s1\">app</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">FastAPI</span>()\n\n<span class=\"pl-en\">@<span class=\"pl-s1\">app</span>.<span class=\"pl-en\">get</span>(<span class=\"pl-s\">\"/\"</span>)</span>\n<span class=\"pl-k\">async</span> <span class=\"pl-k\">def</span> <span class=\"pl-en\">root</span>():\n    <span class=\"pl-k\">return</span> {<span class=\"pl-s\">\"message\"</span>: <span class=\"pl-s\">\"Hello World\"</span>}</pre></div>\n<p dir=\"auto\"><strong>app</strong> is an instance of the class FastAPI. It is the main object of our application. It is the instance of the class that FastAPI() returns.</p>\n<p dir=\"auto\"><strong>async def root()</strong> this is normal python function, the async keyword is not mandatory and is used if you are going to make asynchronous calls inside the function, like querying a database or making an API call.</p>\n<p dir=\"auto\">removing the async keyword will not affect the functionality of the function.</p>\n<p dir=\"auto\"><strong>@app.get(\"/\")</strong> this is a decorator, it is used to add functionality to the function. In this case, it is used to add the path to the function. The path is the URL that will be used to access the function.</p>\n<h3 tabindex=\"-1\" id=\"user-content-starting-the-server\" dir=\"auto\"><a class=\"heading-link\" href=\"#starting-the-server\">starting the server<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"uvicorn main:app --reload\"><pre>uvicorn main:app --reload</pre></div>\n<p dir=\"auto\"><strong>--reload</strong> will only be needed on the development server.</p>\n<p dir=\"auto\"><strong>ORDER MATTERS</strong></p>\n<p dir=\"auto\">When you run an endpoint, fastapi goes through all the function from top down and picks the first path that matches your request. If you have two paths that match then the server will pick the first one and run with it.</p>\n<h3 tabindex=\"-1\" id=\"user-content-testing\" dir=\"auto\"><a class=\"heading-link\" href=\"#testing\">TESTING<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\">To test the application we will use postman. Postman is a tool that allows us to make API calls to our server.\nWe can also use the <strong>/docs</strong> or <strong>/redoc</strong> endpoint to test our application. This endpoint is automatically generated by fastapi and it allows us to test our application.</p>\n<p dir=\"auto\">When the api development is complete, we can create a frontend application that will consume the API. A pyhon client of some sort, This application will make <strong>requests</strong> to the server and the server will respond with the <strong>response</strong>.</p>\n<h2 tabindex=\"-1\" id=\"user-content-post-requests\" dir=\"auto\"><a class=\"heading-link\" href=\"#post-requests\">POST REQUESTS<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h2>\n<p dir=\"auto\">With a post request, we can send data to the server.</p>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"from fastapi.params import Body\n@app.post(&quot;/createpost&quot;)\ndef create_post(payload: dict = Body(...)):\n    print(payload)\n    return {&quot;message&quot;: &quot;Post created&quot;}\n\"><pre><span class=\"pl-k\">from</span> <span class=\"pl-s1\">fastapi</span>.<span class=\"pl-s1\">params</span> <span class=\"pl-k\">import</span> <span class=\"pl-v\">Body</span>\n<span class=\"pl-en\">@<span class=\"pl-s1\">app</span>.<span class=\"pl-en\">post</span>(<span class=\"pl-s\">\"/createpost\"</span>)</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">create_post</span>(<span class=\"pl-s1\">payload</span>: <span class=\"pl-s1\">dict</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Body</span>(...)):\n    <span class=\"pl-en\">print</span>(<span class=\"pl-s1\">payload</span>)\n    <span class=\"pl-k\">return</span> {<span class=\"pl-s\">\"message\"</span>: <span class=\"pl-s\">\"Post created\"</span>}</pre></div>\n<p dir=\"auto\"><strong>Body</strong> is a class that is used to get the body of the request. It is provided by <strong>fastapi.params</strong>. It contains the data sent to the server.\nIn our snippet above <strong>Body(...)</strong> is used to tell fastapi that the body is required. If we don't want the body to be required, we can use <strong>Body(None)</strong>. This will tell fastapi that the body is optional.\n<strong>Body(...)</strong> takes the data that's is sent and converts it to a python dictionary and stores it in the variable <strong>payload</strong>. <strong>dict</strong> in our context above is a type hint. It tells fastapi that the data sent to the server is a dictionary.</p>\n<p dir=\"auto\">You can then retrieve the data stored in the payload and store it in the database.</p>\n<h2 tabindex=\"-1\" id=\"user-content-schema\" dir=\"auto\"><a class=\"heading-link\" href=\"#schema\">SCHEMA<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h2>\n<p dir=\"auto\">We want to force the user at the frontend to enter data explicitly in a way we have defined. We can do this by creating a schema.</p>\n<p dir=\"auto\">With fastApi we will use a tool called <strong>pydantic</strong> to create a schema. But pydantic is not limited to fastapi, it can be used with other frameworks.</p>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"from pydantic import BaseModel\n\nclass Post(BaseModel):\n    title: str\n    content: str\n\n@app.post(&quot;/createpost&quot;)\ndef create_post(new_post: Post):\n    print(new_post)\n    return {&quot;message&quot;: &quot;Post created successfully&quot;}\"><pre><span class=\"pl-k\">from</span> <span class=\"pl-s1\">pydantic</span> <span class=\"pl-k\">import</span> <span class=\"pl-v\">BaseModel</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">Post</span>(<span class=\"pl-v\">BaseModel</span>):\n    <span class=\"pl-s1\">title</span>: <span class=\"pl-s1\">str</span>\n    <span class=\"pl-s1\">content</span>: <span class=\"pl-s1\">str</span>\n\n<span class=\"pl-en\">@<span class=\"pl-s1\">app</span>.<span class=\"pl-en\">post</span>(<span class=\"pl-s\">\"/createpost\"</span>)</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">create_post</span>(<span class=\"pl-s1\">new_post</span>: <span class=\"pl-v\">Post</span>):\n    <span class=\"pl-en\">print</span>(<span class=\"pl-s1\">new_post</span>)\n    <span class=\"pl-k\">return</span> {<span class=\"pl-s\">\"message\"</span>: <span class=\"pl-s\">\"Post created successfully\"</span>}</pre></div>\n<p dir=\"auto\"><strong>BaseModel</strong> is a class that is provided by pydantic. It is used to create a schema.\n<strong>create_post(new_post: Post)</strong> the new_post variable is an instance of the class Post. It is the data that is sent to the server. The data is then validated against the schema. If the data is valid, it is stored in the database. If the data is invalid, an error is returned.</p>\n<p dir=\"auto\">With the schema defined, if we send data that does not comply, validation happens authomatically and we will we receive an error message. It also tries to convert the data to the type we have defined. If it fails, an error is returned.</p>\n<p dir=\"auto\">To access a single value of the body sent we can <strong>new_post.title</strong> or <strong>new_post.content</strong>.</p>\n<h3 tabindex=\"-1\" id=\"user-content-optional-fields\" dir=\"auto\"><a class=\"heading-link\" href=\"#optional-fields\">OPTIONAL FIELDS<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"from typing import Optional\n\nclass Post(BaseModel):\n    title: str\n    content: str\n    published: bool = False\n    rating: Optiona[int] = None\"><pre><span class=\"pl-k\">from</span> <span class=\"pl-s1\">typing</span> <span class=\"pl-k\">import</span> <span class=\"pl-v\">Optional</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">Post</span>(<span class=\"pl-v\">BaseModel</span>):\n    <span class=\"pl-s1\">title</span>: <span class=\"pl-s1\">str</span>\n    <span class=\"pl-s1\">content</span>: <span class=\"pl-s1\">str</span>\n    <span class=\"pl-s1\">published</span>: <span class=\"pl-s1\">bool</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">False</span>\n    <span class=\"pl-s1\">rating</span>: <span class=\"pl-v\">Optiona</span>[<span class=\"pl-s1\">int</span>] <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">None</span></pre></div>\n<p dir=\"auto\">Here we have an optional field <strong>published</strong>. It is optional because it has a default value that is assigned to it it the user does not assign one by default. We could assign it a value of True/False if we wanted to. We could use that value in the database to determine if the post is published or not.</p>\n<p dir=\"auto\">To have a completely optional field, we can use <strong>Optional</strong> from <strong>typing</strong>.\n<strong>rating</strong> is fully optional and hwhen not provided, it will be assigned a value of None.</p>\n<p dir=\"auto\">The pydantic object has a method__dict()__ which converts it to a python dictionary.</p>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"@app.post(&quot;/createpost&quot;)\ndef create_post(new_post: Post):\n    print(new_post)\n    print(new_post.dict())\n    return {&quot;message&quot;: &quot;Post created successfully&quot;}\"><pre><span class=\"pl-en\">@<span class=\"pl-s1\">app</span>.<span class=\"pl-en\">post</span>(<span class=\"pl-s\">\"/createpost\"</span>)</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">create_post</span>(<span class=\"pl-s1\">new_post</span>: <span class=\"pl-v\">Post</span>):\n    <span class=\"pl-en\">print</span>(<span class=\"pl-s1\">new_post</span>)\n    <span class=\"pl-en\">print</span>(<span class=\"pl-s1\">new_post</span>.<span class=\"pl-en\">dict</span>())\n    <span class=\"pl-k\">return</span> {<span class=\"pl-s\">\"message\"</span>: <span class=\"pl-s\">\"Post created successfully\"</span>}</pre></div>\n<h2 tabindex=\"-1\" id=\"user-content-crud-operations\" dir=\"auto\"><a class=\"heading-link\" href=\"#crud-operations\">CRUD OPERATIONS<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h2>\n<h3 tabindex=\"-1\" id=\"user-content-creating-and-retrieving\" dir=\"auto\"><a class=\"heading-link\" href=\"#creating-and-retrieving\">creating and retrieving<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\">STORING IN MEMORY</p>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"my_posts = []\n\n# creating a single post to memory - the array above\n@app.post(&quot;/posts&quot;)\ndef create_post(post: Post):\n    post_dict = post.dict()\n    post_dict[&quot;id&quot;] = randint(0, 1000000)\n    my_posts.append(post_dict)\n    return {&quot;data&quot;: post_dict}\n\n&quot;&quot;&quot;\nwith the code above, the default status code on success is 200, if we want to change it, we can do so by adding the status_code parameter to the function. We will add a status code that rerpresents success in creating a resource. We will use 201.\n&quot;&quot;&quot;\n@app.post(&quot;/posts&quot;, status_code=status.HTTP_201_CREATED)\n\n# getting a single post from memory- the list above\ndef get_post_from_database(id: int):\n    for post in my_posts:\n        if post[&quot;id&quot;] == id:\n            return post\n\n# retrieving the latest post\n# We are bringing this section above the retrieval with id because they may collide\n@app.get(&quot;/posts/latest&quot;)\ndef get_latest_post():\n    return {&quot;data&quot;: my_posts[-1]}\n\n@app.get(&quot;/posts/{id}&quot;)\ndef get_post(id: int, response: Response):\n    post = get_post_from_database(id)\n    if not post:\n        response.status_code = status.HTTP_404_NOT_FOUND\n        return {&quot;detail&quot;: f&quot;Post with id {id} not found&quot;}\n    return {&quot;data&quot;: post}\n\n@app.get(&quot;/posts/{id}&quot;)\ndef get_post(id: int, response: Response):\n    post = get_post_from_database(id)\n    if not post:\n        raise HTTPException(status_code=404, detail=&quot;Post not found&quot;)\n    return {&quot;data&quot;: post}\"><pre><span class=\"pl-s1\">my_posts</span> <span class=\"pl-c1\">=</span> []\n\n<span class=\"pl-c\"># creating a single post to memory - the array above</span>\n<span class=\"pl-en\">@<span class=\"pl-s1\">app</span>.<span class=\"pl-en\">post</span>(<span class=\"pl-s\">\"/posts\"</span>)</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">create_post</span>(<span class=\"pl-s1\">post</span>: <span class=\"pl-v\">Post</span>):\n    <span class=\"pl-s1\">post_dict</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">post</span>.<span class=\"pl-en\">dict</span>()\n    <span class=\"pl-s1\">post_dict</span>[<span class=\"pl-s\">\"id\"</span>] <span class=\"pl-c1\">=</span> <span class=\"pl-en\">randint</span>(<span class=\"pl-c1\">0</span>, <span class=\"pl-c1\">1000000</span>)\n    <span class=\"pl-s1\">my_posts</span>.<span class=\"pl-en\">append</span>(<span class=\"pl-s1\">post_dict</span>)\n    <span class=\"pl-k\">return</span> {<span class=\"pl-s\">\"data\"</span>: <span class=\"pl-s1\">post_dict</span>}\n\n<span class=\"pl-s\">\"\"\"</span>\n<span class=\"pl-s\">with the code above, the default status code on success is 200, if we want to change it, we can do so by adding the status_code parameter to the function. We will add a status code that rerpresents success in creating a resource. We will use 201.</span>\n<span class=\"pl-s\">\"\"\"</span>\n<span class=\"pl-en\">@<span class=\"pl-s1\">app</span>.<span class=\"pl-en\">post</span>(<span class=\"pl-s\">\"/posts\"</span>, <span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">status</span>.<span class=\"pl-v\">HTTP_201_CREATED</span>)</span>\n\n<span class=\"pl-c\"># getting a single post from memory- the list above</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">get_post_from_database</span>(<span class=\"pl-s1\">id</span>: <span class=\"pl-s1\">int</span>):\n    <span class=\"pl-k\">for</span> <span class=\"pl-s1\">post</span> <span class=\"pl-c1\">in</span> <span class=\"pl-s1\">my_posts</span>:\n        <span class=\"pl-k\">if</span> <span class=\"pl-s1\">post</span>[<span class=\"pl-s\">\"id\"</span>] <span class=\"pl-c1\">==</span> <span class=\"pl-s1\">id</span>:\n            <span class=\"pl-k\">return</span> <span class=\"pl-s1\">post</span>\n\n<span class=\"pl-c\"># retrieving the latest post</span>\n<span class=\"pl-c\"># We are bringing this section above the retrieval with id because they may collide</span>\n<span class=\"pl-en\">@<span class=\"pl-s1\">app</span>.<span class=\"pl-en\">get</span>(<span class=\"pl-s\">\"/posts/latest\"</span>)</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">get_latest_post</span>():\n    <span class=\"pl-k\">return</span> {<span class=\"pl-s\">\"data\"</span>: <span class=\"pl-s1\">my_posts</span>[<span class=\"pl-c1\">-</span><span class=\"pl-c1\">1</span>]}\n\n<span class=\"pl-en\">@<span class=\"pl-s1\">app</span>.<span class=\"pl-en\">get</span>(<span class=\"pl-s\">\"/posts/{id}\"</span>)</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">get_post</span>(<span class=\"pl-s1\">id</span>: <span class=\"pl-s1\">int</span>, <span class=\"pl-s1\">response</span>: <span class=\"pl-v\">Response</span>):\n    <span class=\"pl-s1\">post</span> <span class=\"pl-c1\">=</span> <span class=\"pl-en\">get_post_from_database</span>(<span class=\"pl-s1\">id</span>)\n    <span class=\"pl-k\">if</span> <span class=\"pl-c1\">not</span> <span class=\"pl-s1\">post</span>:\n        <span class=\"pl-s1\">response</span>.<span class=\"pl-s1\">status_code</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">status</span>.<span class=\"pl-v\">HTTP_404_NOT_FOUND</span>\n        <span class=\"pl-k\">return</span> {<span class=\"pl-s\">\"detail\"</span>: <span class=\"pl-s\">f\"Post with id <span class=\"pl-s1\"><span class=\"pl-kos\">{</span><span class=\"pl-s1\">id</span><span class=\"pl-kos\">}</span></span> not found\"</span>}\n    <span class=\"pl-k\">return</span> {<span class=\"pl-s\">\"data\"</span>: <span class=\"pl-s1\">post</span>}\n\n<span class=\"pl-en\">@<span class=\"pl-s1\">app</span>.<span class=\"pl-en\">get</span>(<span class=\"pl-s\">\"/posts/{id}\"</span>)</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">get_post</span>(<span class=\"pl-s1\">id</span>: <span class=\"pl-s1\">int</span>, <span class=\"pl-s1\">response</span>: <span class=\"pl-v\">Response</span>):\n    <span class=\"pl-s1\">post</span> <span class=\"pl-c1\">=</span> <span class=\"pl-en\">get_post_from_database</span>(<span class=\"pl-s1\">id</span>)\n    <span class=\"pl-k\">if</span> <span class=\"pl-c1\">not</span> <span class=\"pl-s1\">post</span>:\n        <span class=\"pl-k\">raise</span> <span class=\"pl-v\">HTTPException</span>(<span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">404</span>, <span class=\"pl-s1\">detail</span><span class=\"pl-c1\">=</span><span class=\"pl-s\">\"Post not found\"</span>)\n    <span class=\"pl-k\">return</span> {<span class=\"pl-s\">\"data\"</span>: <span class=\"pl-s1\">post</span>}</pre></div>\n<h3 tabindex=\"-1\" id=\"user-content-deleting\" dir=\"auto\"><a class=\"heading-link\" href=\"#deleting\">DELETING<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"@app.delete(&quot;/posts/{id}&quot;, status_code=status.HTTP_204_NO_CONTENT)\ndef delete_post(id: int):\n    post = get_post_from_database(id)\n    if not post:\n        raise HTTPException(status_code=404, detail=&quot;Post not found&quot;)\n    my_posts.remove(post) # you could use the pop method\n    return {&quot;data&quot;: &quot;Post deleted&quot;}\"><pre><span class=\"pl-en\">@<span class=\"pl-s1\">app</span>.<span class=\"pl-en\">delete</span>(<span class=\"pl-s\">\"/posts/{id}\"</span>, <span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">status</span>.<span class=\"pl-v\">HTTP_204_NO_CONTENT</span>)</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">delete_post</span>(<span class=\"pl-s1\">id</span>: <span class=\"pl-s1\">int</span>):\n    <span class=\"pl-s1\">post</span> <span class=\"pl-c1\">=</span> <span class=\"pl-en\">get_post_from_database</span>(<span class=\"pl-s1\">id</span>)\n    <span class=\"pl-k\">if</span> <span class=\"pl-c1\">not</span> <span class=\"pl-s1\">post</span>:\n        <span class=\"pl-k\">raise</span> <span class=\"pl-v\">HTTPException</span>(<span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">404</span>, <span class=\"pl-s1\">detail</span><span class=\"pl-c1\">=</span><span class=\"pl-s\">\"Post not found\"</span>)\n    <span class=\"pl-s1\">my_posts</span>.<span class=\"pl-en\">remove</span>(<span class=\"pl-s1\">post</span>) <span class=\"pl-c\"># you could use the pop method</span>\n    <span class=\"pl-k\">return</span> {<span class=\"pl-s\">\"data\"</span>: <span class=\"pl-s\">\"Post deleted\"</span>}</pre></div>\n<h3 tabindex=\"-1\" id=\"user-content-updating\" dir=\"auto\"><a class=\"heading-link\" href=\"#updating\">UPDATING<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\">For updating, two methods are provided, PUT AND PATCH.\n<strong>PUT</strong> is used to update the entire resource. Even when you are updating a single element, you have to send the entire resource.</p>\n<p dir=\"auto\"><strong>PATCH</strong> is used to update a single element of the resource. It is used when you don't want to send the entire resource.</p>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"@app.put(&quot;/posts/{id}&quot;, status_code=status.HTTP_202_ACCEPTED)\ndef update_post(id: int, post: Post):\n    current = get_post_from_database(id)\n\n    if not current:\n        raise HTTPException(status_code=404, detail=f&quot;Post with id {id} not found&quot;)\n    post_dict = post.dict()\n    post_dict[&quot;id&quot;] = id\n    my_posts[id] = post_dict\n    return {&quot;data&quot;: post_dict}\"><pre><span class=\"pl-en\">@<span class=\"pl-s1\">app</span>.<span class=\"pl-en\">put</span>(<span class=\"pl-s\">\"/posts/{id}\"</span>, <span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">status</span>.<span class=\"pl-v\">HTTP_202_ACCEPTED</span>)</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">update_post</span>(<span class=\"pl-s1\">id</span>: <span class=\"pl-s1\">int</span>, <span class=\"pl-s1\">post</span>: <span class=\"pl-v\">Post</span>):\n    <span class=\"pl-s1\">current</span> <span class=\"pl-c1\">=</span> <span class=\"pl-en\">get_post_from_database</span>(<span class=\"pl-s1\">id</span>)\n\n    <span class=\"pl-k\">if</span> <span class=\"pl-c1\">not</span> <span class=\"pl-s1\">current</span>:\n        <span class=\"pl-k\">raise</span> <span class=\"pl-v\">HTTPException</span>(<span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">404</span>, <span class=\"pl-s1\">detail</span><span class=\"pl-c1\">=</span><span class=\"pl-s\">f\"Post with id <span class=\"pl-s1\"><span class=\"pl-kos\">{</span><span class=\"pl-s1\">id</span><span class=\"pl-kos\">}</span></span> not found\"</span>)\n    <span class=\"pl-s1\">post_dict</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">post</span>.<span class=\"pl-en\">dict</span>()\n    <span class=\"pl-s1\">post_dict</span>[<span class=\"pl-s\">\"id\"</span>] <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">id</span>\n    <span class=\"pl-s1\">my_posts</span>[<span class=\"pl-s1\">id</span>] <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">post_dict</span>\n    <span class=\"pl-k\">return</span> {<span class=\"pl-s\">\"data\"</span>: <span class=\"pl-s1\">post_dict</span>}</pre></div>\n<h2 tabindex=\"-1\" id=\"user-content-structure\" dir=\"auto\"><a class=\"heading-link\" href=\"#structure\">STRUCTURE<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h2>\n<p dir=\"auto\">we currently have our working files in the base directory. We will create a folder called <strong>app</strong> and move all our files there. We will also create a file called <strong>init.py</strong> in the base directory. This file will that folder to a python package.</p>\n<p dir=\"auto\">Now with this new structure, to run our application using uvicorn, the command will change to:</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"uvicorn app.main:app --reload\"><pre>uvicorn app.main:app --reload</pre></div>\n<p dir=\"auto\"><strong>app</strong> is the name of the folder, <strong>main</strong> is the name of the file and <strong>app</strong> is the name of the instance of the class FastAPI.</p>\n<hr>\n<hr>\n<h1 tabindex=\"-1\" id=\"user-content-database\" dir=\"auto\"><a class=\"heading-link\" href=\"#database\">DATABASE<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h1>\n<p dir=\"auto\">We don't interact with the database directly, instead we use a database management system. It sits in the middle between our application and the database. It is responsible for managing the database. It is also responsible for translating the data from the database to the application and vice versa.</p>\n<p dir=\"auto\">We are going to use postgres as our database</p>\n<h3 tabindex=\"-1\" id=\"user-content-postgres\" dir=\"auto\"><a class=\"heading-link\" href=\"#postgres\">POSTGRES<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\">Each instance of postgres can be carved into multiple separate databases. They can be operated separately.\ninstall postgres and the pgAdmin to have a graphical user interface to manage the database.</p>\n<p dir=\"auto\">in postgres when you insert items and want them to be returned back to you, you use the <strong>returning</strong> keyword.\nThis will be useful when buidling our API since we want to send back the data that was inserted into the database.</p>\n<div class=\"highlight highlight-source-sql notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"INSERT INTO products (name, price, inventory) VALUES ('drves', 44, 1523) returning *;\"><pre><span class=\"pl-k\">INSERT INTO</span> products (name, price, inventory) <span class=\"pl-k\">VALUES</span> (<span class=\"pl-s\"><span class=\"pl-pds\">'</span>drves<span class=\"pl-pds\">'</span></span>, <span class=\"pl-c1\">44</span>, <span class=\"pl-c1\">1523</span>) returning <span class=\"pl-k\">*</span>;</pre></div>\n<p dir=\"auto\">while deleting items and want to see teh item you are deleting as it gets deleted, you could use the <strong>return</strong> keyword.</p>\n<div class=\"highlight highlight-source-sql notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"DELETE FROM products where id = 11 RETURNING *;\"><pre><span class=\"pl-k\">DELETE</span> <span class=\"pl-k\">FROM</span> products <span class=\"pl-k\">where</span> id <span class=\"pl-k\">=</span> <span class=\"pl-c1\">11</span> RETURNING <span class=\"pl-k\">*</span>;</pre></div>\n<hr>\n<hr>\n<h3 tabindex=\"-1\" id=\"user-content-accessing-the-postgres-db-from-our-python-file\" dir=\"auto\"><a class=\"heading-link\" href=\"#accessing-the-postgres-db-from-our-python-file\">accessing the postgres db from our python file<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"while True:\n    try:\n        conn = psycopg2.connect(host='localhost', database='fastapi', user='postgres', password='', cursor_factory=RealDictCursor)\n        cursor = conn.cursor()\n        print(&quot;DATABSE CONN IS A SUCCESS&quot;)\n        break\n    except Exception as error:\n        print(&quot;DATABSE CONN IS A FAILURE&quot;, error)\n        time.sleep(2)\"><pre><span class=\"pl-k\">while</span> <span class=\"pl-c1\">True</span>:\n    <span class=\"pl-k\">try</span>:\n        <span class=\"pl-s1\">conn</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">psycopg2</span>.<span class=\"pl-en\">connect</span>(<span class=\"pl-s1\">host</span><span class=\"pl-c1\">=</span><span class=\"pl-s\">'localhost'</span>, <span class=\"pl-s1\">database</span><span class=\"pl-c1\">=</span><span class=\"pl-s\">'fastapi'</span>, <span class=\"pl-s1\">user</span><span class=\"pl-c1\">=</span><span class=\"pl-s\">'postgres'</span>, <span class=\"pl-s1\">password</span><span class=\"pl-c1\">=</span><span class=\"pl-s\">''</span>, <span class=\"pl-s1\">cursor_factory</span><span class=\"pl-c1\">=</span><span class=\"pl-v\">RealDictCursor</span>)\n        <span class=\"pl-s1\">cursor</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">conn</span>.<span class=\"pl-en\">cursor</span>()\n        <span class=\"pl-en\">print</span>(<span class=\"pl-s\">\"DATABSE CONN IS A SUCCESS\"</span>)\n        <span class=\"pl-k\">break</span>\n    <span class=\"pl-k\">except</span> <span class=\"pl-v\">Exception</span> <span class=\"pl-k\">as</span> <span class=\"pl-s1\">error</span>:\n        <span class=\"pl-en\">print</span>(<span class=\"pl-s\">\"DATABSE CONN IS A FAILURE\"</span>, <span class=\"pl-s1\">error</span>)\n        <span class=\"pl-s1\">time</span>.<span class=\"pl-en\">sleep</span>(<span class=\"pl-c1\">2</span>)</pre></div>\n<p dir=\"auto\">In the code above we use a while loop to keep trying to connect if the connection fails.</p>\n<p dir=\"auto\"><strong>cursor_factory=RealDictCursor</strong> is used to return the data as a dictionary. This will be useful when we are returning the data to the user.</p>\n<hr>\n<hr>\n<h3 tabindex=\"-1\" id=\"user-content-retrieving-all-data-from-the-database\" dir=\"auto\"><a class=\"heading-link\" href=\"#retrieving-all-data-from-the-database\">retrieving all data from the database<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"@app.get(&quot;/posts&quot;)\ndef get_posts():\n    cursor.execute(&quot;SELECT * FROM posts&quot;)\n    my_posts = cursor.fetchall()\n    return {&quot;data&quot;: my_posts}\"><pre><span class=\"pl-en\">@<span class=\"pl-s1\">app</span>.<span class=\"pl-en\">get</span>(<span class=\"pl-s\">\"/posts\"</span>)</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">get_posts</span>():\n    <span class=\"pl-s1\">cursor</span>.<span class=\"pl-en\">execute</span>(<span class=\"pl-s\">\"SELECT * FROM posts\"</span>)\n    <span class=\"pl-s1\">my_posts</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">cursor</span>.<span class=\"pl-en\">fetchall</span>()\n    <span class=\"pl-k\">return</span> {<span class=\"pl-s\">\"data\"</span>: <span class=\"pl-s1\">my_posts</span>}</pre></div>\n<hr>\n<hr>\n<h3 tabindex=\"-1\" id=\"user-content-retrieving-a-single-item-from-the-database\" dir=\"auto\"><a class=\"heading-link\" href=\"#retrieving-a-single-item-from-the-database\">retrieving a single item from the database<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"@app.get(&quot;/posts/{id}&quot;)\ndef get_post(id: int, response: Response):\n    cursor.execute(&quot;SELECT * FROM posts WHERE id = %s&quot;, (id,))\n    post = cursor.fetchone()\n    if not post:\n        raise HTTPException(status_code=404, detail=&quot;Post not found&quot;)\n    return {&quot;data&quot;: post}\"><pre><span class=\"pl-en\">@<span class=\"pl-s1\">app</span>.<span class=\"pl-en\">get</span>(<span class=\"pl-s\">\"/posts/{id}\"</span>)</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">get_post</span>(<span class=\"pl-s1\">id</span>: <span class=\"pl-s1\">int</span>, <span class=\"pl-s1\">response</span>: <span class=\"pl-v\">Response</span>):\n    <span class=\"pl-s1\">cursor</span>.<span class=\"pl-en\">execute</span>(<span class=\"pl-s\">\"SELECT * FROM posts WHERE id = %s\"</span>, (<span class=\"pl-s1\">id</span>,))\n    <span class=\"pl-s1\">post</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">cursor</span>.<span class=\"pl-en\">fetchone</span>()\n    <span class=\"pl-k\">if</span> <span class=\"pl-c1\">not</span> <span class=\"pl-s1\">post</span>:\n        <span class=\"pl-k\">raise</span> <span class=\"pl-v\">HTTPException</span>(<span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">404</span>, <span class=\"pl-s1\">detail</span><span class=\"pl-c1\">=</span><span class=\"pl-s\">\"Post not found\"</span>)\n    <span class=\"pl-k\">return</span> {<span class=\"pl-s\">\"data\"</span>: <span class=\"pl-s1\">post</span>}</pre></div>\n<p dir=\"auto\"><strong>(id,)</strong> is a tuple. It is used to pass the id to the query. It is used to prevent sql injection.\nWe can also try <strong>str(id),</strong> but it is not recommended since it is prone to sql injection.</p>\n<hr>\n<hr>\n<h3 tabindex=\"-1\" id=\"user-content-inserting-data-into-the-database\" dir=\"auto\"><a class=\"heading-link\" href=\"#inserting-data-into-the-database\">inserting data into the database<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"cursor.execute(&quot;INSERT INTO posts (title, content, published) VALUES (%s, %s, %s) RETURNING *&quot;, (post.title, post.content, post.published))\n\nnew_post = cursor.fetchone()\nconn.commit()\nreturn {&quot;data&quot;: new_post}\"><pre><span class=\"pl-s1\">cursor</span>.<span class=\"pl-en\">execute</span>(<span class=\"pl-s\">\"INSERT INTO posts (title, content, published) VALUES (%s, %s, %s) RETURNING *\"</span>, (<span class=\"pl-s1\">post</span>.<span class=\"pl-s1\">title</span>, <span class=\"pl-s1\">post</span>.<span class=\"pl-s1\">content</span>, <span class=\"pl-s1\">post</span>.<span class=\"pl-s1\">published</span>))\n\n<span class=\"pl-s1\">new_post</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">cursor</span>.<span class=\"pl-en\">fetchone</span>()\n<span class=\"pl-s1\">conn</span>.<span class=\"pl-en\">commit</span>()\n<span class=\"pl-k\">return</span> {<span class=\"pl-s\">\"data\"</span>: <span class=\"pl-s1\">new_post</span>}</pre></div>\n<p dir=\"auto\">This way of inserting sanitizes the input hence preventing sql injection.\n<strong>RETURNING *</strong> is used to return the data that was inserted into the database.\n<strong>new_post = cursor.fetchone()</strong> is used to get the data that was inserted into the database.\n<strong>conn.commit()</strong> is used to commit the changes to the database. it pushes the changes to the database.</p>\n<hr>\n<hr>\n<h3 tabindex=\"-1\" id=\"user-content-deleting-data-from-the-database\" dir=\"auto\"><a class=\"heading-link\" href=\"#deleting-data-from-the-database\">DELETING DATA FROM THE DATABASE<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"@app.delete(&quot;/posts/{id}&quot;, status_code=status.HTTP_204_NO_CONTENT)\ndef delete_post(id: int):\n    cursor.execute(&quot;DELETE FROM posts WHERE id = %s returning *&quot;, (id,))\n    deleted_post = cursor.fetchone()\n    conn.commit()\n\n    if not deleted_post:\n        raise HTTPException(status_code=404, detail=&quot;Post not found&quot;)\n\n    return Response(status_code=status.HTTP_204_NO_CONTENT)\"><pre><span class=\"pl-en\">@<span class=\"pl-s1\">app</span>.<span class=\"pl-en\">delete</span>(<span class=\"pl-s\">\"/posts/{id}\"</span>, <span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">status</span>.<span class=\"pl-v\">HTTP_204_NO_CONTENT</span>)</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">delete_post</span>(<span class=\"pl-s1\">id</span>: <span class=\"pl-s1\">int</span>):\n    <span class=\"pl-s1\">cursor</span>.<span class=\"pl-en\">execute</span>(<span class=\"pl-s\">\"DELETE FROM posts WHERE id = %s returning *\"</span>, (<span class=\"pl-s1\">id</span>,))\n    <span class=\"pl-s1\">deleted_post</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">cursor</span>.<span class=\"pl-en\">fetchone</span>()\n    <span class=\"pl-s1\">conn</span>.<span class=\"pl-en\">commit</span>()\n\n    <span class=\"pl-k\">if</span> <span class=\"pl-c1\">not</span> <span class=\"pl-s1\">deleted_post</span>:\n        <span class=\"pl-k\">raise</span> <span class=\"pl-v\">HTTPException</span>(<span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">404</span>, <span class=\"pl-s1\">detail</span><span class=\"pl-c1\">=</span><span class=\"pl-s\">\"Post not found\"</span>)\n\n    <span class=\"pl-k\">return</span> <span class=\"pl-v\">Response</span>(<span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">status</span>.<span class=\"pl-v\">HTTP_204_NO_CONTENT</span>)</pre></div>\n<hr>\n<hr>\n<h3 tabindex=\"-1\" id=\"user-content-updating-data-in-the-database\" dir=\"auto\"><a class=\"heading-link\" href=\"#updating-data-in-the-database\">UPDATING DATA IN THE DATABASE<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"@app.put(&quot;/posts/{id}&quot;, status_code=status.HTTP_202_ACCEPTED)\ndef update_post(id: int, post: Post):\n    cursor.execute(&quot;UPDATE posts SET title = %s, content = %s, published = %s WHERE id = %s RETURNING *&quot;, (post.title, post.content, post.published, id))\n    \n    updated_post = cursor.fetchone()\n    conn.commit()\n\n    if not updated_post:\n        raise HTTPException(status_code=404, detail=f&quot;Post with id {id} not found&quot;)\n\n    return {&quot;data&quot;: updated_post}\"><pre><span class=\"pl-en\">@<span class=\"pl-s1\">app</span>.<span class=\"pl-en\">put</span>(<span class=\"pl-s\">\"/posts/{id}\"</span>, <span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">status</span>.<span class=\"pl-v\">HTTP_202_ACCEPTED</span>)</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">update_post</span>(<span class=\"pl-s1\">id</span>: <span class=\"pl-s1\">int</span>, <span class=\"pl-s1\">post</span>: <span class=\"pl-v\">Post</span>):\n    <span class=\"pl-s1\">cursor</span>.<span class=\"pl-en\">execute</span>(<span class=\"pl-s\">\"UPDATE posts SET title = %s, content = %s, published = %s WHERE id = %s RETURNING *\"</span>, (<span class=\"pl-s1\">post</span>.<span class=\"pl-s1\">title</span>, <span class=\"pl-s1\">post</span>.<span class=\"pl-s1\">content</span>, <span class=\"pl-s1\">post</span>.<span class=\"pl-s1\">published</span>, <span class=\"pl-s1\">id</span>))\n    \n    <span class=\"pl-s1\">updated_post</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">cursor</span>.<span class=\"pl-en\">fetchone</span>()\n    <span class=\"pl-s1\">conn</span>.<span class=\"pl-en\">commit</span>()\n\n    <span class=\"pl-k\">if</span> <span class=\"pl-c1\">not</span> <span class=\"pl-s1\">updated_post</span>:\n        <span class=\"pl-k\">raise</span> <span class=\"pl-v\">HTTPException</span>(<span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">404</span>, <span class=\"pl-s1\">detail</span><span class=\"pl-c1\">=</span><span class=\"pl-s\">f\"Post with id <span class=\"pl-s1\"><span class=\"pl-kos\">{</span><span class=\"pl-s1\">id</span><span class=\"pl-kos\">}</span></span> not found\"</span>)\n\n    <span class=\"pl-k\">return</span> {<span class=\"pl-s\">\"data\"</span>: <span class=\"pl-s1\">updated_post</span>}</pre></div>\n<hr>\n<hr>\n<h2 tabindex=\"-1\" id=\"user-content-object-relational-mapper-orm\" dir=\"auto\"><a class=\"heading-link\" href=\"#object-relational-mapper-orm\">OBJECT RELATIONAL MAPPER (ORM)<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h2>\n<p dir=\"auto\">ORM is a library that allows us to interact with the database using python objects. It allows us to interact with the database without writing sql queries.</p>\n<h2 tabindex=\"-1\" id=\"user-content-sqlalchemy\" dir=\"auto\"><a class=\"heading-link\" href=\"#sqlalchemy\">SQLALCHEMY<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h2>\n<h3 tabindex=\"-1\" id=\"user-content-installation-1\" dir=\"auto\"><a class=\"heading-link\" href=\"#installation-1\">INSTALLATION<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"pip install SQLAlchemy==1.4\"><pre>pip install SQLAlchemy==1.4</pre></div>\n<p dir=\"auto\">sqlalchemy does not know how to talk to databases, it needs a database driver, the driver is determined by the database you choose, for us, we are using <strong>postgres</strong> hence our driver is <strong>psycopg2</strong>.</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"pip install psycopg2-binary\"><pre>pip install psycopg2-binary</pre></div>\n<p dir=\"auto\">The <strong>fastApi</strong> documentation provides a way to integrate sqlalchemy with fastapi under the <strong>ORM</strong> section.</p>\n<h3 tabindex=\"-1\" id=\"user-content-connecting-to-the-database\" dir=\"auto\"><a class=\"heading-link\" href=\"#connecting-to-the-database\">Connecting to the database<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\">the format of the connection string and the engine:</p>\n<p dir=\"auto\">```database.py``</p>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"sqlalchemy_url = 'postgresql://&lt;username&gt;:&lt;password&gt;@&lt;ip-address/hostname&gt;/&lt;database-name&gt;'\nsqlalchemy_url = 'postgresql://postgres:mankindjnr@127.0.0.1/fastapi'\n\nengine = create_engine(sqlalchemy_url)\n\nSessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)\n\nBase = declarative_base()\"><pre><span class=\"pl-s1\">sqlalchemy_url</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">'postgresql://&lt;username&gt;:&lt;password&gt;@&lt;ip-address/hostname&gt;/&lt;database-name&gt;'</span>\n<span class=\"pl-s1\">sqlalchemy_url</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">'postgresql://postgres:mankindjnr@127.0.0.1/fastapi'</span>\n\n<span class=\"pl-s1\">engine</span> <span class=\"pl-c1\">=</span> <span class=\"pl-en\">create_engine</span>(<span class=\"pl-s1\">sqlalchemy_url</span>)\n\n<span class=\"pl-v\">SessionLocal</span> <span class=\"pl-c1\">=</span> <span class=\"pl-en\">sessionmaker</span>(<span class=\"pl-s1\">autocommit</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">False</span>, <span class=\"pl-s1\">autoflush</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">False</span>, <span class=\"pl-s1\">bind</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">engine</span>)\n\n<span class=\"pl-v\">Base</span> <span class=\"pl-c1\">=</span> <span class=\"pl-en\">declarative_base</span>()</pre></div>\n<p dir=\"auto\">Wit orms we no longer have to create tables with the pgadmin or the like, we can declare those tables using python models.</p>\n<hr>\n<p dir=\"auto\"><code>models.py</code></p>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"from .database import Base\nfrom sqlalchemy import Column, Integer, String, Text, DateTime\nimport datetime\n\nclass Post(Base):\n    __tablename__ = 'posts'\n\n    id = Column(Integer, primary_key=True, nullable=False)\n    title = Column(String(255), nullable=False)\n    content = Column(String, nullable=False)\n    published = Column(Boolean, default=True, nullable=False)\n    created = Column(TIMESTAMP(timezone=True), nullable=False, server_default=text('now()'))\"><pre><span class=\"pl-k\">from</span> .<span class=\"pl-s1\">database</span> <span class=\"pl-k\">import</span> <span class=\"pl-v\">Base</span>\n<span class=\"pl-k\">from</span> <span class=\"pl-s1\">sqlalchemy</span> <span class=\"pl-k\">import</span> <span class=\"pl-v\">Column</span>, <span class=\"pl-v\">Integer</span>, <span class=\"pl-v\">String</span>, <span class=\"pl-v\">Text</span>, <span class=\"pl-v\">DateTime</span>\n<span class=\"pl-k\">import</span> <span class=\"pl-s1\">datetime</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">Post</span>(<span class=\"pl-v\">Base</span>):\n    <span class=\"pl-s1\">__tablename__</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">'posts'</span>\n\n    <span class=\"pl-s1\">id</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Column</span>(<span class=\"pl-v\">Integer</span>, <span class=\"pl-s1\">primary_key</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">True</span>, <span class=\"pl-s1\">nullable</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">False</span>)\n    <span class=\"pl-s1\">title</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Column</span>(<span class=\"pl-v\">String</span>(<span class=\"pl-c1\">255</span>), <span class=\"pl-s1\">nullable</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">False</span>)\n    <span class=\"pl-s1\">content</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Column</span>(<span class=\"pl-v\">String</span>, <span class=\"pl-s1\">nullable</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">False</span>)\n    <span class=\"pl-s1\">published</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Column</span>(<span class=\"pl-v\">Boolean</span>, <span class=\"pl-s1\">default</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">True</span>, <span class=\"pl-s1\">nullable</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">False</span>)\n    <span class=\"pl-s1\">created</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Column</span>(<span class=\"pl-v\">TIMESTAMP</span>(<span class=\"pl-s1\">timezone</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">True</span>), <span class=\"pl-s1\">nullable</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">False</span>, <span class=\"pl-s1\">server_default</span><span class=\"pl-c1\">=</span><span class=\"pl-en\">text</span>(<span class=\"pl-s\">'now()'</span>))</pre></div>\n<p dir=\"auto\"><strong>Base</strong> is the base class that is provided by sqlalchemy. It is used to create the tables in the database.\n<strong>Column(String(255))</strong> the string constraint is used for fields that do not expect large input while <strong>Text</strong> is used for fields that expect large input, i.e. blog posts, articles. Use <strong>Text</strong> when there is no limit to the number of characters that can be entered. <strong>String</strong> when you want to limit the number of characters that can be entered. <strong>String(255)</strong> means that the field can only take 255 characters.</p>\n<p dir=\"auto\"><code>update to main.py</code></p>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"from . import models\nfrom .database import engine, SessionLocal\n\nmodels.Base.metadata.create_all(bind=engine)\n\napp = FastAPI()\n\ndef get_db():\n    db = SessionLocal()\n    try:\n        yield db\n    finally:\n        db.close()\"><pre><span class=\"pl-k\">from</span> . <span class=\"pl-k\">import</span> <span class=\"pl-s1\">models</span>\n<span class=\"pl-k\">from</span> .<span class=\"pl-s1\">database</span> <span class=\"pl-k\">import</span> <span class=\"pl-s1\">engine</span>, <span class=\"pl-v\">SessionLocal</span>\n\n<span class=\"pl-s1\">models</span>.<span class=\"pl-v\">Base</span>.<span class=\"pl-s1\">metadata</span>.<span class=\"pl-en\">create_all</span>(<span class=\"pl-s1\">bind</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">engine</span>)\n\n<span class=\"pl-s1\">app</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">FastAPI</span>()\n\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">get_db</span>():\n    <span class=\"pl-s1\">db</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">SessionLocal</span>()\n    <span class=\"pl-k\">try</span>:\n        <span class=\"pl-k\">yield</span> <span class=\"pl-s1\">db</span>\n    <span class=\"pl-k\">finally</span>:\n        <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">close</span>()</pre></div>\n<h3 tabindex=\"-1\" id=\"user-content-testing-if-our-connection-worked\" dir=\"auto\"><a class=\"heading-link\" href=\"#testing-if-our-connection-worked\">testing if our connection worked<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"@app.get(&quot;/sqlalchemy&quot;)\ndef test(db: Session = Depends(get_db)):\n    return {&quot;message&quot;: &quot;Hello orm&quot;}\"><pre><span class=\"pl-en\">@<span class=\"pl-s1\">app</span>.<span class=\"pl-en\">get</span>(<span class=\"pl-s\">\"/sqlalchemy\"</span>)</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">test</span>(<span class=\"pl-s1\">db</span>: <span class=\"pl-v\">Session</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Depends</span>(<span class=\"pl-s1\">get_db</span>)):\n    <span class=\"pl-k\">return</span> {<span class=\"pl-s\">\"message\"</span>: <span class=\"pl-s\">\"Hello orm\"</span>}</pre></div>\n<p dir=\"auto\">When we run the code, the models we defined are checked if those tables exist in the database, if not, they are created, if they exist, nothing happens.</p>\n<hr>\n<p dir=\"auto\">sqlalchemy does not handle databse changes, when you update a table and it already existed, those changes will not reflect in the database, to make those changes stick, we use another tool to <strong>migrate</strong> our changes. The tool is <strong>alembic</strong>.</p>\n<h3 tabindex=\"-1\" id=\"user-content-testing-1\" dir=\"auto\"><a class=\"heading-link\" href=\"#testing-1\">testing<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"@app.get(&quot;/sqlalchemy&quot;)\ndef test(db: Session = Depends(get_db)):\n    posts = db.query(models.Post).all()\n    return {&quot;data&quot;: posts}\"><pre><span class=\"pl-en\">@<span class=\"pl-s1\">app</span>.<span class=\"pl-en\">get</span>(<span class=\"pl-s\">\"/sqlalchemy\"</span>)</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">test</span>(<span class=\"pl-s1\">db</span>: <span class=\"pl-v\">Session</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Depends</span>(<span class=\"pl-s1\">get_db</span>)):\n    <span class=\"pl-s1\">posts</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">query</span>(<span class=\"pl-s1\">models</span>.<span class=\"pl-v\">Post</span>).<span class=\"pl-en\">all</span>()\n    <span class=\"pl-k\">return</span> {<span class=\"pl-s\">\"data\"</span>: <span class=\"pl-s1\">posts</span>}</pre></div>\n<p dir=\"auto\">While working with sqlalchemy you need to call the connection to the database <strong>db</strong>.\nhence</p>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"db.query(models.Post).all()\"><pre><span class=\"pl-s1\">db</span>.<span class=\"pl-en\">query</span>(<span class=\"pl-s1\">models</span>.<span class=\"pl-v\">Post</span>).<span class=\"pl-en\">all</span>()</pre></div>\n<p dir=\"auto\">the query <strong>db.query(models.Post)</strong> is used to query the database and the <strong>.all()</strong> is used to get all the data from the database and execute the query.</p>\n<hr>\n<hr>\n<h3 tabindex=\"-1\" id=\"user-content-retrieving-all-items-with-orm\" dir=\"auto\"><a class=\"heading-link\" href=\"#retrieving-all-items-with-orm\">retrieving all items with orm<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"@app.post(&quot;/posts&quot;, status_code=status.HTTP_201_CREATED)\ndef create_post(post: Post, db: Session = Depends(get_db)):\n    new_post = models.Post(title=post.title, content=post.content, published=post.published)\n    return {&quot;data&quot;: new_post}\"><pre><span class=\"pl-en\">@<span class=\"pl-s1\">app</span>.<span class=\"pl-en\">post</span>(<span class=\"pl-s\">\"/posts\"</span>, <span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">status</span>.<span class=\"pl-v\">HTTP_201_CREATED</span>)</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">create_post</span>(<span class=\"pl-s1\">post</span>: <span class=\"pl-v\">Post</span>, <span class=\"pl-s1\">db</span>: <span class=\"pl-v\">Session</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Depends</span>(<span class=\"pl-s1\">get_db</span>)):\n    <span class=\"pl-s1\">new_post</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">models</span>.<span class=\"pl-v\">Post</span>(<span class=\"pl-s1\">title</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">post</span>.<span class=\"pl-s1\">title</span>, <span class=\"pl-s1\">content</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">post</span>.<span class=\"pl-s1\">content</span>, <span class=\"pl-s1\">published</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">post</span>.<span class=\"pl-s1\">published</span>)\n    <span class=\"pl-k\">return</span> {<span class=\"pl-s\">\"data\"</span>: <span class=\"pl-s1\">new_post</span>}</pre></div>\n<hr>\n<hr>\n<h3 tabindex=\"-1\" id=\"user-content-creating-a-single-item-with-orm\" dir=\"auto\"><a class=\"heading-link\" href=\"#creating-a-single-item-with-orm\">creating a single item with orm<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"@app.post(&quot;/posts&quot;, status_code=status.HTTP_201_CREATED)\ndef create_post(post: Post, db: Session = Depends(get_db)):\n    new_post = models.Post(title=post.title, content=post.content, published=post.published)\n\n    db.add(new_post)\n    db.commit()\n    db.refresh(new_post)\n    return {&quot;data&quot;: new_post}\"><pre><span class=\"pl-en\">@<span class=\"pl-s1\">app</span>.<span class=\"pl-en\">post</span>(<span class=\"pl-s\">\"/posts\"</span>, <span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">status</span>.<span class=\"pl-v\">HTTP_201_CREATED</span>)</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">create_post</span>(<span class=\"pl-s1\">post</span>: <span class=\"pl-v\">Post</span>, <span class=\"pl-s1\">db</span>: <span class=\"pl-v\">Session</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Depends</span>(<span class=\"pl-s1\">get_db</span>)):\n    <span class=\"pl-s1\">new_post</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">models</span>.<span class=\"pl-v\">Post</span>(<span class=\"pl-s1\">title</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">post</span>.<span class=\"pl-s1\">title</span>, <span class=\"pl-s1\">content</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">post</span>.<span class=\"pl-s1\">content</span>, <span class=\"pl-s1\">published</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">post</span>.<span class=\"pl-s1\">published</span>)\n\n    <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">add</span>(<span class=\"pl-s1\">new_post</span>)\n    <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">commit</span>()\n    <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">refresh</span>(<span class=\"pl-s1\">new_post</span>)\n    <span class=\"pl-k\">return</span> {<span class=\"pl-s\">\"data\"</span>: <span class=\"pl-s1\">new_post</span>}</pre></div>\n<p dir=\"auto\">We create the post and store it in the variable new_post\nwe then add the new post to the database\nwe then commit the changes to the database(saving them)\nwe then retrieve that post (<strong>equivalent of return in raw sql</strong>) using refresh adn store it in variable <strong>new_post</strong>\nwe then return the new_post</p>\n<p dir=\"auto\">The above way of mapping items to the columsn will prove inefficient when our models grow, to solve that we can unpack the pydantic model using the <strong>.dict()</strong> method.</p>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"@app.post(&quot;/posts&quot;, status_code=status.HTTP_201_CREATED)\ndef create_post(post: Post, db: Session = Depends(get_db)):\n    new_post = models.Post(**post.dict())\n\n    db.add(new_post)\n    db.commit()\n    db.refresh(new_post)\n    return {&quot;data&quot;: new_post}\"><pre><span class=\"pl-en\">@<span class=\"pl-s1\">app</span>.<span class=\"pl-en\">post</span>(<span class=\"pl-s\">\"/posts\"</span>, <span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">status</span>.<span class=\"pl-v\">HTTP_201_CREATED</span>)</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">create_post</span>(<span class=\"pl-s1\">post</span>: <span class=\"pl-v\">Post</span>, <span class=\"pl-s1\">db</span>: <span class=\"pl-v\">Session</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Depends</span>(<span class=\"pl-s1\">get_db</span>)):\n    <span class=\"pl-s1\">new_post</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">models</span>.<span class=\"pl-v\">Post</span>(<span class=\"pl-c1\">**</span><span class=\"pl-s1\">post</span>.<span class=\"pl-en\">dict</span>())\n\n    <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">add</span>(<span class=\"pl-s1\">new_post</span>)\n    <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">commit</span>()\n    <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">refresh</span>(<span class=\"pl-s1\">new_post</span>)\n    <span class=\"pl-k\">return</span> {<span class=\"pl-s\">\"data\"</span>: <span class=\"pl-s1\">new_post</span>}</pre></div>\n<p dir=\"auto\">Now, it will not matter how many fields our models have, all the fields described in our pydantic model will be mapped to the columns in our database.</p>\n<hr>\n<hr>\n<h3 tabindex=\"-1\" id=\"user-content-retrieving-a-single-item-with-orm\" dir=\"auto\"><a class=\"heading-link\" href=\"#retrieving-a-single-item-with-orm\">retrieving a single item with orm<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"@app.get(&quot;/posts/{id}&quot;)\ndef get_post(id: int, db: Session = Depends(get_db)):\n    post = db.query(models.Post).filter(models.Post.id == id).first()\n\n    if not post:\n        raise HTTPException(status_code=404, detail=f&quot;Post of id {id} not found&quot;)\n    return {&quot;data&quot;: post}\"><pre><span class=\"pl-en\">@<span class=\"pl-s1\">app</span>.<span class=\"pl-en\">get</span>(<span class=\"pl-s\">\"/posts/{id}\"</span>)</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">get_post</span>(<span class=\"pl-s1\">id</span>: <span class=\"pl-s1\">int</span>, <span class=\"pl-s1\">db</span>: <span class=\"pl-v\">Session</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Depends</span>(<span class=\"pl-s1\">get_db</span>)):\n    <span class=\"pl-s1\">post</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">query</span>(<span class=\"pl-s1\">models</span>.<span class=\"pl-v\">Post</span>).<span class=\"pl-en\">filter</span>(<span class=\"pl-s1\">models</span>.<span class=\"pl-v\">Post</span>.<span class=\"pl-s1\">id</span> <span class=\"pl-c1\">==</span> <span class=\"pl-s1\">id</span>).<span class=\"pl-en\">first</span>()\n\n    <span class=\"pl-k\">if</span> <span class=\"pl-c1\">not</span> <span class=\"pl-s1\">post</span>:\n        <span class=\"pl-k\">raise</span> <span class=\"pl-v\">HTTPException</span>(<span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">404</span>, <span class=\"pl-s1\">detail</span><span class=\"pl-c1\">=</span><span class=\"pl-s\">f\"Post of id <span class=\"pl-s1\"><span class=\"pl-kos\">{</span><span class=\"pl-s1\">id</span><span class=\"pl-kos\">}</span></span> not found\"</span>)\n    <span class=\"pl-k\">return</span> {<span class=\"pl-s\">\"data\"</span>: <span class=\"pl-s1\">post</span>}</pre></div>\n<p dir=\"auto\"><strong>db.query</strong> is used to query the database\n<strong>(models.Post)</strong> is the table we are querying, we have imported the models.py file and <strong>Post</strong> is one of the model in that file.\n<strong>.filter(models.Post.id == id)</strong> is used to filter the data we want to retrieve. We are filtering the data by the id.</p>\n<hr>\n<hr>\n<h3 tabindex=\"-1\" id=\"user-content-deleting-a-single-item-with-orm\" dir=\"auto\"><a class=\"heading-link\" href=\"#deleting-a-single-item-with-orm\">Deleting a single item with orm<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"@app.delete(&quot;/posts/{id}&quot;, status_code=status.HTTP_204_NO_CONTENT)\ndef delete_post(id: int, db: Session = Depends(get_db)):\n    deleted_post = db.query(models.Post).filter(models.Post.id == id)\n\n    if deleted_post.first() == None:\n        raise HTTPException(status_code=404, detail=f&quot;Post of id {id} not found&quot;)\n\n    deleted_post.delete(synchronize_session=False)\n    db.commit()\n\n    return Response(status_code=status.HTTP_204_NO_CONTENT)\"><pre><span class=\"pl-en\">@<span class=\"pl-s1\">app</span>.<span class=\"pl-en\">delete</span>(<span class=\"pl-s\">\"/posts/{id}\"</span>, <span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">status</span>.<span class=\"pl-v\">HTTP_204_NO_CONTENT</span>)</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">delete_post</span>(<span class=\"pl-s1\">id</span>: <span class=\"pl-s1\">int</span>, <span class=\"pl-s1\">db</span>: <span class=\"pl-v\">Session</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Depends</span>(<span class=\"pl-s1\">get_db</span>)):\n    <span class=\"pl-s1\">deleted_post</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">query</span>(<span class=\"pl-s1\">models</span>.<span class=\"pl-v\">Post</span>).<span class=\"pl-en\">filter</span>(<span class=\"pl-s1\">models</span>.<span class=\"pl-v\">Post</span>.<span class=\"pl-s1\">id</span> <span class=\"pl-c1\">==</span> <span class=\"pl-s1\">id</span>)\n\n    <span class=\"pl-k\">if</span> <span class=\"pl-s1\">deleted_post</span>.<span class=\"pl-en\">first</span>() <span class=\"pl-c1\">==</span> <span class=\"pl-c1\">None</span>:\n        <span class=\"pl-k\">raise</span> <span class=\"pl-v\">HTTPException</span>(<span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">404</span>, <span class=\"pl-s1\">detail</span><span class=\"pl-c1\">=</span><span class=\"pl-s\">f\"Post of id <span class=\"pl-s1\"><span class=\"pl-kos\">{</span><span class=\"pl-s1\">id</span><span class=\"pl-kos\">}</span></span> not found\"</span>)\n\n    <span class=\"pl-s1\">deleted_post</span>.<span class=\"pl-en\">delete</span>(<span class=\"pl-s1\">synchronize_session</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">False</span>)\n    <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">commit</span>()\n\n    <span class=\"pl-k\">return</span> <span class=\"pl-v\">Response</span>(<span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">status</span>.<span class=\"pl-v\">HTTP_204_NO_CONTENT</span>)</pre></div>\n<hr>\n<hr>\n<h3 tabindex=\"-1\" id=\"user-content-updating-a-single-item-with-orm\" dir=\"auto\"><a class=\"heading-link\" href=\"#updating-a-single-item-with-orm\">Updating a single item with orm<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"@app.put(&quot;/posts/{id}&quot;, status_code=status.HTTP_202_ACCEPTED)\ndef update_post(id: int, post: Post, db: Session = Depends(get_db)):\n    required_post = db.query(models.Post).filter(models.Post.id == id)\n    updated_post = required_post.first()\n\n    if not updated_post:\n        raise HTTPException(status_code=404, detail=f&quot;Post with id {id} not found&quot;)\n\n    required_post.update(post.dict(), synchronize_session=False)\n    db.commit()\n\n    return {&quot;data&quot;: required_post.first()}\"><pre><span class=\"pl-en\">@<span class=\"pl-s1\">app</span>.<span class=\"pl-en\">put</span>(<span class=\"pl-s\">\"/posts/{id}\"</span>, <span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">status</span>.<span class=\"pl-v\">HTTP_202_ACCEPTED</span>)</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">update_post</span>(<span class=\"pl-s1\">id</span>: <span class=\"pl-s1\">int</span>, <span class=\"pl-s1\">post</span>: <span class=\"pl-v\">Post</span>, <span class=\"pl-s1\">db</span>: <span class=\"pl-v\">Session</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Depends</span>(<span class=\"pl-s1\">get_db</span>)):\n    <span class=\"pl-s1\">required_post</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">query</span>(<span class=\"pl-s1\">models</span>.<span class=\"pl-v\">Post</span>).<span class=\"pl-en\">filter</span>(<span class=\"pl-s1\">models</span>.<span class=\"pl-v\">Post</span>.<span class=\"pl-s1\">id</span> <span class=\"pl-c1\">==</span> <span class=\"pl-s1\">id</span>)\n    <span class=\"pl-s1\">updated_post</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">required_post</span>.<span class=\"pl-en\">first</span>()\n\n    <span class=\"pl-k\">if</span> <span class=\"pl-c1\">not</span> <span class=\"pl-s1\">updated_post</span>:\n        <span class=\"pl-k\">raise</span> <span class=\"pl-v\">HTTPException</span>(<span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">404</span>, <span class=\"pl-s1\">detail</span><span class=\"pl-c1\">=</span><span class=\"pl-s\">f\"Post with id <span class=\"pl-s1\"><span class=\"pl-kos\">{</span><span class=\"pl-s1\">id</span><span class=\"pl-kos\">}</span></span> not found\"</span>)\n\n    <span class=\"pl-s1\">required_post</span>.<span class=\"pl-en\">update</span>(<span class=\"pl-s1\">post</span>.<span class=\"pl-en\">dict</span>(), <span class=\"pl-s1\">synchronize_session</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">False</span>)\n    <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">commit</span>()\n\n    <span class=\"pl-k\">return</span> {<span class=\"pl-s\">\"data\"</span>: <span class=\"pl-s1\">required_post</span>.<span class=\"pl-en\">first</span>()}</pre></div>\n<hr>\n<hr>\n<h2 tabindex=\"-1\" id=\"user-content-pydanticschema-model\" dir=\"auto\"><a class=\"heading-link\" href=\"#pydanticschema-model\">pydantic/schema model<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h2>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"\nclass Post(BaseModel):\n    title: str\n    content: str\n    published: bool = True\"><pre><span class=\"pl-k\">class</span> <span class=\"pl-v\">Post</span>(<span class=\"pl-v\">BaseModel</span>):\n    <span class=\"pl-s1\">title</span>: <span class=\"pl-s1\">str</span>\n    <span class=\"pl-s1\">content</span>: <span class=\"pl-s1\">str</span>\n    <span class=\"pl-s1\">published</span>: <span class=\"pl-s1\">bool</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">True</span></pre></div>\n<p dir=\"auto\">This defines the structure of the data that the user should send through the api as well as the response by the fastAPI. It is used to validate the data sent to the server and the data sent back to the user. All data should meet the requirements of the schema.</p>\n<h2 tabindex=\"-1\" id=\"user-content-sqlalchemy-model\" dir=\"auto\"><a class=\"heading-link\" href=\"#sqlalchemy-model\">sqlalchemy model<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h2>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class Post(Base):\n    __tablename__ = 'posts'\n\n    id = Column(Integer, primary_key=True, nullable=False)\n    title = Column(String(255), nullable=False)\n    content = Column(String, nullable=False)\n    published = Column(Boolean, server_default='TRUE', nullable=False)\n    created = Column(TIMESTAMP(timezone=True), nullable=False, server_default=text('now()'))\"><pre><span class=\"pl-k\">class</span> <span class=\"pl-v\">Post</span>(<span class=\"pl-v\">Base</span>):\n    <span class=\"pl-s1\">__tablename__</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">'posts'</span>\n\n    <span class=\"pl-s1\">id</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Column</span>(<span class=\"pl-v\">Integer</span>, <span class=\"pl-s1\">primary_key</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">True</span>, <span class=\"pl-s1\">nullable</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">False</span>)\n    <span class=\"pl-s1\">title</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Column</span>(<span class=\"pl-v\">String</span>(<span class=\"pl-c1\">255</span>), <span class=\"pl-s1\">nullable</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">False</span>)\n    <span class=\"pl-s1\">content</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Column</span>(<span class=\"pl-v\">String</span>, <span class=\"pl-s1\">nullable</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">False</span>)\n    <span class=\"pl-s1\">published</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Column</span>(<span class=\"pl-v\">Boolean</span>, <span class=\"pl-s1\">server_default</span><span class=\"pl-c1\">=</span><span class=\"pl-s\">'TRUE'</span>, <span class=\"pl-s1\">nullable</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">False</span>)\n    <span class=\"pl-s1\">created</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Column</span>(<span class=\"pl-v\">TIMESTAMP</span>(<span class=\"pl-s1\">timezone</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">True</span>), <span class=\"pl-s1\">nullable</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">False</span>, <span class=\"pl-s1\">server_default</span><span class=\"pl-c1\">=</span><span class=\"pl-en\">text</span>(<span class=\"pl-s\">'now()'</span>))</pre></div>\n<p dir=\"auto\">This defines the structure of the data that will be stored in the database. It is used to validate the data that will be stored in the database.\nIt also creates the table in the database.</p>\n<p dir=\"auto\">The two are different, while we don't need the pydantic model, it's useful since it allows us to validate the data sent to the server and the data sent back to the user and when it comes to api's, we want to be safe as possible.</p>\n<h3 tabindex=\"-1\" id=\"user-content-separating-the-schemas\" dir=\"auto\"><a class=\"heading-link\" href=\"#separating-the-schemas\">separating the schemas<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class CreatePost(BaseModel):\n    title: str\n    content: str\n    published: bool = True\n\n# we want the user while updating, to pass all the items\nclass UpdatePost(BaseModel):\n    title: str\n    content: str\n    published: bool\"><pre><span class=\"pl-k\">class</span> <span class=\"pl-v\">CreatePost</span>(<span class=\"pl-v\">BaseModel</span>):\n    <span class=\"pl-s1\">title</span>: <span class=\"pl-s1\">str</span>\n    <span class=\"pl-s1\">content</span>: <span class=\"pl-s1\">str</span>\n    <span class=\"pl-s1\">published</span>: <span class=\"pl-s1\">bool</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">True</span>\n\n<span class=\"pl-c\"># we want the user while updating, to pass all the items</span>\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">UpdatePost</span>(<span class=\"pl-v\">BaseModel</span>):\n    <span class=\"pl-s1\">title</span>: <span class=\"pl-s1\">str</span>\n    <span class=\"pl-s1\">content</span>: <span class=\"pl-s1\">str</span>\n    <span class=\"pl-s1\">published</span>: <span class=\"pl-s1\">bool</span></pre></div>\n<h4 tabindex=\"-1\" id=\"user-content-reason\" dir=\"auto\"><a class=\"heading-link\" href=\"#reason\">REASON<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h4>\n<p dir=\"auto\">We have the above schemas separate from the main file. To avoid clutter.\nWe have more that one schema above that represent similar data but for different api routes, this is because, sometimes you want the the data a user can update to be different from that of the one they can create.</p>\n<p dir=\"auto\">IN the above snippet, the user is expected to pass all the values while updating, but when creating, the user is not expected to pass the published value, it is optional and has a default value of True.</p>\n<p dir=\"auto\">If we wanted the user to only update on item we could:</p>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class UpdatePost(BaseModel):\n    title: str\"><pre><span class=\"pl-k\">class</span> <span class=\"pl-v\">UpdatePost</span>(<span class=\"pl-v\">BaseModel</span>):\n    <span class=\"pl-s1\">title</span>: <span class=\"pl-s1\">str</span></pre></div>\n<p dir=\"auto\">Here the user can only update the title alone.</p>\n<h3 tabindex=\"-1\" id=\"user-content-a-better-way-to-structure-multiple-related-schemas\" dir=\"auto\"><a class=\"heading-link\" href=\"#a-better-way-to-structure-multiple-related-schemas\">A better way to structure multiple related schemas<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class PostBase(BaseModel):\n    title: str\n    content: str\n    published: bool = True\n\nclass PostCreate(PostBase):\n    pass\"><pre><span class=\"pl-k\">class</span> <span class=\"pl-v\">PostBase</span>(<span class=\"pl-v\">BaseModel</span>):\n    <span class=\"pl-s1\">title</span>: <span class=\"pl-s1\">str</span>\n    <span class=\"pl-s1\">content</span>: <span class=\"pl-s1\">str</span>\n    <span class=\"pl-s1\">published</span>: <span class=\"pl-s1\">bool</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">True</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">PostCreate</span>(<span class=\"pl-v\">PostBase</span>):\n    <span class=\"pl-k\">pass</span></pre></div>\n<p dir=\"auto\">This way, the <strong>PostCreaet</strong> has all the atributes of PostBase using the <strong>pass</strong> keyword. If we wanted to change the default value of published, we could do so in the <strong>PostCreate</strong> class.</p>\n<hr>\n<hr>\n<h2 tabindex=\"-1\" id=\"user-content-sending-a-response-back\" dir=\"auto\"><a class=\"heading-link\" href=\"#sending-a-response-back\">SENDING A RESPONSE BACK<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h2>\n<p dir=\"auto\">Defining a pydantic schema that will define the structure of the data that will be sent back to the user.\nThis is relevant because sometimes we may want to send only pieces of data back to the user and not the entire data.</p>\n<p dir=\"auto\">Example: When a user creates an account, we don't want to send them back their password but we may want to send them their username and email.</p>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class PostResp(BaseModel):\n    title: str\n    content: str\n    published: bool\n\n    class Config:\n        orm_mode = True\"><pre><span class=\"pl-k\">class</span> <span class=\"pl-v\">PostResp</span>(<span class=\"pl-v\">BaseModel</span>):\n    <span class=\"pl-s1\">title</span>: <span class=\"pl-s1\">str</span>\n    <span class=\"pl-s1\">content</span>: <span class=\"pl-s1\">str</span>\n    <span class=\"pl-s1\">published</span>: <span class=\"pl-s1\">bool</span>\n\n    <span class=\"pl-k\">class</span> <span class=\"pl-v\">Config</span>:\n        <span class=\"pl-s1\">orm_mode</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">True</span></pre></div>\n<p dir=\"auto\">Now to use this:</p>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"@app.post(&quot;/posts&quot;, status_code=status.HTTP_201_CREATED, response_model=schemas.PostResp)\ndef create_post(post: schemas.PostCreate, db: Session = Depends(get_db)):\n    new_post = models.Post(**post.dict())\n\n    db.add(new_post)\n    db.commit()\n    db.refresh(new_post)\n    return new_post\"><pre><span class=\"pl-en\">@<span class=\"pl-s1\">app</span>.<span class=\"pl-en\">post</span>(<span class=\"pl-s\">\"/posts\"</span>, <span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">status</span>.<span class=\"pl-v\">HTTP_201_CREATED</span>, <span class=\"pl-s1\">response_model</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">schemas</span>.<span class=\"pl-v\">PostResp</span>)</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">create_post</span>(<span class=\"pl-s1\">post</span>: <span class=\"pl-s1\">schemas</span>.<span class=\"pl-v\">PostCreate</span>, <span class=\"pl-s1\">db</span>: <span class=\"pl-v\">Session</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Depends</span>(<span class=\"pl-s1\">get_db</span>)):\n    <span class=\"pl-s1\">new_post</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">models</span>.<span class=\"pl-v\">Post</span>(<span class=\"pl-c1\">**</span><span class=\"pl-s1\">post</span>.<span class=\"pl-en\">dict</span>())\n\n    <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">add</span>(<span class=\"pl-s1\">new_post</span>)\n    <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">commit</span>()\n    <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">refresh</span>(<span class=\"pl-s1\">new_post</span>)\n    <span class=\"pl-k\">return</span> <span class=\"pl-s1\">new_post</span></pre></div>\n<p dir=\"auto\">When we create a new field now, the data we send back to the user only has three fields, the <strong>timestamp</strong> field is not sent back to the user since we did not include it in the <strong>PostResp</strong> schema.</p>\n<p dir=\"auto\">to include the timestamp field, we can add it to the <strong>PostResp</strong> schema.</p>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"from datetime import datetime\n\nclass PostResp(BaseModel):\n    title: str\n    content: str\n    published: bool\n    created: datetime\n\n    class Config:\n        orm_mode = True\"><pre><span class=\"pl-k\">from</span> <span class=\"pl-s1\">datetime</span> <span class=\"pl-k\">import</span> <span class=\"pl-s1\">datetime</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">PostResp</span>(<span class=\"pl-v\">BaseModel</span>):\n    <span class=\"pl-s1\">title</span>: <span class=\"pl-s1\">str</span>\n    <span class=\"pl-s1\">content</span>: <span class=\"pl-s1\">str</span>\n    <span class=\"pl-s1\">published</span>: <span class=\"pl-s1\">bool</span>\n    <span class=\"pl-s1\">created</span>: <span class=\"pl-s1\">datetime</span>\n\n    <span class=\"pl-k\">class</span> <span class=\"pl-v\">Config</span>:\n        <span class=\"pl-s1\">orm_mode</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">True</span></pre></div>\n<p dir=\"auto\">to limit duplication, you can extend any class and add the fields you want to add.\nwe will inherit the <strong>PostBase</strong> class and add the <strong>created</strong> field to it.</p>\n<p dir=\"auto\">the <strong>postbase</strong> class has the <strong>title</strong>, <strong>content</strong> and <strong>published</strong> fields.</p>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class PostBase(PostBase):\n    created: datetime\n\n    class Config:\n        orm_mode = True\"><pre><span class=\"pl-k\">class</span> <span class=\"pl-v\">PostBase</span>(<span class=\"pl-v\">PostBase</span>):\n    <span class=\"pl-s1\">created</span>: <span class=\"pl-s1\">datetime</span>\n\n    <span class=\"pl-k\">class</span> <span class=\"pl-v\">Config</span>:\n        <span class=\"pl-s1\">orm_mode</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">True</span></pre></div>\n<p dir=\"auto\">When it comes to retrieving all responses with the defined response schema:</p>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"\n@app.get(&quot;/posts&quot;, response_model=list[schemas.PostResp])\ndef get_posts(db: Session = Depends(get_db)):\n    my_posts = db.query(models.Post).all()\n    return my_posts\"><pre><span class=\"pl-en\">@<span class=\"pl-s1\">app</span>.<span class=\"pl-en\">get</span>(<span class=\"pl-s\">\"/posts\"</span>, <span class=\"pl-s1\">response_model</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">list</span>[<span class=\"pl-s1\">schemas</span>.<span class=\"pl-v\">PostResp</span>])</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">get_posts</span>(<span class=\"pl-s1\">db</span>: <span class=\"pl-v\">Session</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Depends</span>(<span class=\"pl-s1\">get_db</span>)):\n    <span class=\"pl-s1\">my_posts</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">query</span>(<span class=\"pl-s1\">models</span>.<span class=\"pl-v\">Post</span>).<span class=\"pl-en\">all</span>()\n    <span class=\"pl-k\">return</span> <span class=\"pl-s1\">my_posts</span></pre></div>\n<p dir=\"auto\">We have to use the <strong>list</strong> keyword to tell fastapi that we are returning a list of items.</p>\n<h1 tabindex=\"-1\" id=\"user-content-user-functionality\" dir=\"auto\"><a class=\"heading-link\" href=\"#user-functionality\">USER FUNCTIONALITY<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h1>\n<h2 tabindex=\"-1\" id=\"user-content-creating-a-user\" dir=\"auto\"><a class=\"heading-link\" href=\"#creating-a-user\">Creating a User<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h2>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class UserCreate(BaseModel):\n    email: EmailStr\n    password: str\n\nclass UserResp(BaseModel):\n    id: int\n    email: EmailStr\n    created_at: datetime\n\n    class Config:\n        orm_mode = True\n\n@app.post(&quot;/users&quot;, status_code=status.HTTP_201_CREATED, response_model=schemas.UserResp)\ndef create_user(user: schemas.UserCreate, db: Session = Depends(get_db)):\n    hashed_password = pwd_context.hash(user.password)\n    user.password = hashed_password\n    \n    new_user = models.User(**user.dict())\n\n    db.add(new_user)\n    db.commit()\n    db.refresh(new_user)\n    return new_user\"><pre><span class=\"pl-k\">class</span> <span class=\"pl-v\">UserCreate</span>(<span class=\"pl-v\">BaseModel</span>):\n    <span class=\"pl-s1\">email</span>: <span class=\"pl-v\">EmailStr</span>\n    <span class=\"pl-s1\">password</span>: <span class=\"pl-s1\">str</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">UserResp</span>(<span class=\"pl-v\">BaseModel</span>):\n    <span class=\"pl-s1\">id</span>: <span class=\"pl-s1\">int</span>\n    <span class=\"pl-s1\">email</span>: <span class=\"pl-v\">EmailStr</span>\n    <span class=\"pl-s1\">created_at</span>: <span class=\"pl-s1\">datetime</span>\n\n    <span class=\"pl-k\">class</span> <span class=\"pl-v\">Config</span>:\n        <span class=\"pl-s1\">orm_mode</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">True</span>\n\n<span class=\"pl-en\">@<span class=\"pl-s1\">app</span>.<span class=\"pl-en\">post</span>(<span class=\"pl-s\">\"/users\"</span>, <span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">status</span>.<span class=\"pl-v\">HTTP_201_CREATED</span>, <span class=\"pl-s1\">response_model</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">schemas</span>.<span class=\"pl-v\">UserResp</span>)</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">create_user</span>(<span class=\"pl-s1\">user</span>: <span class=\"pl-s1\">schemas</span>.<span class=\"pl-v\">UserCreate</span>, <span class=\"pl-s1\">db</span>: <span class=\"pl-v\">Session</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Depends</span>(<span class=\"pl-s1\">get_db</span>)):\n    <span class=\"pl-s1\">hashed_password</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">pwd_context</span>.<span class=\"pl-en\">hash</span>(<span class=\"pl-s1\">user</span>.<span class=\"pl-s1\">password</span>)\n    <span class=\"pl-s1\">user</span>.<span class=\"pl-s1\">password</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">hashed_password</span>\n    \n    <span class=\"pl-s1\">new_user</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">models</span>.<span class=\"pl-v\">User</span>(<span class=\"pl-c1\">**</span><span class=\"pl-s1\">user</span>.<span class=\"pl-en\">dict</span>())\n\n    <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">add</span>(<span class=\"pl-s1\">new_user</span>)\n    <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">commit</span>()\n    <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">refresh</span>(<span class=\"pl-s1\">new_user</span>)\n    <span class=\"pl-k\">return</span> <span class=\"pl-s1\">new_user</span></pre></div>\n<hr>\n<hr>\n<h3 tabindex=\"-1\" id=\"user-content-fetching-user-data\" dir=\"auto\"><a class=\"heading-link\" href=\"#fetching-user-data\">fetching user data<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"@app.get(&quot;/users/{id}&quot;, response_model=schemas.UserResp)\ndef get_user(id: int, db: Session = Depends(get_db)):\n    user = db.query(models.User).filter(models.User.id == id).first()\n\n    if not user:\n        raise HTTPException(status_code=404, detail=f&quot;User of id {id} not found&quot;)\n    return user\"><pre><span class=\"pl-en\">@<span class=\"pl-s1\">app</span>.<span class=\"pl-en\">get</span>(<span class=\"pl-s\">\"/users/{id}\"</span>, <span class=\"pl-s1\">response_model</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">schemas</span>.<span class=\"pl-v\">UserResp</span>)</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">get_user</span>(<span class=\"pl-s1\">id</span>: <span class=\"pl-s1\">int</span>, <span class=\"pl-s1\">db</span>: <span class=\"pl-v\">Session</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Depends</span>(<span class=\"pl-s1\">get_db</span>)):\n    <span class=\"pl-s1\">user</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">query</span>(<span class=\"pl-s1\">models</span>.<span class=\"pl-v\">User</span>).<span class=\"pl-en\">filter</span>(<span class=\"pl-s1\">models</span>.<span class=\"pl-v\">User</span>.<span class=\"pl-s1\">id</span> <span class=\"pl-c1\">==</span> <span class=\"pl-s1\">id</span>).<span class=\"pl-en\">first</span>()\n\n    <span class=\"pl-k\">if</span> <span class=\"pl-c1\">not</span> <span class=\"pl-s1\">user</span>:\n        <span class=\"pl-k\">raise</span> <span class=\"pl-v\">HTTPException</span>(<span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">404</span>, <span class=\"pl-s1\">detail</span><span class=\"pl-c1\">=</span><span class=\"pl-s\">f\"User of id <span class=\"pl-s1\"><span class=\"pl-kos\">{</span><span class=\"pl-s1\">id</span><span class=\"pl-kos\">}</span></span> not found\"</span>)\n    <span class=\"pl-k\">return</span> <span class=\"pl-s1\">user</span></pre></div>\n<h2 tabindex=\"-1\" id=\"user-content-routers\" dir=\"auto\"><a class=\"heading-link\" href=\"#routers\">ROUTERS<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h2>\n<p dir=\"auto\">They will help us to separate our routes into different files. This will help us to avoid cluttering our main file.</p>\n<p dir=\"auto\"><code>main.py</code></p>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"app.include_router(post.router)\napp.include_router(users.router)\"><pre><span class=\"pl-s1\">app</span>.<span class=\"pl-en\">include_router</span>(<span class=\"pl-s1\">post</span>.<span class=\"pl-s1\">router</span>)\n<span class=\"pl-s1\">app</span>.<span class=\"pl-en\">include_router</span>(<span class=\"pl-s1\">users</span>.<span class=\"pl-s1\">router</span>)</pre></div>\n<p dir=\"auto\"><code>post.py</code></p>\n<p dir=\"auto\"><strong>THE PREFIX IS OPTIONAL - WHILE I HAVE USED IT IN THE LEARNING PROCESS, I DO NOT PREFER TO USE IT IN MY PROJECTS</strong></p>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"router = APIRouter(\n    prefix=&quot;/posts&quot;,\n)\n\n\n@router.get(&quot;/&quot;, response_model=list[schemas.PostResp])\ndef get_posts(db: Session = Depends(get_db)):\n    my_posts = db.query(models.Post).all()\n    return my_posts\n\n\n@router.post(&quot;/&quot;, status_code=status.HTTP_201_CREATED, response_model=schemas.PostResp)\ndef create_post(post: schemas.PostCreate, db: Session = Depends(get_db)):\n    new_post = models.Post(**post.dict())\n\n    db.add(new_post)\n    db.commit()\n    db.refresh(new_post)\n    return new_post\"><pre><span class=\"pl-s1\">router</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">APIRouter</span>(\n    <span class=\"pl-s1\">prefix</span><span class=\"pl-c1\">=</span><span class=\"pl-s\">\"/posts\"</span>,\n)\n\n\n<span class=\"pl-en\">@<span class=\"pl-s1\">router</span>.<span class=\"pl-en\">get</span>(<span class=\"pl-s\">\"/\"</span>, <span class=\"pl-s1\">response_model</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">list</span>[<span class=\"pl-s1\">schemas</span>.<span class=\"pl-v\">PostResp</span>])</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">get_posts</span>(<span class=\"pl-s1\">db</span>: <span class=\"pl-v\">Session</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Depends</span>(<span class=\"pl-s1\">get_db</span>)):\n    <span class=\"pl-s1\">my_posts</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">query</span>(<span class=\"pl-s1\">models</span>.<span class=\"pl-v\">Post</span>).<span class=\"pl-en\">all</span>()\n    <span class=\"pl-k\">return</span> <span class=\"pl-s1\">my_posts</span>\n\n\n<span class=\"pl-en\">@<span class=\"pl-s1\">router</span>.<span class=\"pl-en\">post</span>(<span class=\"pl-s\">\"/\"</span>, <span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">status</span>.<span class=\"pl-v\">HTTP_201_CREATED</span>, <span class=\"pl-s1\">response_model</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">schemas</span>.<span class=\"pl-v\">PostResp</span>)</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">create_post</span>(<span class=\"pl-s1\">post</span>: <span class=\"pl-s1\">schemas</span>.<span class=\"pl-v\">PostCreate</span>, <span class=\"pl-s1\">db</span>: <span class=\"pl-v\">Session</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Depends</span>(<span class=\"pl-s1\">get_db</span>)):\n    <span class=\"pl-s1\">new_post</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">models</span>.<span class=\"pl-v\">Post</span>(<span class=\"pl-c1\">**</span><span class=\"pl-s1\">post</span>.<span class=\"pl-en\">dict</span>())\n\n    <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">add</span>(<span class=\"pl-s1\">new_post</span>)\n    <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">commit</span>()\n    <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">refresh</span>(<span class=\"pl-s1\">new_post</span>)\n    <span class=\"pl-k\">return</span> <span class=\"pl-s1\">new_post</span></pre></div>\n<h3 tabindex=\"-1\" id=\"user-content-styling-the-docs-so-that-all-routes-are-sectioned-according-to-their-actions\" dir=\"auto\"><a class=\"heading-link\" href=\"#styling-the-docs-so-that-all-routes-are-sectioned-according-to-their-actions\">STYLING THE DOCS SO THAT ALL ROUTES ARE SECTIONED ACCORDING TO THEIR ACTIONS<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\"><code>users.py</code></p>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"router = APIRouter(\n    tags=[&quot;users&quot;]\n)\"><pre><span class=\"pl-s1\">router</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">APIRouter</span>(\n    <span class=\"pl-s1\">tags</span><span class=\"pl-c1\">=</span>[<span class=\"pl-s\">\"users\"</span>]\n)</pre></div>\n<p dir=\"auto\"><code>post.py</code></p>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"router = APIRouter(\n    tags=[&quot;posts&quot;]\n)\"><pre><span class=\"pl-s1\">router</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">APIRouter</span>(\n    <span class=\"pl-s1\">tags</span><span class=\"pl-c1\">=</span>[<span class=\"pl-s\">\"posts\"</span>]\n)</pre></div>\n<hr>\n<h1 tabindex=\"-1\" id=\"user-content-important-section\" dir=\"auto\"><a class=\"heading-link\" href=\"#important-section\">IMPORTANT SECTION<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h1>\n<hr>\n<h2 tabindex=\"-1\" id=\"user-content-authentication\" dir=\"auto\"><a class=\"heading-link\" href=\"#authentication\">AUTHENTICATION<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h2>\n<p dir=\"auto\">There are two ways of authenticating users, <strong>session</strong> and <strong>token</strong> authentication.</p>\n<h2 tabindex=\"-1\" id=\"user-content-jwt-token-authentication\" dir=\"auto\"><a class=\"heading-link\" href=\"#jwt-token-authentication\">JWT TOKEN AUTHENTICATION<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h2>\n<p dir=\"auto\">We will use the jwt token authentication since its stateless and we don't have to store the token in the database nor in the api server. It is stored in the client side.</p>\n<h4 tabindex=\"-1\" id=\"user-content-how-its-used\" dir=\"auto\"><a class=\"heading-link\" href=\"#how-its-used\">How it's used<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h4>\n<p dir=\"auto\">The user logs in with their credentials and then they are assigned a <strong>token</strong> which they will use to access the protected routes. The token is sent to the server with every request in the <strong>header</strong> and the server will verify the token and if it's valid, it will grant the user access to the protected routes.</p>\n<p dir=\"auto\">In the Jwt, when sending the token to the server, be careful witht the data you pass to the <strong>payload</strong>, it is not encrypted and can be decoded by anyone. Don't pass sensitive data to the payload. Also do not jam alot of info in the payload, it will make the token large and it will take time to send it to the server.</p>\n<h3 tabindex=\"-1\" id=\"user-content-logging-user\" dir=\"auto\"><a class=\"heading-link\" href=\"#logging-user\">logging user<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\"><code>routes/auth.py</code></p>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"from fastapi import APIRouter, Depends, HTTPException, status\nfrom sqlalchemy.orm import Session\n\nfrom .. import schemas, database, models, utils\n\nrouter = APIRouter(\n    tags = ['Authentication']\n)\n\n@router.post('/login')\ndef login(user_credentials: schemas.UserLogin, db: Session = Depends(database.get_db)):\n    user = db.query(models.User).filter(models.User.email == user_credentials.email).first()\n\n    if not user:\n        raise HTTPException(status_code=status.HTTP_404_NOT_FOUND, detail=f&quot;Invalid credentials&quot;)\n\n    if not utils.verify(user_credentials.password):\n        raise HTTPException(status_code=status.HTTP_404_NOT_FOUND, detail=&quot;Incorrect credentials&quot;)\n\n    \n\n    return user\"><pre><span class=\"pl-k\">from</span> <span class=\"pl-s1\">fastapi</span> <span class=\"pl-k\">import</span> <span class=\"pl-v\">APIRouter</span>, <span class=\"pl-v\">Depends</span>, <span class=\"pl-v\">HTTPException</span>, <span class=\"pl-s1\">status</span>\n<span class=\"pl-k\">from</span> <span class=\"pl-s1\">sqlalchemy</span>.<span class=\"pl-s1\">orm</span> <span class=\"pl-k\">import</span> <span class=\"pl-v\">Session</span>\n\n<span class=\"pl-k\">from</span> .. <span class=\"pl-k\">import</span> <span class=\"pl-s1\">schemas</span>, <span class=\"pl-s1\">database</span>, <span class=\"pl-s1\">models</span>, <span class=\"pl-s1\">utils</span>\n\n<span class=\"pl-s1\">router</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">APIRouter</span>(\n    <span class=\"pl-s1\">tags</span> <span class=\"pl-c1\">=</span> [<span class=\"pl-s\">'Authentication'</span>]\n)\n\n<span class=\"pl-en\">@<span class=\"pl-s1\">router</span>.<span class=\"pl-en\">post</span>(<span class=\"pl-s\">'/login'</span>)</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">login</span>(<span class=\"pl-s1\">user_credentials</span>: <span class=\"pl-s1\">schemas</span>.<span class=\"pl-v\">UserLogin</span>, <span class=\"pl-s1\">db</span>: <span class=\"pl-v\">Session</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Depends</span>(<span class=\"pl-s1\">database</span>.<span class=\"pl-s1\">get_db</span>)):\n    <span class=\"pl-s1\">user</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">query</span>(<span class=\"pl-s1\">models</span>.<span class=\"pl-v\">User</span>).<span class=\"pl-en\">filter</span>(<span class=\"pl-s1\">models</span>.<span class=\"pl-v\">User</span>.<span class=\"pl-s1\">email</span> <span class=\"pl-c1\">==</span> <span class=\"pl-s1\">user_credentials</span>.<span class=\"pl-s1\">email</span>).<span class=\"pl-en\">first</span>()\n\n    <span class=\"pl-k\">if</span> <span class=\"pl-c1\">not</span> <span class=\"pl-s1\">user</span>:\n        <span class=\"pl-k\">raise</span> <span class=\"pl-v\">HTTPException</span>(<span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">status</span>.<span class=\"pl-v\">HTTP_404_NOT_FOUND</span>, <span class=\"pl-s1\">detail</span><span class=\"pl-c1\">=</span><span class=\"pl-s\">f\"Invalid credentials\"</span>)\n\n    <span class=\"pl-k\">if</span> <span class=\"pl-c1\">not</span> <span class=\"pl-s1\">utils</span>.<span class=\"pl-en\">verify</span>(<span class=\"pl-s1\">user_credentials</span>.<span class=\"pl-s1\">password</span>):\n        <span class=\"pl-k\">raise</span> <span class=\"pl-v\">HTTPException</span>(<span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">status</span>.<span class=\"pl-v\">HTTP_404_NOT_FOUND</span>, <span class=\"pl-s1\">detail</span><span class=\"pl-c1\">=</span><span class=\"pl-s\">\"Incorrect credentials\"</span>)\n\n    \n\n    <span class=\"pl-k\">return</span> <span class=\"pl-s1\">user</span></pre></div>\n<hr>\n<h3 tabindex=\"-1\" id=\"user-content-implementing-oauth2\" dir=\"auto\"><a class=\"heading-link\" href=\"#implementing-oauth2\">implementing oauth2<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"pip install python-jose[cryptography]\"><pre>pip install python-jose[cryptography]</pre></div>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"from jose import JWTError, jwt\nfrom datetime import datetime, timedelta\n\n# secret key\n# algorithm\n# expiration time\n\nSECRET_KEY = &quot;b7ffab7e88ff8ec8e6c258944ec6677542bd7a16431ef01c0b78aaea77b26e04&quot;\nALGORITHM = &quot;HS256&quot;\nACCESS_TOKEN_EXPIRE_MINUTES = 30\n\n# payload\ndef create_access_token(data: dict):\n    to_encode = data.copy()\n    expire = datetime.utcnow() + timedelta(minutes=ACCESS_TOKEN_EXPIRE_MINUTES)\n    to_encode.update({&quot;exp&quot;: expire})\n    encoded_jwt = jwt.encode(to_encode, SECRET_KEY, algorithm=ALGORITHM)\n    return encoded_jwt\"><pre><span class=\"pl-k\">from</span> <span class=\"pl-s1\">jose</span> <span class=\"pl-k\">import</span> <span class=\"pl-v\">JWTError</span>, <span class=\"pl-s1\">jwt</span>\n<span class=\"pl-k\">from</span> <span class=\"pl-s1\">datetime</span> <span class=\"pl-k\">import</span> <span class=\"pl-s1\">datetime</span>, <span class=\"pl-s1\">timedelta</span>\n\n<span class=\"pl-c\"># secret key</span>\n<span class=\"pl-c\"># algorithm</span>\n<span class=\"pl-c\"># expiration time</span>\n\n<span class=\"pl-v\">SECRET_KEY</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">\"b7ffab7e88ff8ec8e6c258944ec6677542bd7a16431ef01c0b78aaea77b26e04\"</span>\n<span class=\"pl-v\">ALGORITHM</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">\"HS256\"</span>\n<span class=\"pl-v\">ACCESS_TOKEN_EXPIRE_MINUTES</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">30</span>\n\n<span class=\"pl-c\"># payload</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">create_access_token</span>(<span class=\"pl-s1\">data</span>: <span class=\"pl-s1\">dict</span>):\n    <span class=\"pl-s1\">to_encode</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">data</span>.<span class=\"pl-en\">copy</span>()\n    <span class=\"pl-s1\">expire</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">datetime</span>.<span class=\"pl-en\">utcnow</span>() <span class=\"pl-c1\">+</span> <span class=\"pl-en\">timedelta</span>(<span class=\"pl-s1\">minutes</span><span class=\"pl-c1\">=</span><span class=\"pl-v\">ACCESS_TOKEN_EXPIRE_MINUTES</span>)\n    <span class=\"pl-s1\">to_encode</span>.<span class=\"pl-en\">update</span>({<span class=\"pl-s\">\"exp\"</span>: <span class=\"pl-s1\">expire</span>})\n    <span class=\"pl-s1\">encoded_jwt</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">jwt</span>.<span class=\"pl-en\">encode</span>(<span class=\"pl-s1\">to_encode</span>, <span class=\"pl-v\">SECRET_KEY</span>, <span class=\"pl-s1\">algorithm</span><span class=\"pl-c1\">=</span><span class=\"pl-v\">ALGORITHM</span>)\n    <span class=\"pl-k\">return</span> <span class=\"pl-s1\">encoded_jwt</span></pre></div>\n<p dir=\"auto\"><strong>SECRET_KEY</strong> run the following command to generate a secret key\n<strong>expire</strong> current_time + time_to_expire(30 mins)\n<strong>to_encode.update</strong> is a copy of the data passed to the function and we are adding the expire time to it.</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"openssl rand -hex 32\"><pre>openssl rand -hex 32</pre></div>\n<h3 tabindex=\"-1\" id=\"user-content-update-to-login-route-due-to-oauth2\" dir=\"auto\"><a class=\"heading-link\" href=\"#update-to-login-route-due-to-oauth2\">update to login route due to OAUTH2<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"from fastapi import APIRouter, Depends, HTTPException, status, Response\nfrom fastapi.security.oauth2 import OAuth2PasswordRequestForm\n\n@router.post('/login')\ndef login(user_credentials: OAuth2PasswordRequestForm = Depends(), db: Session = Depends(database.get_db)):\n    user = db.query(models.User).filter(models.User.email == user_credentials.username).first()\n\n    if not user:\n        raise HTTPException(status_code=status.HTTP_404_NOT_FOUND, detail=f&quot;Invalid credentials&quot;)\n\n    if not utils.verify(user_credentials.password, user.password):\n        raise HTTPException(status_code=status.HTTP_404_NOT_FOUND, detail=&quot;Incorrect credentials&quot;)\n\n    # the data we want in the payload to be passed here (email/id/username)\n    access_token = oauth2.create_access_token(data={&quot;user_id&quot;: user.id})\n\n    return {&quot;access_token&quot; : access_token, &quot;token_type&quot;: &quot;bearer&quot;}\"><pre><span class=\"pl-k\">from</span> <span class=\"pl-s1\">fastapi</span> <span class=\"pl-k\">import</span> <span class=\"pl-v\">APIRouter</span>, <span class=\"pl-v\">Depends</span>, <span class=\"pl-v\">HTTPException</span>, <span class=\"pl-s1\">status</span>, <span class=\"pl-v\">Response</span>\n<span class=\"pl-k\">from</span> <span class=\"pl-s1\">fastapi</span>.<span class=\"pl-s1\">security</span>.<span class=\"pl-s1\">oauth2</span> <span class=\"pl-k\">import</span> <span class=\"pl-v\">OAuth2PasswordRequestForm</span>\n\n<span class=\"pl-en\">@<span class=\"pl-s1\">router</span>.<span class=\"pl-en\">post</span>(<span class=\"pl-s\">'/login'</span>)</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">login</span>(<span class=\"pl-s1\">user_credentials</span>: <span class=\"pl-v\">OAuth2PasswordRequestForm</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Depends</span>(), <span class=\"pl-s1\">db</span>: <span class=\"pl-v\">Session</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Depends</span>(<span class=\"pl-s1\">database</span>.<span class=\"pl-s1\">get_db</span>)):\n    <span class=\"pl-s1\">user</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">query</span>(<span class=\"pl-s1\">models</span>.<span class=\"pl-v\">User</span>).<span class=\"pl-en\">filter</span>(<span class=\"pl-s1\">models</span>.<span class=\"pl-v\">User</span>.<span class=\"pl-s1\">email</span> <span class=\"pl-c1\">==</span> <span class=\"pl-s1\">user_credentials</span>.<span class=\"pl-s1\">username</span>).<span class=\"pl-en\">first</span>()\n\n    <span class=\"pl-k\">if</span> <span class=\"pl-c1\">not</span> <span class=\"pl-s1\">user</span>:\n        <span class=\"pl-k\">raise</span> <span class=\"pl-v\">HTTPException</span>(<span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">status</span>.<span class=\"pl-v\">HTTP_404_NOT_FOUND</span>, <span class=\"pl-s1\">detail</span><span class=\"pl-c1\">=</span><span class=\"pl-s\">f\"Invalid credentials\"</span>)\n\n    <span class=\"pl-k\">if</span> <span class=\"pl-c1\">not</span> <span class=\"pl-s1\">utils</span>.<span class=\"pl-en\">verify</span>(<span class=\"pl-s1\">user_credentials</span>.<span class=\"pl-s1\">password</span>, <span class=\"pl-s1\">user</span>.<span class=\"pl-s1\">password</span>):\n        <span class=\"pl-k\">raise</span> <span class=\"pl-v\">HTTPException</span>(<span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">status</span>.<span class=\"pl-v\">HTTP_404_NOT_FOUND</span>, <span class=\"pl-s1\">detail</span><span class=\"pl-c1\">=</span><span class=\"pl-s\">\"Incorrect credentials\"</span>)\n\n    <span class=\"pl-c\"># the data we want in the payload to be passed here (email/id/username)</span>\n    <span class=\"pl-s1\">access_token</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">oauth2</span>.<span class=\"pl-en\">create_access_token</span>(<span class=\"pl-s1\">data</span><span class=\"pl-c1\">=</span>{<span class=\"pl-s\">\"user_id\"</span>: <span class=\"pl-s1\">user</span>.<span class=\"pl-s1\">id</span>})\n\n    <span class=\"pl-k\">return</span> {<span class=\"pl-s\">\"access_token\"</span> : <span class=\"pl-s1\">access_token</span>, <span class=\"pl-s\">\"token_type\"</span>: <span class=\"pl-s\">\"bearer\"</span>}</pre></div>\n<p dir=\"auto\">The oauth password request form only returns username and password,so, our email will be stored under username hence we have to adjust our code accordingly.</p>\n<p dir=\"auto\">Now when we are testing the api route, we will no longer user the <strong>body</strong>  section, we will use the <strong>form-data</strong> section.\nWe will enter the username as key and pass the email as the value. We will do the same for the password.</p>\n<h3 tabindex=\"-1\" id=\"user-content-verifying-the-token-its-not-tampered-with-and-not-expired\" dir=\"auto\"><a class=\"heading-link\" href=\"#verifying-the-token-its-not-tampered-with-and-not-expired\">verifying the token (its not tampered with and not expired)<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\">we will start by defining a schema for the token</p>\n<hr>\n<p dir=\"auto\">As long there is data been sent to the api or from it, we will create <strong>schemas</strong> for them to ensure compliance</p>\n<hr>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class Token(BaseModel):\n    access_token: str\n    token_type: str\n\nclass TokenData(BaseModel):\n    user_id: Optional[str] = None\"><pre><span class=\"pl-k\">class</span> <span class=\"pl-v\">Token</span>(<span class=\"pl-v\">BaseModel</span>):\n    <span class=\"pl-s1\">access_token</span>: <span class=\"pl-s1\">str</span>\n    <span class=\"pl-s1\">token_type</span>: <span class=\"pl-s1\">str</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">TokenData</span>(<span class=\"pl-v\">BaseModel</span>):\n    <span class=\"pl-s1\">user_id</span>: <span class=\"pl-v\">Optional</span>[<span class=\"pl-s1\">str</span>] <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">None</span></pre></div>\n<p dir=\"auto\">The token data is what we send to the token creation function as payload. Its optional cause you get to decide what you want to send to the payload.</p>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"def verify_access_token(token: str, credentials_exception):\n    try:\n        payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])\n        _id = payload.get(&quot;user_id&quot;)\n\n        if _id is None:\n            raise credentials_exception\n\n        token_data = schemas.TokenData(_id=user_id)\n    except JWTError:\n        raise credentials_exception\n\ndef get_current_user(token: str = Depends(oauth2_scheme), db: Session = Depends(database.get_db)):\n    credentials_exception = HTTPException(status_code=status.HTTP_401_UNAUTHORIZED, detail=&quot;Invalid credentials&quot;, headers={&quot;WWW-Authenticate&quot;: &quot;Bearer&quot;})\n\n    return verify_access_token(token, credentials_exception)\"><pre><span class=\"pl-k\">def</span> <span class=\"pl-en\">verify_access_token</span>(<span class=\"pl-s1\">token</span>: <span class=\"pl-s1\">str</span>, <span class=\"pl-s1\">credentials_exception</span>):\n    <span class=\"pl-k\">try</span>:\n        <span class=\"pl-s1\">payload</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">jwt</span>.<span class=\"pl-en\">decode</span>(<span class=\"pl-s1\">token</span>, <span class=\"pl-v\">SECRET_KEY</span>, <span class=\"pl-s1\">algorithms</span><span class=\"pl-c1\">=</span>[<span class=\"pl-v\">ALGORITHM</span>])\n        <span class=\"pl-s1\">_id</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">payload</span>.<span class=\"pl-en\">get</span>(<span class=\"pl-s\">\"user_id\"</span>)\n\n        <span class=\"pl-k\">if</span> <span class=\"pl-s1\">_id</span> <span class=\"pl-c1\">is</span> <span class=\"pl-c1\">None</span>:\n            <span class=\"pl-k\">raise</span> <span class=\"pl-s1\">credentials_exception</span>\n\n        <span class=\"pl-s1\">token_data</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">schemas</span>.<span class=\"pl-v\">TokenData</span>(<span class=\"pl-s1\">_id</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">user_id</span>)\n    <span class=\"pl-k\">except</span> <span class=\"pl-v\">JWTError</span>:\n        <span class=\"pl-k\">raise</span> <span class=\"pl-s1\">credentials_exception</span>\n\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">get_current_user</span>(<span class=\"pl-s1\">token</span>: <span class=\"pl-s1\">str</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Depends</span>(<span class=\"pl-s1\">oauth2_scheme</span>), <span class=\"pl-s1\">db</span>: <span class=\"pl-v\">Session</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Depends</span>(<span class=\"pl-s1\">database</span>.<span class=\"pl-s1\">get_db</span>)):\n    <span class=\"pl-s1\">credentials_exception</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">HTTPException</span>(<span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">status</span>.<span class=\"pl-v\">HTTP_401_UNAUTHORIZED</span>, <span class=\"pl-s1\">detail</span><span class=\"pl-c1\">=</span><span class=\"pl-s\">\"Invalid credentials\"</span>, <span class=\"pl-s1\">headers</span><span class=\"pl-c1\">=</span>{<span class=\"pl-s\">\"WWW-Authenticate\"</span>: <span class=\"pl-s\">\"Bearer\"</span>})\n\n    <span class=\"pl-k\">return</span> <span class=\"pl-en\">verify_access_token</span>(<span class=\"pl-s1\">token</span>, <span class=\"pl-s1\">credentials_exception</span>)</pre></div>\n<p dir=\"auto\"><strong>return verify_access_token(token, credentials_exception)</strong> returns the token_data on success and raises an error on failure.</p>\n<p dir=\"auto\">To use it to block access to route (protecting a route to authoried users only):</p>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"@router.post(&quot;/&quot;, status_code=status.HTTP_201_CREATED, response_model=schemas.PostResp)\ndef create_post(post: schemas.PostCreate, db: Session = Depends(get_db), user_id: int = Depends(oauth2.get_current_user)):\n    new_post = models.Post(**post.dict())\n\n    db.add(new_post)\n    db.commit()\n    db.refresh(new_post)\n    return new_post\"><pre><span class=\"pl-en\">@<span class=\"pl-s1\">router</span>.<span class=\"pl-en\">post</span>(<span class=\"pl-s\">\"/\"</span>, <span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">status</span>.<span class=\"pl-v\">HTTP_201_CREATED</span>, <span class=\"pl-s1\">response_model</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">schemas</span>.<span class=\"pl-v\">PostResp</span>)</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">create_post</span>(<span class=\"pl-s1\">post</span>: <span class=\"pl-s1\">schemas</span>.<span class=\"pl-v\">PostCreate</span>, <span class=\"pl-s1\">db</span>: <span class=\"pl-v\">Session</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Depends</span>(<span class=\"pl-s1\">get_db</span>), <span class=\"pl-s1\">user_id</span>: <span class=\"pl-s1\">int</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Depends</span>(<span class=\"pl-s1\">oauth2</span>.<span class=\"pl-s1\">get_current_user</span>)):\n    <span class=\"pl-s1\">new_post</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">models</span>.<span class=\"pl-v\">Post</span>(<span class=\"pl-c1\">**</span><span class=\"pl-s1\">post</span>.<span class=\"pl-en\">dict</span>())\n\n    <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">add</span>(<span class=\"pl-s1\">new_post</span>)\n    <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">commit</span>()\n    <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">refresh</span>(<span class=\"pl-s1\">new_post</span>)\n    <span class=\"pl-k\">return</span> <span class=\"pl-s1\">new_post</span></pre></div>\n<p dir=\"auto\">we have added the dependancy to the route, now, when we try to access the route without the token, we will get an error. <strong>get_current_user: int = Depends(oauth2.get_current_user)</strong></p>\n<h3 tabindex=\"-1\" id=\"user-content-testing-2\" dir=\"auto\"><a class=\"heading-link\" href=\"#testing-2\">testing<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\">to test the route with postman, we will first login and get the token, we will then copy the token and paste it in the <strong>Authorization</strong> section of the <strong>Headers</strong> tab. We will then add the <strong>Bearer</strong> keyword before the token.</p>\n<h2 tabindex=\"-1\" id=\"user-content-postman\" dir=\"auto\"><a class=\"heading-link\" href=\"#postman\">POSTMAN<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h2>\n<hr>\n<h3 tabindex=\"-1\" id=\"user-content-environment\" dir=\"auto\"><a class=\"heading-link\" href=\"#environment\">environment<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\">you should also use environments on postman to avoid having to copy and paste the token every time you want to test the route.</p>\n<p dir=\"auto\">i.e: DEV, PROD, TEST</p>\n<h3 tabindex=\"-1\" id=\"user-content-env-variablesaccess_token\" dir=\"auto\"><a class=\"heading-link\" href=\"#env-variablesaccess_token\">env variables/access_token<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\">you can also use global variables to store the token and use it in the headers section.</p>\n<p dir=\"auto\"><strong>setting the env variable</strong></p>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"pm.environment.set(&quot;access_token&quot;, pm.response.json().access_token)\"><pre><span class=\"pl-s1\">pm</span>.<span class=\"pl-s1\">environment</span>.<span class=\"pl-en\">set</span>(<span class=\"pl-s\">\"access_token\"</span>, <span class=\"pl-s1\">pm</span>.<span class=\"pl-s1\">response</span>.<span class=\"pl-en\">json</span>().<span class=\"pl-s1\">access_token</span>)</pre></div>\n<p dir=\"auto\"><strong>retreiving the env variable</strong></p>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{access_token}}\"><pre>{{<span class=\"pl-s1\">access_token</span>}}</pre></div>\n<hr>\n<h1 tabindex=\"-1\" id=\"user-content-relationships\" dir=\"auto\"><a class=\"heading-link\" href=\"#relationships\">RELATIONSHIPS<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h1>\n<p dir=\"auto\">When we are setting up a foreign key so that all the <strong>posts</strong> created get to store the creator we could use our schemas <strong>PostCreate</strong> schema to ensure that the id is passed but in our case, we will use the token auth to extract this, this is because the only person allowed to create a post is one who is logged in, hence we will assign the logged in account the owner status of that post.</p>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"@router.post(&quot;/&quot;, status_code=status.HTTP_201_CREATED, response_model=schemas.PostResp)\ndef create_post(post: schemas.PostCreate, db: Session = Depends(get_db), current_user: int = Depends(oauth2.get_current_user)):\n    new_post = models.Post(owner_id = current_user.id, **post.dict())\n\n    db.add(new_post)\n    db.commit()\n    db.refresh(new_post)\n    return new_post\"><pre><span class=\"pl-en\">@<span class=\"pl-s1\">router</span>.<span class=\"pl-en\">post</span>(<span class=\"pl-s\">\"/\"</span>, <span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">status</span>.<span class=\"pl-v\">HTTP_201_CREATED</span>, <span class=\"pl-s1\">response_model</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">schemas</span>.<span class=\"pl-v\">PostResp</span>)</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">create_post</span>(<span class=\"pl-s1\">post</span>: <span class=\"pl-s1\">schemas</span>.<span class=\"pl-v\">PostCreate</span>, <span class=\"pl-s1\">db</span>: <span class=\"pl-v\">Session</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Depends</span>(<span class=\"pl-s1\">get_db</span>), <span class=\"pl-s1\">current_user</span>: <span class=\"pl-s1\">int</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Depends</span>(<span class=\"pl-s1\">oauth2</span>.<span class=\"pl-s1\">get_current_user</span>)):\n    <span class=\"pl-s1\">new_post</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">models</span>.<span class=\"pl-v\">Post</span>(<span class=\"pl-s1\">owner_id</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">current_user</span>.<span class=\"pl-s1\">id</span>, <span class=\"pl-c1\">**</span><span class=\"pl-s1\">post</span>.<span class=\"pl-en\">dict</span>())\n\n    <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">add</span>(<span class=\"pl-s1\">new_post</span>)\n    <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">commit</span>()\n    <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">refresh</span>(<span class=\"pl-s1\">new_post</span>)\n    <span class=\"pl-k\">return</span> <span class=\"pl-s1\">new_post</span></pre></div>\n<p dir=\"auto\">We will then restrict the <strong>delete</strong> options and <strong>update</strong> routes so that only the owner of the post can delete or update the post.</p>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"@router.delete(&quot;/{id}&quot;, status_code=status.HTTP_204_NO_CONTENT)\ndef delete_post(id: int, db: Session = Depends(get_db), current_user: int = Depends(oauth2.get_current_user)):\n    deleted_post = db.query(models.Post).filter(models.Post.id == id)\n\n    if deleted_post.first() == None:\n        raise HTTPException(status_code=404, detail=f&quot;Post of id {id} not found&quot;)\n\n    if deleted_post.first().owner_id != current_user.id:\n        raise HTTPException(status_code=status.HTTP_403_FORBIDDEN, detail=&quot;You are not authorized to delete this post&quot;)\n\n    deleted_post.delete(synchronize_session=False)\n    db.commit()\n\n    return Response(status_code=status.HTTP_204_NO_CONTENT)\"><pre><span class=\"pl-en\">@<span class=\"pl-s1\">router</span>.<span class=\"pl-en\">delete</span>(<span class=\"pl-s\">\"/{id}\"</span>, <span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">status</span>.<span class=\"pl-v\">HTTP_204_NO_CONTENT</span>)</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">delete_post</span>(<span class=\"pl-s1\">id</span>: <span class=\"pl-s1\">int</span>, <span class=\"pl-s1\">db</span>: <span class=\"pl-v\">Session</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Depends</span>(<span class=\"pl-s1\">get_db</span>), <span class=\"pl-s1\">current_user</span>: <span class=\"pl-s1\">int</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Depends</span>(<span class=\"pl-s1\">oauth2</span>.<span class=\"pl-s1\">get_current_user</span>)):\n    <span class=\"pl-s1\">deleted_post</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">query</span>(<span class=\"pl-s1\">models</span>.<span class=\"pl-v\">Post</span>).<span class=\"pl-en\">filter</span>(<span class=\"pl-s1\">models</span>.<span class=\"pl-v\">Post</span>.<span class=\"pl-s1\">id</span> <span class=\"pl-c1\">==</span> <span class=\"pl-s1\">id</span>)\n\n    <span class=\"pl-k\">if</span> <span class=\"pl-s1\">deleted_post</span>.<span class=\"pl-en\">first</span>() <span class=\"pl-c1\">==</span> <span class=\"pl-c1\">None</span>:\n        <span class=\"pl-k\">raise</span> <span class=\"pl-v\">HTTPException</span>(<span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">404</span>, <span class=\"pl-s1\">detail</span><span class=\"pl-c1\">=</span><span class=\"pl-s\">f\"Post of id <span class=\"pl-s1\"><span class=\"pl-kos\">{</span><span class=\"pl-s1\">id</span><span class=\"pl-kos\">}</span></span> not found\"</span>)\n\n    <span class=\"pl-k\">if</span> <span class=\"pl-s1\">deleted_post</span>.<span class=\"pl-en\">first</span>().<span class=\"pl-s1\">owner_id</span> <span class=\"pl-c1\">!=</span> <span class=\"pl-s1\">current_user</span>.<span class=\"pl-s1\">id</span>:\n        <span class=\"pl-k\">raise</span> <span class=\"pl-v\">HTTPException</span>(<span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">status</span>.<span class=\"pl-v\">HTTP_403_FORBIDDEN</span>, <span class=\"pl-s1\">detail</span><span class=\"pl-c1\">=</span><span class=\"pl-s\">\"You are not authorized to delete this post\"</span>)\n\n    <span class=\"pl-s1\">deleted_post</span>.<span class=\"pl-en\">delete</span>(<span class=\"pl-s1\">synchronize_session</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">False</span>)\n    <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">commit</span>()\n\n    <span class=\"pl-k\">return</span> <span class=\"pl-v\">Response</span>(<span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">status</span>.<span class=\"pl-v\">HTTP_204_NO_CONTENT</span>)</pre></div>\n<p dir=\"auto\">To return only the posts of the currently logged in user, we will use the <strong>current_user</strong> variable to filter the posts.</p>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"@router.get(&quot;/&quot;, response_model=list[schemas.PostResp])\ndef get_my_posts(db: Session = Depends(get_db), current_user: int = Depends(oauth2.get_current_user)):\n    my_posts = db.query(models.Post).filter(models.Post.owner_id == current_user.id).all()\n    return my_posts\"><pre><span class=\"pl-en\">@<span class=\"pl-s1\">router</span>.<span class=\"pl-en\">get</span>(<span class=\"pl-s\">\"/\"</span>, <span class=\"pl-s1\">response_model</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">list</span>[<span class=\"pl-s1\">schemas</span>.<span class=\"pl-v\">PostResp</span>])</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">get_my_posts</span>(<span class=\"pl-s1\">db</span>: <span class=\"pl-v\">Session</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Depends</span>(<span class=\"pl-s1\">get_db</span>), <span class=\"pl-s1\">current_user</span>: <span class=\"pl-s1\">int</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Depends</span>(<span class=\"pl-s1\">oauth2</span>.<span class=\"pl-s1\">get_current_user</span>)):\n    <span class=\"pl-s1\">my_posts</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">query</span>(<span class=\"pl-s1\">models</span>.<span class=\"pl-v\">Post</span>).<span class=\"pl-en\">filter</span>(<span class=\"pl-s1\">models</span>.<span class=\"pl-v\">Post</span>.<span class=\"pl-s1\">owner_id</span> <span class=\"pl-c1\">==</span> <span class=\"pl-s1\">current_user</span>.<span class=\"pl-s1\">id</span>).<span class=\"pl-en\">all</span>()\n    <span class=\"pl-k\">return</span> <span class=\"pl-s1\">my_posts</span></pre></div>\n<hr>\n<p dir=\"auto\">say we are building a social media application, when users view another persons post, showing them their id will mean nothing to them, what users wants to see is, a username of handle of the person who created it. Since we already have a relationship between the post and the user where we store the owner_id in the post when its created, we can use that relationship to retrieve info about the owner using sqlalchemy.</p>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class Post(Base):\n    __tablename__ = 'posts'\n\n    id = Column(Integer, primary_key=True, nullable=False)\n    title = Column(String(255), nullable=False)\n    content = Column(String, nullable=False)\n    published = Column(Boolean, server_default='TRUE', nullable=False)\n    created = Column(TIMESTAMP(timezone=True), nullable=False, server_default=text('now()'))\n    owner_id = Column(Integer, ForeignKey(&quot;users.id&quot;, ondelete=&quot;CASCADE&quot;), nullable=False)\n    owner = relationship(&quot;User&quot;)\"><pre><span class=\"pl-k\">class</span> <span class=\"pl-v\">Post</span>(<span class=\"pl-v\">Base</span>):\n    <span class=\"pl-s1\">__tablename__</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">'posts'</span>\n\n    <span class=\"pl-s1\">id</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Column</span>(<span class=\"pl-v\">Integer</span>, <span class=\"pl-s1\">primary_key</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">True</span>, <span class=\"pl-s1\">nullable</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">False</span>)\n    <span class=\"pl-s1\">title</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Column</span>(<span class=\"pl-v\">String</span>(<span class=\"pl-c1\">255</span>), <span class=\"pl-s1\">nullable</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">False</span>)\n    <span class=\"pl-s1\">content</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Column</span>(<span class=\"pl-v\">String</span>, <span class=\"pl-s1\">nullable</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">False</span>)\n    <span class=\"pl-s1\">published</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Column</span>(<span class=\"pl-v\">Boolean</span>, <span class=\"pl-s1\">server_default</span><span class=\"pl-c1\">=</span><span class=\"pl-s\">'TRUE'</span>, <span class=\"pl-s1\">nullable</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">False</span>)\n    <span class=\"pl-s1\">created</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Column</span>(<span class=\"pl-v\">TIMESTAMP</span>(<span class=\"pl-s1\">timezone</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">True</span>), <span class=\"pl-s1\">nullable</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">False</span>, <span class=\"pl-s1\">server_default</span><span class=\"pl-c1\">=</span><span class=\"pl-en\">text</span>(<span class=\"pl-s\">'now()'</span>))\n    <span class=\"pl-s1\">owner_id</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Column</span>(<span class=\"pl-v\">Integer</span>, <span class=\"pl-v\">ForeignKey</span>(<span class=\"pl-s\">\"users.id\"</span>, <span class=\"pl-s1\">ondelete</span><span class=\"pl-c1\">=</span><span class=\"pl-s\">\"CASCADE\"</span>), <span class=\"pl-s1\">nullable</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">False</span>)\n    <span class=\"pl-s1\">owner</span> <span class=\"pl-c1\">=</span> <span class=\"pl-en\">relationship</span>(<span class=\"pl-s\">\"User\"</span>)</pre></div>\n<p dir=\"auto\">We have added the owner field and the relationship reference to the user model.\nTo make sure  that information is sent back, we ahave to update our <strong>postResp schema</strong> to include the owner field.</p>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class PostResp(PostBase):\n    id: int\n    created: datetime\n    owner_id: int\n    owner: UserResp\"><pre><span class=\"pl-k\">class</span> <span class=\"pl-v\">PostResp</span>(<span class=\"pl-v\">PostBase</span>):\n    <span class=\"pl-s1\">id</span>: <span class=\"pl-s1\">int</span>\n    <span class=\"pl-s1\">created</span>: <span class=\"pl-s1\">datetime</span>\n    <span class=\"pl-s1\">owner_id</span>: <span class=\"pl-s1\">int</span>\n    <span class=\"pl-s1\">owner</span>: <span class=\"pl-v\">UserResp</span></pre></div>\n<p dir=\"auto\">Now when there is a post response, the structure above will be used, and owner above is of type <strong>UserResp</strong> which is a schema that defines the structure of the data that will be sent back to the user.</p>\n<hr>\n<hr>\n<h1 tabindex=\"-1\" id=\"user-content-query-parameters\" dir=\"auto\"><a class=\"heading-link\" href=\"#query-parameters\">QUERY PARAMETERS<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h1>\n<p dir=\"auto\">They are used to filter data. They are passed in the url.</p>\n<p dir=\"auto\">Query parameters will help with api pagination. We will use the <strong>limit</strong> and <strong>offset</strong> query parameters to achieve this.</p>\n<h3 tabindex=\"-1\" id=\"user-content-limit\" dir=\"auto\"><a class=\"heading-link\" href=\"#limit\">LIMIT<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"@router.get(&quot;/&quot;, response_model=list[schemas.PostResp])\ndef get_posts(db: Session = Depends(get_db), current_user: int = Depends(oauth2.get_current_user), limit: int = 10):\n    my_posts = db.query(models.Post).limit(limit).all()\n    return my_posts\"><pre><span class=\"pl-en\">@<span class=\"pl-s1\">router</span>.<span class=\"pl-en\">get</span>(<span class=\"pl-s\">\"/\"</span>, <span class=\"pl-s1\">response_model</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">list</span>[<span class=\"pl-s1\">schemas</span>.<span class=\"pl-v\">PostResp</span>])</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">get_posts</span>(<span class=\"pl-s1\">db</span>: <span class=\"pl-v\">Session</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Depends</span>(<span class=\"pl-s1\">get_db</span>), <span class=\"pl-s1\">current_user</span>: <span class=\"pl-s1\">int</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Depends</span>(<span class=\"pl-s1\">oauth2</span>.<span class=\"pl-s1\">get_current_user</span>), <span class=\"pl-s1\">limit</span>: <span class=\"pl-s1\">int</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">10</span>):\n    <span class=\"pl-s1\">my_posts</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">query</span>(<span class=\"pl-s1\">models</span>.<span class=\"pl-v\">Post</span>).<span class=\"pl-en\">limit</span>(<span class=\"pl-s1\">limit</span>).<span class=\"pl-en\">all</span>()\n    <span class=\"pl-k\">return</span> <span class=\"pl-s1\">my_posts</span></pre></div>\n<p dir=\"auto\">here we have a limit parameter with a default value of ten, when a user does not pass a alue to the limit, the 10 posts will be displayed but when they pass a value, that value will be used.</p>\n<h3 tabindex=\"-1\" id=\"user-content-skipoffset\" dir=\"auto\"><a class=\"heading-link\" href=\"#skipoffset\">SKIP/OFFSET<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\">Here a user can pass a value to the skip parameter and the number of posts skipped will be equal to the value passed.</p>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"@router.get(&quot;/&quot;, response_model=list[schemas.PostResp])\ndef get_posts(db: Session = Depends(get_db), current_user: int = Depends(oauth2.get_current_user), limit: int = 10, skip: int = 0):\n    my_posts = db.query(models.Post).limit(limit).offset(skip).all()\n    return my_posts\"><pre><span class=\"pl-en\">@<span class=\"pl-s1\">router</span>.<span class=\"pl-en\">get</span>(<span class=\"pl-s\">\"/\"</span>, <span class=\"pl-s1\">response_model</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">list</span>[<span class=\"pl-s1\">schemas</span>.<span class=\"pl-v\">PostResp</span>])</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">get_posts</span>(<span class=\"pl-s1\">db</span>: <span class=\"pl-v\">Session</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Depends</span>(<span class=\"pl-s1\">get_db</span>), <span class=\"pl-s1\">current_user</span>: <span class=\"pl-s1\">int</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Depends</span>(<span class=\"pl-s1\">oauth2</span>.<span class=\"pl-s1\">get_current_user</span>), <span class=\"pl-s1\">limit</span>: <span class=\"pl-s1\">int</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">10</span>, <span class=\"pl-s1\">skip</span>: <span class=\"pl-s1\">int</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">0</span>):\n    <span class=\"pl-s1\">my_posts</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">query</span>(<span class=\"pl-s1\">models</span>.<span class=\"pl-v\">Post</span>).<span class=\"pl-en\">limit</span>(<span class=\"pl-s1\">limit</span>).<span class=\"pl-en\">offset</span>(<span class=\"pl-s1\">skip</span>).<span class=\"pl-en\">all</span>()\n    <span class=\"pl-k\">return</span> <span class=\"pl-s1\">my_posts</span></pre></div>\n<p dir=\"auto\"><strong>pagination</strong>\nThese two will come in handy on the frontend consumer, when a user moves from page one to page two, and each page shows 5 items, on page two we should be able to skip the first 5 entries.</p>\n<h3 tabindex=\"-1\" id=\"user-content-search\" dir=\"auto\"><a class=\"heading-link\" href=\"#search\">search<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\">The search keyword below will return all titles that contain the value of search in them.</p>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"@router.get(&quot;/&quot;, response_model=list[schemas.PostResp])\ndef get_posts(db: Session = Depends(get_db), current_user: int = Depends(oauth2.get_current_user), limit: int = 10,\n              skip: int = 0, search: Optional[str] = None):\n    my_posts = db.query(models.Post).filter(models.Post.title.contains(search)).limit(limit).offset(skip).all()\n    return my_posts\"><pre><span class=\"pl-en\">@<span class=\"pl-s1\">router</span>.<span class=\"pl-en\">get</span>(<span class=\"pl-s\">\"/\"</span>, <span class=\"pl-s1\">response_model</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">list</span>[<span class=\"pl-s1\">schemas</span>.<span class=\"pl-v\">PostResp</span>])</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">get_posts</span>(<span class=\"pl-s1\">db</span>: <span class=\"pl-v\">Session</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Depends</span>(<span class=\"pl-s1\">get_db</span>), <span class=\"pl-s1\">current_user</span>: <span class=\"pl-s1\">int</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Depends</span>(<span class=\"pl-s1\">oauth2</span>.<span class=\"pl-s1\">get_current_user</span>), <span class=\"pl-s1\">limit</span>: <span class=\"pl-s1\">int</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">10</span>,\n              <span class=\"pl-s1\">skip</span>: <span class=\"pl-s1\">int</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">0</span>, <span class=\"pl-s1\">search</span>: <span class=\"pl-v\">Optional</span>[<span class=\"pl-s1\">str</span>] <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">None</span>):\n    <span class=\"pl-s1\">my_posts</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">query</span>(<span class=\"pl-s1\">models</span>.<span class=\"pl-v\">Post</span>).<span class=\"pl-en\">filter</span>(<span class=\"pl-s1\">models</span>.<span class=\"pl-v\">Post</span>.<span class=\"pl-s1\">title</span>.<span class=\"pl-en\">contains</span>(<span class=\"pl-s1\">search</span>)).<span class=\"pl-en\">limit</span>(<span class=\"pl-s1\">limit</span>).<span class=\"pl-en\">offset</span>(<span class=\"pl-s1\">skip</span>).<span class=\"pl-en\">all</span>()\n    <span class=\"pl-k\">return</span> <span class=\"pl-s1\">my_posts</span></pre></div>\n<h3 tabindex=\"-1\" id=\"user-content-using-spaces-in-search\" dir=\"auto\"><a class=\"heading-link\" href=\"#using-spaces-in-search\">using spaces in search<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\">When a user searches for a title with spaces, the spaces will be replaced with the <strong>%</strong> sign.\n<code>{{URL}}/posts/?search=hello%20world</code></p>\n<h1 tabindex=\"-1\" id=\"user-content-voting-system\" dir=\"auto\"><a class=\"heading-link\" href=\"#voting-system\">VOTING SYSTEM<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h1>\n<p dir=\"auto\">We will create a voting system where users can vote on posts. We will create a table that will store the votes and the user who voted and the post that was voted on.</p>\n<p dir=\"auto\">one post can be liked by many users\nmany users can like one post\nbut\none user can't like a post more than once</p>\n<h3 tabindex=\"-1\" id=\"user-content-composite-keys\" dir=\"auto\"><a class=\"heading-link\" href=\"#composite-keys\">Composite Keys<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\">We will use composite keys to ensure that a user can't like a post more than once. A composite key is a key that is made up of two or more columns. In our case, the composite key will be the user_id and the post_id.</p>\n<p dir=\"auto\">i.e</p>\n<p dir=\"auto\">say we have a table with post_id and user_id, what composite keys does, is ensure the whole row is unique, so, if a user likes a post, the row will be unique, if they like it again, the row will not be unique and the database will throw an error.\nThere can't be any other row that looks like the other.</p>\n<p dir=\"auto\">unlike a primary key which only ensures that the column is unique.(one element in the column is unique)</p>\n<p dir=\"auto\"><code>vote.py</code></p>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"from fastapi import FastAPI, Request, Response, status, APIRouter, Depends, HTTPException\nfrom .. import models, database, schemas, oauth2\nfrom sqlalchemy.orm import Session\n\nrouter = APIRouter(\n    prefix=&quot;/vote&quot;,\n    tags=[&quot;Vote&quot;],\n)\n\n@router.post(&quot;/&quot;, status_code=status.HTTP_201_CREATED)\ndef vote(vote: schemas.Vote, db: Session = Depends(database.get_db), current_user: int = Depends\n    (oauth2.get_current_user)):\n\n    vote_query = db.query(models.Vote).filter(models.Vote.post_id == vote.post_id, models.Vote.user_id == current_user.id)\n    \n    liked_post = vote_query.first()\n\n    if (vote.direction == 1):\n        if liked_post:\n            raise HTTPException(status_code=status.HTTP_400_BAD_REQUEST, detail=&quot;You already liked this post&quot;)\n        \n        new_vote = models.Vote(user_id=current_user.id, post_id=vote.post_id)\n        db.add(new_vote)\n        db.commit()\n\n        return {&quot;detail&quot;: &quot;Post liked&quot;}\n    else:\n        if not liked_post:\n            raise HTTPException(status_code=status.HTTP_400_BAD_REQUEST, detail=&quot;You haven't liked this post&quot;)\n        \n        vote_query.delete(synchronize_session=False)\n        db.commit()\n\n        return {&quot;detail&quot;: &quot;Post unliked&quot;}\"><pre><span class=\"pl-k\">from</span> <span class=\"pl-s1\">fastapi</span> <span class=\"pl-k\">import</span> <span class=\"pl-v\">FastAPI</span>, <span class=\"pl-v\">Request</span>, <span class=\"pl-v\">Response</span>, <span class=\"pl-s1\">status</span>, <span class=\"pl-v\">APIRouter</span>, <span class=\"pl-v\">Depends</span>, <span class=\"pl-v\">HTTPException</span>\n<span class=\"pl-k\">from</span> .. <span class=\"pl-k\">import</span> <span class=\"pl-s1\">models</span>, <span class=\"pl-s1\">database</span>, <span class=\"pl-s1\">schemas</span>, <span class=\"pl-s1\">oauth2</span>\n<span class=\"pl-k\">from</span> <span class=\"pl-s1\">sqlalchemy</span>.<span class=\"pl-s1\">orm</span> <span class=\"pl-k\">import</span> <span class=\"pl-v\">Session</span>\n\n<span class=\"pl-s1\">router</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">APIRouter</span>(\n    <span class=\"pl-s1\">prefix</span><span class=\"pl-c1\">=</span><span class=\"pl-s\">\"/vote\"</span>,\n    <span class=\"pl-s1\">tags</span><span class=\"pl-c1\">=</span>[<span class=\"pl-s\">\"Vote\"</span>],\n)\n\n<span class=\"pl-en\">@<span class=\"pl-s1\">router</span>.<span class=\"pl-en\">post</span>(<span class=\"pl-s\">\"/\"</span>, <span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">status</span>.<span class=\"pl-v\">HTTP_201_CREATED</span>)</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">vote</span>(<span class=\"pl-s1\">vote</span>: <span class=\"pl-s1\">schemas</span>.<span class=\"pl-v\">Vote</span>, <span class=\"pl-s1\">db</span>: <span class=\"pl-v\">Session</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Depends</span>(<span class=\"pl-s1\">database</span>.<span class=\"pl-s1\">get_db</span>), <span class=\"pl-s1\">current_user</span>: <span class=\"pl-s1\">int</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Depends</span>\n    (<span class=\"pl-s1\">oauth2</span>.<span class=\"pl-s1\">get_current_user</span>)):\n\n    <span class=\"pl-s1\">vote_query</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">query</span>(<span class=\"pl-s1\">models</span>.<span class=\"pl-v\">Vote</span>).<span class=\"pl-en\">filter</span>(<span class=\"pl-s1\">models</span>.<span class=\"pl-v\">Vote</span>.<span class=\"pl-s1\">post_id</span> <span class=\"pl-c1\">==</span> <span class=\"pl-s1\">vote</span>.<span class=\"pl-s1\">post_id</span>, <span class=\"pl-s1\">models</span>.<span class=\"pl-v\">Vote</span>.<span class=\"pl-s1\">user_id</span> <span class=\"pl-c1\">==</span> <span class=\"pl-s1\">current_user</span>.<span class=\"pl-s1\">id</span>)\n    \n    <span class=\"pl-s1\">liked_post</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">vote_query</span>.<span class=\"pl-en\">first</span>()\n\n    <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">vote</span>.<span class=\"pl-s1\">direction</span> <span class=\"pl-c1\">==</span> <span class=\"pl-c1\">1</span>):\n        <span class=\"pl-k\">if</span> <span class=\"pl-s1\">liked_post</span>:\n            <span class=\"pl-k\">raise</span> <span class=\"pl-v\">HTTPException</span>(<span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">status</span>.<span class=\"pl-v\">HTTP_400_BAD_REQUEST</span>, <span class=\"pl-s1\">detail</span><span class=\"pl-c1\">=</span><span class=\"pl-s\">\"You already liked this post\"</span>)\n        \n        <span class=\"pl-s1\">new_vote</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">models</span>.<span class=\"pl-v\">Vote</span>(<span class=\"pl-s1\">user_id</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">current_user</span>.<span class=\"pl-s1\">id</span>, <span class=\"pl-s1\">post_id</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">vote</span>.<span class=\"pl-s1\">post_id</span>)\n        <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">add</span>(<span class=\"pl-s1\">new_vote</span>)\n        <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">commit</span>()\n\n        <span class=\"pl-k\">return</span> {<span class=\"pl-s\">\"detail\"</span>: <span class=\"pl-s\">\"Post liked\"</span>}\n    <span class=\"pl-k\">else</span>:\n        <span class=\"pl-k\">if</span> <span class=\"pl-c1\">not</span> <span class=\"pl-s1\">liked_post</span>:\n            <span class=\"pl-k\">raise</span> <span class=\"pl-v\">HTTPException</span>(<span class=\"pl-s1\">status_code</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">status</span>.<span class=\"pl-v\">HTTP_400_BAD_REQUEST</span>, <span class=\"pl-s1\">detail</span><span class=\"pl-c1\">=</span><span class=\"pl-s\">\"You haven't liked this post\"</span>)\n        \n        <span class=\"pl-s1\">vote_query</span>.<span class=\"pl-en\">delete</span>(<span class=\"pl-s1\">synchronize_session</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">False</span>)\n        <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">commit</span>()\n\n        <span class=\"pl-k\">return</span> {<span class=\"pl-s\">\"detail\"</span>: <span class=\"pl-s\">\"Post unliked\"</span>}</pre></div>\n<p dir=\"auto\">We are goin to extract the id of the user from the token and use it to create the vote.</p>\n<p dir=\"auto\">We will use the <strong>vote.direction</strong> to determine if the user is liking or unliking the post.</p>\n<p dir=\"auto\">We will use the <strong>vote_query</strong> to check if the user has already liked the post, if they have, we will throw an error, if they haven't, we will create the vote.</p>\n<h1 tabindex=\"-1\" id=\"user-content-joins\" dir=\"auto\"><a class=\"heading-link\" href=\"#joins\">JOINS<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h1>\n<p dir=\"auto\">We will use joins to get the posts that a user has liked.</p>\n<div class=\"highlight highlight-source-sql notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"SELECT * from posts left join users on posts.owner_id = users.id;\n\nselect title, content, email from posts left join users on posts.owner_id = users.id;\"><pre><span class=\"pl-k\">SELECT</span> <span class=\"pl-k\">*</span> <span class=\"pl-k\">from</span> posts <span class=\"pl-k\">left join</span> users <span class=\"pl-k\">on</span> <span class=\"pl-c1\">posts</span>.<span class=\"pl-c1\">owner_id</span> <span class=\"pl-k\">=</span> <span class=\"pl-c1\">users</span>.<span class=\"pl-c1\">id</span>;\n\n<span class=\"pl-k\">select</span> title, content, email <span class=\"pl-k\">from</span> posts <span class=\"pl-k\">left join</span> users <span class=\"pl-k\">on</span> <span class=\"pl-c1\">posts</span>.<span class=\"pl-c1\">owner_id</span> <span class=\"pl-k\">=</span> <span class=\"pl-c1\">users</span>.<span class=\"pl-c1\">id</span>;</pre></div>\n<p dir=\"auto\"><strong>Explanation</strong>:\nWe are selecting all the columns from the posts table and we are joining the users table on the posts.owner_id and users.id columns.</p>\n<p dir=\"auto\">We are selecting the data from both tables and displaying it as one, we are using the common denominator being the <strong>owner_id</strong> and <strong>id</strong> columns.</p>\n<p dir=\"auto\">the owner_id is a foreign key that references the id of the users table, so, if they <strong>owner_id</strong> in the posts table matches the <strong>id</strong> in the users table then we will display the data from both tables.</p>\n<p dir=\"auto\"><strong>We can use the joins to count the number of likes/vote each post have, we will need a join, group by and count to achieve this.</strong></p>\n<div class=\"highlight highlight-source-sql notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"select posts.id, title, content, email, count(votes.id) from posts left join users on posts.owner_id = users.id left join votes on posts.id = votes.post_id group by posts.id, users.id;\"><pre><span class=\"pl-k\">select</span> <span class=\"pl-c1\">posts</span>.<span class=\"pl-c1\">id</span>, title, content, email, <span class=\"pl-c1\">count</span>(<span class=\"pl-c1\">votes</span>.<span class=\"pl-c1\">id</span>) <span class=\"pl-k\">from</span> posts <span class=\"pl-k\">left join</span> users <span class=\"pl-k\">on</span> <span class=\"pl-c1\">posts</span>.<span class=\"pl-c1\">owner_id</span> <span class=\"pl-k\">=</span> <span class=\"pl-c1\">users</span>.<span class=\"pl-c1\">id</span> <span class=\"pl-k\">left join</span> votes <span class=\"pl-k\">on</span> <span class=\"pl-c1\">posts</span>.<span class=\"pl-c1\">id</span> <span class=\"pl-k\">=</span> <span class=\"pl-c1\">votes</span>.<span class=\"pl-c1\">post_id</span> <span class=\"pl-k\">group by</span> <span class=\"pl-c1\">posts</span>.<span class=\"pl-c1\">id</span>, <span class=\"pl-c1\">users</span>.<span class=\"pl-c1\">id</span>;</pre></div>\n<h3 tabindex=\"-1\" id=\"user-content-counting-in-the-route\" dir=\"auto\"><a class=\"heading-link\" href=\"#counting-in-the-route\">counting in the route<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"@router.get(&quot;/&quot;)\ndef get_posts(db: Session = Depends(get_db), current_user: int = Depends(oauth2.get_current_user), limit: int = 10,\n              skip: int = 0, search: Optional[str] = None):\n    my_posts = db.query(models.Post).filter(models.Post.title.contains(search)).limit(limit).offset(skip).all()\n    \n    num_likes = db.query(models.Post, func.count(models.Vote.post_id).label(&quot;votes&quot;)).join(models.Vote, models.Vote.post_id == models.Post.id, isouter=True).group_by(\n        models.Post.id).all()\n\n    return num_likes\"><pre><span class=\"pl-en\">@<span class=\"pl-s1\">router</span>.<span class=\"pl-en\">get</span>(<span class=\"pl-s\">\"/\"</span>)</span>\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">get_posts</span>(<span class=\"pl-s1\">db</span>: <span class=\"pl-v\">Session</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Depends</span>(<span class=\"pl-s1\">get_db</span>), <span class=\"pl-s1\">current_user</span>: <span class=\"pl-s1\">int</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Depends</span>(<span class=\"pl-s1\">oauth2</span>.<span class=\"pl-s1\">get_current_user</span>), <span class=\"pl-s1\">limit</span>: <span class=\"pl-s1\">int</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">10</span>,\n              <span class=\"pl-s1\">skip</span>: <span class=\"pl-s1\">int</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">0</span>, <span class=\"pl-s1\">search</span>: <span class=\"pl-v\">Optional</span>[<span class=\"pl-s1\">str</span>] <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">None</span>):\n    <span class=\"pl-s1\">my_posts</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">query</span>(<span class=\"pl-s1\">models</span>.<span class=\"pl-v\">Post</span>).<span class=\"pl-en\">filter</span>(<span class=\"pl-s1\">models</span>.<span class=\"pl-v\">Post</span>.<span class=\"pl-s1\">title</span>.<span class=\"pl-en\">contains</span>(<span class=\"pl-s1\">search</span>)).<span class=\"pl-en\">limit</span>(<span class=\"pl-s1\">limit</span>).<span class=\"pl-en\">offset</span>(<span class=\"pl-s1\">skip</span>).<span class=\"pl-en\">all</span>()\n    \n    <span class=\"pl-s1\">num_likes</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">db</span>.<span class=\"pl-en\">query</span>(<span class=\"pl-s1\">models</span>.<span class=\"pl-v\">Post</span>, <span class=\"pl-s1\">func</span>.<span class=\"pl-en\">count</span>(<span class=\"pl-s1\">models</span>.<span class=\"pl-v\">Vote</span>.<span class=\"pl-s1\">post_id</span>).<span class=\"pl-en\">label</span>(<span class=\"pl-s\">\"votes\"</span>)).<span class=\"pl-en\">join</span>(<span class=\"pl-s1\">models</span>.<span class=\"pl-v\">Vote</span>, <span class=\"pl-s1\">models</span>.<span class=\"pl-v\">Vote</span>.<span class=\"pl-s1\">post_id</span> <span class=\"pl-c1\">==</span> <span class=\"pl-s1\">models</span>.<span class=\"pl-v\">Post</span>.<span class=\"pl-s1\">id</span>, <span class=\"pl-s1\">isouter</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">True</span>).<span class=\"pl-en\">group_by</span>(\n        <span class=\"pl-s1\">models</span>.<span class=\"pl-v\">Post</span>.<span class=\"pl-s1\">id</span>).<span class=\"pl-en\">all</span>()\n\n    <span class=\"pl-k\">return</span> <span class=\"pl-s1\">num_likes</span></pre></div>\n<p dir=\"auto\">Now the votes will be returned with the posts.</p>\n<h1 tabindex=\"-1\" id=\"user-content-migrations-with-alembic\" dir=\"auto\"><a class=\"heading-link\" href=\"#migrations-with-alembic\">migrations with alembic<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h1>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"pip install alembic\n\nalembic init migrations\nalembic --help\n\nalembic revision -m &quot;create posts table&quot;\nalembic upgrade 6dc49806a1ba\nalembic upgrade head\n\nalembic revision -m &quot;create votes table&quot;\nalembic upgrade head # to upgrade to the latest migration\n\nalembic downgrade -1 # to undo the last migration\nalembic upgrade +2 # to upgrade to the next migration\n\n# use this two lines to generate the tables automatically - stress free\nalembic init migrations\nalembic revision --autogenerate -m &quot;all tables&quot; # to create a migration file for all the tables\nalembic upgrade head # to upgrade to the latest migration\"><pre>pip install alembic\n\nalembic init migrations\nalembic --help\n\nalembic revision -m <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>create posts table<span class=\"pl-pds\">\"</span></span>\nalembic upgrade 6dc49806a1ba\nalembic upgrade head\n\nalembic revision -m <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>create votes table<span class=\"pl-pds\">\"</span></span>\nalembic upgrade head <span class=\"pl-c\"><span class=\"pl-c\">#</span> to upgrade to the latest migration</span>\n\nalembic downgrade -1 <span class=\"pl-c\"><span class=\"pl-c\">#</span> to undo the last migration</span>\nalembic upgrade +2 <span class=\"pl-c\"><span class=\"pl-c\">#</span> to upgrade to the next migration</span>\n\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> use this two lines to generate the tables automatically - stress free</span>\nalembic init migrations\nalembic revision --autogenerate -m <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>all tables<span class=\"pl-pds\">\"</span></span> <span class=\"pl-c\"><span class=\"pl-c\">#</span> to create a migration file for all the tables</span>\nalembic upgrade head <span class=\"pl-c\"><span class=\"pl-c\">#</span> to upgrade to the latest migration</span></pre></div>\n<h1 tabindex=\"-1\" id=\"user-content-cors\" dir=\"auto\"><a class=\"heading-link\" href=\"#cors\">CORS<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h1>\n<p dir=\"auto\">Cross Origin Resource Sharing</p>\n<p dir=\"auto\">search for <strong>CORS</strong> in the fastAPI documentation</p>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"from fastapi.middleware.cors import CORSMiddleware\n\norigins = []\n\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=origins,\n    allow_credentials=True,\n    allow_methods=[&quot;*&quot;],\n    allow_headers=[&quot;*&quot;]\n)\"><pre><span class=\"pl-k\">from</span> <span class=\"pl-s1\">fastapi</span>.<span class=\"pl-s1\">middleware</span>.<span class=\"pl-s1\">cors</span> <span class=\"pl-k\">import</span> <span class=\"pl-v\">CORSMiddleware</span>\n\n<span class=\"pl-s1\">origins</span> <span class=\"pl-c1\">=</span> []\n\n<span class=\"pl-s1\">app</span>.<span class=\"pl-en\">add_middleware</span>(\n    <span class=\"pl-v\">CORSMiddleware</span>,\n    <span class=\"pl-s1\">allow_origins</span><span class=\"pl-c1\">=</span><span class=\"pl-s1\">origins</span>,\n    <span class=\"pl-s1\">allow_credentials</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">True</span>,\n    <span class=\"pl-s1\">allow_methods</span><span class=\"pl-c1\">=</span>[<span class=\"pl-s\">\"*\"</span>],\n    <span class=\"pl-s1\">allow_headers</span><span class=\"pl-c1\">=</span>[<span class=\"pl-s\">\"*\"</span>]\n)</pre></div>\n<p dir=\"auto\"><strong>allow_origins</strong> specifies the domain that are allowed to communicate to our api</p>\n<p dir=\"auto\"><strong>allow_credentials</strong> specifies if the api should allow credentials to be passed to it.</p>\n<p dir=\"auto\"><strong>allow_methods</strong> specifies the methods that are allowed to be used to communicate with our api. If yu have a public api, you may want to only allow users to get information from the apoi but not send to it, if this is the case, you only allow the <strong>get</strong> method.</p>\n<p dir=\"auto\"><strong>allow_headers</strong> specifies the headers that are allowed to be passed to the api.</p>\n<p dir=\"auto\"><strong>For public api's, the origins can have a wild card * to allow all domains to communicate with the api. But if the api is private, you can specify the domains that are allowed to communicate with the api.</strong></p>\n<p dir=\"auto\"><strong>if the api is built for a cetain application, you want to configure the origins to only allow that application to communicate with the api only. any other origin will be blocked.</strong></p>\n<h1 tabindex=\"-1\" id=\"user-content-deploying-the-api\" dir=\"auto\"><a class=\"heading-link\" href=\"#deploying-the-api\">DEPLOYING THE API<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h1>\n<p dir=\"auto\">I will check out the heroku deployment then deploy to render.</p>\n<p dir=\"auto\"><strong>IMPORTANT</strong>\nWe never run alembic revisions on the production server, we only do that on the development server when we are staging the changes.\n<strong>On production we only push our code to github together with the revision contained in the alembic/revisions folder</strong>\n<strong>After pushing everything to github, we run the alembic upgrade head in the production server</strong></p>\n<hr>\n<p dir=\"auto\">check out how you can run the commands in our render server or how to migrate your revisions on your cloud server hosting the postgres database you are using.</p>\n<hr>\n<h1 tabindex=\"-1\" id=\"user-content-dockerizing-our-api\" dir=\"auto\"><a class=\"heading-link\" href=\"#dockerizing-our-api\">DOCKERIZING OUR API<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h1>\n<p dir=\"auto\">We will also set up a postgres database in a docker container and connect to it from our api.</p>\n<p dir=\"auto\"><code>hub.docker.com</code>\nWe are going to search for an offcial python image and use it to build our docker image. (choose one you built your api with)</p>\n<p dir=\"auto\">This images are standard images, they only have the python installed, this means that we are going to have to copy all our files to the docker image and install all the dependencies.</p>\n<p dir=\"auto\">To avoid that, we could write our wn image that will have all the dependencies we need.\nWe are going to write our dockerfile and you can follow the example provided on the python docs on docker.hub</p>\n<p dir=\"auto\"><code>Dockerfile</code></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"FROM python:3.10.12\n\nWORKDIR /usr/src/app\n\nCOPY requirements.txt ./\n\nRUN pip install --no-cache-dir -r requirements.txt\n\nCOPY . .\n\nCMD [&quot;uvicorn&quot;, &quot;app.main:app&quot;, &quot;--host&quot;, &quot;0.0.0.0&quot;, &quot;--port&quot;, &quot;8000&quot; ]\"><pre lang=\"docker\" class=\"notranslate\"><code>FROM python:3.10.12\n\nWORKDIR /usr/src/app\n\nCOPY requirements.txt ./\n\nRUN pip install --no-cache-dir -r requirements.txt\n\nCOPY . .\n\nCMD [\"uvicorn\", \"app.main:app\", \"--host\", \"0.0.0.0\", \"--port\", \"8000\" ]\n</code></pre></div>\n<p dir=\"auto\"><strong>WORKDIR</strong> is the directory where the application will live and this step is optional, but you get to choose where you want your application to live.</p>\n<h2 tabindex=\"-1\" id=\"user-content-building-the-image\" dir=\"auto\"><a class=\"heading-link\" href=\"#building-the-image\">BUILDING THE IMAGE<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h2>\n<p dir=\"auto\">The docker file is complete, now we build the image.</p>\n<p dir=\"auto\">if not root user, use sudo</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"docker build -t fastapi .\n\ndocker image ls\n\"><pre>docker build -t fastapi <span class=\"pl-c1\">.</span>\n\ndocker image ls\n</pre></div>\n<p dir=\"auto\"><strong>Now we can use the image built above to build a container</strong></p>\n<h3 tabindex=\"-1\" id=\"user-content-docker-compose--containers\" dir=\"auto\"><a class=\"heading-link\" href=\"#docker-compose--containers\">docker compose | CONTAINERS<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\">Building a container invlolves running commands like <strong>docker run</strong> and others but we can avoid doing all that by using docker compose, we write out our commands in a file and run them all at once.</p>\n<p dir=\"auto\">You start by soecifying the version of docker compose you are using, then you specify the services you want to run, in our case, we want to run the api and the database.</p>\n<p dir=\"auto\"><code>docker-compose.yml</code></p>\n<div class=\"highlight highlight-source-yaml notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"version: &quot;3&quot;\nservices:\n  api:\n    build: .\n    ports:\n      - &quot;8000:8000&quot;\"><pre><span class=\"pl-ent\">version</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>3<span class=\"pl-pds\">\"</span></span>\n<span class=\"pl-ent\">services</span>:\n  <span class=\"pl-ent\">api</span>:\n    <span class=\"pl-ent\">build</span>: <span class=\"pl-s\">.</span>\n    <span class=\"pl-ent\">ports</span>:\n      - <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>8000:8000<span class=\"pl-pds\">\"</span></span></pre></div>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"docker-compose up -d\"><pre>docker-compose up -d</pre></div>\n<p dir=\"auto\">run:</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"docker ps\"><pre>docker ps</pre></div>\n<p dir=\"auto\">This commands tells you the containers that are running or crashed. Check the status column.\nIf ti requires the env variables</p>\n<div class=\"highlight highlight-source-yaml notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"version: &quot;3&quot;\nservices:\n  api:\n    build: .\n    ports:\n      - &quot;8000:8000&quot;\n    # env_file:\n    #   - .env\n    environment:\n      - DB_HOST=127.0.0.1\n      - DB_NAME=fastapi\n      - DB_USER=postgres\n      - DB_PASSWORD=mankindjnr\n      - DB_PORT=5432\n      - SECRET_KEY = &quot;b7ffab7e88ff8ec8e6c258944ec6677542bd7a16431ef01c0b78aaea77b26e04&quot;\n      - ALGORITHM = &quot;HS256&quot;\n      - ACCESS_TOKEN_EXPIRE_MINUTES = 60\n\"><pre><span class=\"pl-ent\">version</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>3<span class=\"pl-pds\">\"</span></span>\n<span class=\"pl-ent\">services</span>:\n  <span class=\"pl-ent\">api</span>:\n    <span class=\"pl-ent\">build</span>: <span class=\"pl-s\">.</span>\n    <span class=\"pl-ent\">ports</span>:\n      - <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>8000:8000<span class=\"pl-pds\">\"</span></span>\n    <span class=\"pl-c\"><span class=\"pl-c\">#</span> env_file:</span>\n    <span class=\"pl-c\"><span class=\"pl-c\">#</span>   - .env</span>\n    <span class=\"pl-ent\">environment</span>:\n      - <span class=\"pl-s\">DB_HOST=127.0.0.1</span>\n      - <span class=\"pl-s\">DB_NAME=fastapi</span>\n      - <span class=\"pl-s\">DB_USER=postgres</span>\n      - <span class=\"pl-s\">DB_PASSWORD=mankindjnr</span>\n      - <span class=\"pl-s\">DB_PORT=5432</span>\n      - <span class=\"pl-s\">SECRET_KEY = \"b7ffab7e88ff8ec8e6c258944ec6677542bd7a16431ef01c0b78aaea77b26e04\"</span>\n      - <span class=\"pl-s\">ALGORITHM = \"HS256\"</span>\n      - <span class=\"pl-s\">ACCESS_TOKEN_EXPIRE_MINUTES = 60</span>\n</pre></div>\n<p dir=\"auto\">We will tear down our current container and rebuild</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"docker-compose down\ndocker-compose up -d\"><pre>docker-compose down\ndocker-compose up -d</pre></div>\n<p dir=\"auto\">This time around, it did not build an image, it used the image we had built earlier.\nBut, if you made changes to the dockerfile, you can force it to build an image by adding the flag <strong>--build</strong></p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"docker-compose up -d --build\"><pre>docker-compose up -d --build</pre></div>\n<p dir=\"auto\">You can test if the container is up by running the following in postman or in the browser</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"localhost:8000\"><pre class=\"notranslate\"><code>localhost:8000\n</code></pre></div>\n<p dir=\"auto\">Whatever the response of the base route is, is what you will get.</p>\n<h3 tabindex=\"-1\" id=\"user-content-database-setup-in-a-container\" dir=\"auto\"><a class=\"heading-link\" href=\"#database-setup-in-a-container\">DATABASE SETUP IN A CONTAINER<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\">spinning up an image of postgres\n<strong>even when you are not dockerizing your image its good to use a container for your database</strong></p>\n<p dir=\"auto\">Foe this we will use the official postgres image found on docker hub.</p>\n<p dir=\"auto\"><code>docker-compose.yml</code></p>\n<div class=\"highlight highlight-source-yaml notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"version: &quot;3&quot;\nservices:\n  api:\n    build: .\n    ports:\n      - &quot;8000:8000&quot;\n    # env_file:\n    #   - .env\n    environment:\n      - DB_HOST=postgres\n      - DB_NAME=fastapi\n      - DB_USER=postgres\n      - DB_PASSWORD=mankindjnr\n      - DB_PORT=5432\n      - SECRET_KEY=&quot;b7ffab7e88ff8ec8e6c258944ec6677542bd7a16431ef01c0b78aaea77b26e04&quot;\n      - ALGORITHM=&quot;HS256&quot;\n      - ACCESS_TOKEN_EXPIRE_MINUTES=60\n\n  postgres:\n    image: postgres\n    environment:\n      - POSTGRES_USER=postgres\n      - POSTGRES_PASSWORD=mankindjnr\n      - POSTGRES_DB=fastapi\n    \n    volumes:\n      - postgres_data:/var/lib/postgresql/data/\n\nvolumes:\n  postgres_data:\"><pre><span class=\"pl-ent\">version</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>3<span class=\"pl-pds\">\"</span></span>\n<span class=\"pl-ent\">services</span>:\n  <span class=\"pl-ent\">api</span>:\n    <span class=\"pl-ent\">build</span>: <span class=\"pl-s\">.</span>\n    <span class=\"pl-ent\">ports</span>:\n      - <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>8000:8000<span class=\"pl-pds\">\"</span></span>\n    <span class=\"pl-c\"><span class=\"pl-c\">#</span> env_file:</span>\n    <span class=\"pl-c\"><span class=\"pl-c\">#</span>   - .env</span>\n    <span class=\"pl-ent\">environment</span>:\n      - <span class=\"pl-s\">DB_HOST=postgres</span>\n      - <span class=\"pl-s\">DB_NAME=fastapi</span>\n      - <span class=\"pl-s\">DB_USER=postgres</span>\n      - <span class=\"pl-s\">DB_PASSWORD=mankindjnr</span>\n      - <span class=\"pl-s\">DB_PORT=5432</span>\n      - <span class=\"pl-s\">SECRET_KEY=\"b7ffab7e88ff8ec8e6c258944ec6677542bd7a16431ef01c0b78aaea77b26e04\"</span>\n      - <span class=\"pl-s\">ALGORITHM=\"HS256\"</span>\n      - <span class=\"pl-s\">ACCESS_TOKEN_EXPIRE_MINUTES=60</span>\n\n  <span class=\"pl-ent\">postgres</span>:\n    <span class=\"pl-ent\">image</span>: <span class=\"pl-s\">postgres</span>\n    <span class=\"pl-ent\">environment</span>:\n      - <span class=\"pl-s\">POSTGRES_USER=postgres</span>\n      - <span class=\"pl-s\">POSTGRES_PASSWORD=mankindjnr</span>\n      - <span class=\"pl-s\">POSTGRES_DB=fastapi</span>\n    \n    <span class=\"pl-ent\">volumes</span>:\n      - <span class=\"pl-s\">postgres_data:/var/lib/postgresql/data/</span>\n\n<span class=\"pl-ent\">volumes</span>:\n  <span class=\"pl-ent\">postgres_data</span>:</pre></div>\n<p dir=\"auto\"><strong>postgres</strong> is another service we are running, we are using the official postgres image and we are specifying the environment variables we want to use.</p>\n<p dir=\"auto\"><strong>volumes</strong> they are used to persist data, if we don't use volumes, when we tear down the container, the data will be lost. We are using volumes to store the data in the postgres_data folder.</p>\n<p dir=\"auto\">We changed the db host from <strong>127.0.0.1</strong> to <strong>postgres</strong> since we are using a container for the database. It will then reference the postgres service we have created.</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"docker exec -it api-development_api_1 bash\"><pre>docker <span class=\"pl-c1\">exec</span> -it api-development_api_1 bash</pre></div>\n<h1 tabindex=\"-1\" id=\"user-content-repository-for-images\" dir=\"auto\"><a class=\"heading-link\" href=\"#repository-for-images\">REPOSITORY FOR IMAGES<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h1>\n<p dir=\"auto\">We will use docker hub to store our images.</p>\n<p dir=\"auto\">create an account on docker hub and create a repository.</p>\n<p dir=\"auto\">With a repo, i could now push my image:\nTo see the images  have built:</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"docker image ls\"><pre>docker image ls</pre></div>\n<p dir=\"auto\">To push:\nlogin to docker hub</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"docker login\"><pre>docker login</pre></div>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"sudo docker image tag api-development_api mankindjnr/apidev\ndocker push mankindjnr/apidev\"><pre>sudo docker image tag api-development_api mankindjnr/apidev\ndocker push mankindjnr/apidev</pre></div>\n</article>","renderedFileInfo":null,"shortPath":null,"tabSize":8,"topBannersInfo":{"overridingGlobalFundingFile":false,"globalPreferredFundingPath":null,"repoOwner":"mankindjnr","repoName":"markdown-blog","showInvalidCitationWarning":false,"citationHelpUrl":"https://docs.github.com/en/github/creating-cloning-and-archiving-repositories/creating-a-repository-on-github/about-citation-files","showDependabotConfigurationBanner":false,"actionsOnboardingTip":null},"truncated":false,"viewable":true,"workflowRedirectUrl":null,"symbols":{"timedOut":false,"notAnalyzed":false,"symbols":[{"name":" API DEVELOPMENT WITH FASTAPI","kind":"section_1","identStart":1,"identEnd":30,"extentStart":0,"extentEnd":8122,"fullyQualifiedName":" API DEVELOPMENT WITH FASTAPI","identUtf16":{"start":{"lineNumber":0,"utf16Col":1},"end":{"lineNumber":0,"utf16Col":30}},"extentUtf16":{"start":{"lineNumber":0,"utf16Col":0},"end":{"lineNumber":203,"utf16Col":0}}},{"name":" INSTALLATION","kind":"section_2","identStart":34,"identEnd":47,"extentStart":32,"extentEnd":185,"fullyQualifiedName":" INSTALLATION","identUtf16":{"start":{"lineNumber":2,"utf16Col":2},"end":{"lineNumber":2,"utf16Col":15}},"extentUtf16":{"start":{"lineNumber":2,"utf16Col":0},"end":{"lineNumber":8,"utf16Col":0}}},{"name":" Introduction","kind":"section_2","identStart":187,"identEnd":200,"extentStart":185,"extentEnd":2007,"fullyQualifiedName":" Introduction","identUtf16":{"start":{"lineNumber":8,"utf16Col":2},"end":{"lineNumber":8,"utf16Col":15}},"extentUtf16":{"start":{"lineNumber":8,"utf16Col":0},"end":{"lineNumber":45,"utf16Col":0}}},{"name":" starting the server","kind":"section_3","identStart":1113,"identEnd":1133,"extentStart":1110,"extentEnd":1473,"fullyQualifiedName":" starting the server","identUtf16":{"start":{"lineNumber":28,"utf16Col":3},"end":{"lineNumber":28,"utf16Col":23}},"extentUtf16":{"start":{"lineNumber":28,"utf16Col":0},"end":{"lineNumber":38,"utf16Col":0}}},{"name":" TESTING","kind":"section_3","identStart":1476,"identEnd":1484,"extentStart":1473,"extentEnd":2007,"fullyQualifiedName":" TESTING","identUtf16":{"start":{"lineNumber":38,"utf16Col":3},"end":{"lineNumber":38,"utf16Col":11}},"extentUtf16":{"start":{"lineNumber":38,"utf16Col":0},"end":{"lineNumber":45,"utf16Col":0}}},{"name":" POST REQUESTS","kind":"section_2","identStart":2009,"identEnd":2023,"extentStart":2007,"extentEnd":2927,"fullyQualifiedName":" POST REQUESTS","identUtf16":{"start":{"lineNumber":45,"utf16Col":2},"end":{"lineNumber":45,"utf16Col":16}},"extentUtf16":{"start":{"lineNumber":45,"utf16Col":0},"end":{"lineNumber":63,"utf16Col":0}}},{"name":" SCHEMA","kind":"section_2","identStart":2929,"identEnd":2936,"extentStart":2927,"extentEnd":5056,"fullyQualifiedName":" SCHEMA","identUtf16":{"start":{"lineNumber":63,"utf16Col":2},"end":{"lineNumber":63,"utf16Col":9}},"extentUtf16":{"start":{"lineNumber":63,"utf16Col":0},"end":{"lineNumber":114,"utf16Col":0}}},{"name":" OPTIONAL FIELDS","kind":"section_3","identStart":4149,"identEnd":4165,"extentStart":4146,"extentEnd":5056,"fullyQualifiedName":" OPTIONAL FIELDS","identUtf16":{"start":{"lineNumber":88,"utf16Col":3},"end":{"lineNumber":88,"utf16Col":19}},"extentUtf16":{"start":{"lineNumber":88,"utf16Col":0},"end":{"lineNumber":114,"utf16Col":0}}},{"name":" CRUD OPERATIONS","kind":"section_2","identStart":5058,"identEnd":5074,"extentStart":5056,"extentEnd":7583,"fullyQualifiedName":" CRUD OPERATIONS","identUtf16":{"start":{"lineNumber":114,"utf16Col":2},"end":{"lineNumber":114,"utf16Col":18}},"extentUtf16":{"start":{"lineNumber":114,"utf16Col":0},"end":{"lineNumber":192,"utf16Col":0}}},{"name":" creating and retrieving","kind":"section_3","identStart":5079,"identEnd":5103,"extentStart":5076,"extentEnd":6548,"fullyQualifiedName":" creating and retrieving","identUtf16":{"start":{"lineNumber":116,"utf16Col":3},"end":{"lineNumber":116,"utf16Col":27}},"extentUtf16":{"start":{"lineNumber":116,"utf16Col":0},"end":{"lineNumber":162,"utf16Col":0}}},{"name":" DELETING","kind":"section_3","identStart":6551,"identEnd":6560,"extentStart":6548,"extentEnd":6887,"fullyQualifiedName":" DELETING","identUtf16":{"start":{"lineNumber":162,"utf16Col":3},"end":{"lineNumber":162,"utf16Col":12}},"extentUtf16":{"start":{"lineNumber":162,"utf16Col":0},"end":{"lineNumber":173,"utf16Col":0}}},{"name":" UPDATING","kind":"section_3","identStart":6890,"identEnd":6899,"extentStart":6887,"extentEnd":7583,"fullyQualifiedName":" UPDATING","identUtf16":{"start":{"lineNumber":173,"utf16Col":3},"end":{"lineNumber":173,"utf16Col":12}},"extentUtf16":{"start":{"lineNumber":173,"utf16Col":0},"end":{"lineNumber":192,"utf16Col":0}}},{"name":" STRUCTURE","kind":"section_2","identStart":7585,"identEnd":7595,"extentStart":7583,"extentEnd":8122,"fullyQualifiedName":" STRUCTURE","identUtf16":{"start":{"lineNumber":192,"utf16Col":2},"end":{"lineNumber":192,"utf16Col":12}},"extentUtf16":{"start":{"lineNumber":192,"utf16Col":0},"end":{"lineNumber":203,"utf16Col":0}}},{"name":" DATABASE","kind":"section_1","identStart":8123,"identEnd":8132,"extentStart":8122,"extentEnd":23398,"fullyQualifiedName":" DATABASE","identUtf16":{"start":{"lineNumber":203,"utf16Col":1},"end":{"lineNumber":203,"utf16Col":10}},"extentUtf16":{"start":{"lineNumber":203,"utf16Col":0},"end":{"lineNumber":669,"utf16Col":0}}},{"name":" POSTGRES","kind":"section_3","identStart":8483,"identEnd":8492,"extentStart":8480,"extentEnd":9205,"fullyQualifiedName":" POSTGRES","identUtf16":{"start":{"lineNumber":207,"utf16Col":3},"end":{"lineNumber":207,"utf16Col":12}},"extentUtf16":{"start":{"lineNumber":207,"utf16Col":0},"end":{"lineNumber":223,"utf16Col":0}}},{"name":" accessing the postgres db from our python file","kind":"section_3","identStart":9208,"identEnd":9255,"extentStart":9205,"extentEnd":9855,"fullyQualifiedName":" accessing the postgres db from our python file","identUtf16":{"start":{"lineNumber":223,"utf16Col":3},"end":{"lineNumber":223,"utf16Col":50}},"extentUtf16":{"start":{"lineNumber":223,"utf16Col":0},"end":{"lineNumber":242,"utf16Col":0}}},{"name":" retrieving all data from the database","kind":"section_3","identStart":9858,"identEnd":9896,"extentStart":9855,"extentEnd":10061,"fullyQualifiedName":" retrieving all data from the database","identUtf16":{"start":{"lineNumber":242,"utf16Col":3},"end":{"lineNumber":242,"utf16Col":41}},"extentUtf16":{"start":{"lineNumber":242,"utf16Col":0},"end":{"lineNumber":253,"utf16Col":0}}},{"name":" retrieving a single item from the database","kind":"section_3","identStart":10064,"identEnd":10107,"extentStart":10061,"extentEnd":10594,"fullyQualifiedName":" retrieving a single item from the database","identUtf16":{"start":{"lineNumber":253,"utf16Col":3},"end":{"lineNumber":253,"utf16Col":46}},"extentUtf16":{"start":{"lineNumber":253,"utf16Col":0},"end":{"lineNumber":269,"utf16Col":0}}},{"name":" inserting data into the database","kind":"section_3","identStart":10597,"identEnd":10630,"extentStart":10594,"extentEnd":11218,"fullyQualifiedName":" inserting data into the database","identUtf16":{"start":{"lineNumber":269,"utf16Col":3},"end":{"lineNumber":269,"utf16Col":36}},"extentUtf16":{"start":{"lineNumber":269,"utf16Col":0},"end":{"lineNumber":286,"utf16Col":0}}},{"name":" DELETING DATA FROM THE DATABASE","kind":"section_3","identStart":11221,"identEnd":11253,"extentStart":11218,"extentEnd":11656,"fullyQualifiedName":" DELETING DATA FROM THE DATABASE","identUtf16":{"start":{"lineNumber":286,"utf16Col":3},"end":{"lineNumber":286,"utf16Col":35}},"extentUtf16":{"start":{"lineNumber":286,"utf16Col":0},"end":{"lineNumber":303,"utf16Col":0}}},{"name":" UPDATING DATA IN THE DATABASE","kind":"section_3","identStart":11659,"identEnd":11689,"extentStart":11656,"extentEnd":12173,"fullyQualifiedName":" UPDATING DATA IN THE DATABASE","identUtf16":{"start":{"lineNumber":303,"utf16Col":3},"end":{"lineNumber":303,"utf16Col":33}},"extentUtf16":{"start":{"lineNumber":303,"utf16Col":0},"end":{"lineNumber":321,"utf16Col":0}}},{"name":" OBJECT RELATIONAL MAPPER (ORM)","kind":"section_2","identStart":12175,"identEnd":12206,"extentStart":12173,"extentEnd":12364,"fullyQualifiedName":" OBJECT RELATIONAL MAPPER (ORM)","identUtf16":{"start":{"lineNumber":321,"utf16Col":2},"end":{"lineNumber":321,"utf16Col":33}},"extentUtf16":{"start":{"lineNumber":321,"utf16Col":0},"end":{"lineNumber":324,"utf16Col":0}}},{"name":" SQLALCHEMY","kind":"section_2","identStart":12366,"identEnd":12377,"extentStart":12364,"extentEnd":18850,"fullyQualifiedName":" SQLALCHEMY","identUtf16":{"start":{"lineNumber":324,"utf16Col":2},"end":{"lineNumber":324,"utf16Col":13}},"extentUtf16":{"start":{"lineNumber":324,"utf16Col":0},"end":{"lineNumber":526,"utf16Col":0}}},{"name":" INSTALLATION","kind":"section_3","identStart":12382,"identEnd":12395,"extentStart":12379,"extentEnd":12788,"fullyQualifiedName":" INSTALLATION","identUtf16":{"start":{"lineNumber":326,"utf16Col":3},"end":{"lineNumber":326,"utf16Col":16}},"extentUtf16":{"start":{"lineNumber":326,"utf16Col":0},"end":{"lineNumber":338,"utf16Col":0}}},{"name":" Connecting to the database","kind":"section_3","identStart":12791,"identEnd":12818,"extentStart":12788,"extentEnd":14619,"fullyQualifiedName":" Connecting to the database","identUtf16":{"start":{"lineNumber":338,"utf16Col":3},"end":{"lineNumber":338,"utf16Col":30}},"extentUtf16":{"start":{"lineNumber":338,"utf16Col":0},"end":{"lineNumber":395,"utf16Col":0}}},{"name":" testing if our connection worked","kind":"section_3","identStart":14622,"identEnd":14655,"extentStart":14619,"extentEnd":15173,"fullyQualifiedName":" testing if our connection worked","identUtf16":{"start":{"lineNumber":395,"utf16Col":3},"end":{"lineNumber":395,"utf16Col":36}},"extentUtf16":{"start":{"lineNumber":395,"utf16Col":0},"end":{"lineNumber":407,"utf16Col":0}}},{"name":" testing","kind":"section_3","identStart":15176,"identEnd":15184,"extentStart":15173,"extentEnd":15629,"fullyQualifiedName":" testing","identUtf16":{"start":{"lineNumber":407,"utf16Col":3},"end":{"lineNumber":407,"utf16Col":11}},"extentUtf16":{"start":{"lineNumber":407,"utf16Col":0},"end":{"lineNumber":424,"utf16Col":0}}},{"name":" retrieving all items with orm","kind":"section_3","identStart":15632,"identEnd":15662,"extentStart":15629,"extentEnd":15927,"fullyQualifiedName":" retrieving all items with orm","identUtf16":{"start":{"lineNumber":424,"utf16Col":3},"end":{"lineNumber":424,"utf16Col":33}},"extentUtf16":{"start":{"lineNumber":424,"utf16Col":0},"end":{"lineNumber":435,"utf16Col":0}}},{"name":" creating a single item with orm","kind":"section_3","identStart":15930,"identEnd":15962,"extentStart":15927,"extentEnd":17178,"fullyQualifiedName":" creating a single item with orm","identUtf16":{"start":{"lineNumber":435,"utf16Col":3},"end":{"lineNumber":435,"utf16Col":35}},"extentUtf16":{"start":{"lineNumber":435,"utf16Col":0},"end":{"lineNumber":471,"utf16Col":0}}},{"name":" retrieving a single item with orm","kind":"section_3","identStart":17181,"identEnd":17215,"extentStart":17178,"extentEnd":17808,"fullyQualifiedName":" retrieving a single item with orm","identUtf16":{"start":{"lineNumber":471,"utf16Col":3},"end":{"lineNumber":471,"utf16Col":37}},"extentUtf16":{"start":{"lineNumber":471,"utf16Col":0},"end":{"lineNumber":489,"utf16Col":0}}},{"name":" Deleting a single item with orm","kind":"section_3","identStart":17811,"identEnd":17843,"extentStart":17808,"extentEnd":18311,"fullyQualifiedName":" Deleting a single item with orm","identUtf16":{"start":{"lineNumber":489,"utf16Col":3},"end":{"lineNumber":489,"utf16Col":35}},"extentUtf16":{"start":{"lineNumber":489,"utf16Col":0},"end":{"lineNumber":507,"utf16Col":0}}},{"name":" Updating a single item with orm","kind":"section_3","identStart":18314,"identEnd":18346,"extentStart":18311,"extentEnd":18850,"fullyQualifiedName":" Updating a single item with orm","identUtf16":{"start":{"lineNumber":507,"utf16Col":3},"end":{"lineNumber":507,"utf16Col":35}},"extentUtf16":{"start":{"lineNumber":507,"utf16Col":0},"end":{"lineNumber":526,"utf16Col":0}}},{"name":" pydantic/schema model","kind":"section_2","identStart":18852,"identEnd":18874,"extentStart":18850,"extentEnd":19235,"fullyQualifiedName":" pydantic/schema model","identUtf16":{"start":{"lineNumber":526,"utf16Col":2},"end":{"lineNumber":526,"utf16Col":24}},"extentUtf16":{"start":{"lineNumber":526,"utf16Col":0},"end":{"lineNumber":537,"utf16Col":0}}},{"name":" sqlalchemy model","kind":"section_2","identStart":19237,"identEnd":19254,"extentStart":19235,"extentEnd":21381,"fullyQualifiedName":" sqlalchemy model","identUtf16":{"start":{"lineNumber":537,"utf16Col":2},"end":{"lineNumber":537,"utf16Col":19}},"extentUtf16":{"start":{"lineNumber":537,"utf16Col":0},"end":{"lineNumber":598,"utf16Col":0}}},{"name":" separating the schemas","kind":"section_3","identStart":20055,"identEnd":20078,"extentStart":20052,"extentEnd":20987,"fullyQualifiedName":" separating the schemas","identUtf16":{"start":{"lineNumber":554,"utf16Col":3},"end":{"lineNumber":554,"utf16Col":26}},"extentUtf16":{"start":{"lineNumber":554,"utf16Col":0},"end":{"lineNumber":582,"utf16Col":0}}},{"name":" REASON","kind":"section_4","identStart":20325,"identEnd":20332,"extentStart":20321,"extentEnd":20987,"fullyQualifiedName":" REASON","identUtf16":{"start":{"lineNumber":568,"utf16Col":4},"end":{"lineNumber":568,"utf16Col":11}},"extentUtf16":{"start":{"lineNumber":568,"utf16Col":0},"end":{"lineNumber":582,"utf16Col":0}}},{"name":" A better way to structure multiple related schemas","kind":"section_3","identStart":20990,"identEnd":21041,"extentStart":20987,"extentEnd":21381,"fullyQualifiedName":" A better way to structure multiple related schemas","identUtf16":{"start":{"lineNumber":582,"utf16Col":3},"end":{"lineNumber":582,"utf16Col":54}},"extentUtf16":{"start":{"lineNumber":582,"utf16Col":0},"end":{"lineNumber":598,"utf16Col":0}}},{"name":" SENDING A RESPONSE BACK","kind":"section_2","identStart":21383,"identEnd":21407,"extentStart":21381,"extentEnd":23398,"fullyQualifiedName":" SENDING A RESPONSE BACK","identUtf16":{"start":{"lineNumber":598,"utf16Col":2},"end":{"lineNumber":598,"utf16Col":26}},"extentUtf16":{"start":{"lineNumber":598,"utf16Col":0},"end":{"lineNumber":669,"utf16Col":0}}},{"name":" USER FUNCTIONALITY","kind":"section_1","identStart":23399,"identEnd":23418,"extentStart":23398,"extentEnd":25471,"fullyQualifiedName":" USER FUNCTIONALITY","identUtf16":{"start":{"lineNumber":669,"utf16Col":1},"end":{"lineNumber":669,"utf16Col":20}},"extentUtf16":{"start":{"lineNumber":669,"utf16Col":0},"end":{"lineNumber":761,"utf16Col":0}}},{"name":" Creating a User","kind":"section_2","identStart":23421,"identEnd":23437,"extentStart":23419,"extentEnd":24378,"fullyQualifiedName":" Creating a User","identUtf16":{"start":{"lineNumber":670,"utf16Col":2},"end":{"lineNumber":670,"utf16Col":18}},"extentUtf16":{"start":{"lineNumber":670,"utf16Col":0},"end":{"lineNumber":711,"utf16Col":0}}},{"name":" fetching user data","kind":"section_3","identStart":24045,"identEnd":24064,"extentStart":24042,"extentEnd":24378,"fullyQualifiedName":" fetching user data","identUtf16":{"start":{"lineNumber":700,"utf16Col":3},"end":{"lineNumber":700,"utf16Col":22}},"extentUtf16":{"start":{"lineNumber":700,"utf16Col":0},"end":{"lineNumber":711,"utf16Col":0}}},{"name":" ROUTERS","kind":"section_2","identStart":24380,"identEnd":24388,"extentStart":24378,"extentEnd":25471,"fullyQualifiedName":" ROUTERS","identUtf16":{"start":{"lineNumber":711,"utf16Col":2},"end":{"lineNumber":711,"utf16Col":10}},"extentUtf16":{"start":{"lineNumber":711,"utf16Col":0},"end":{"lineNumber":761,"utf16Col":0}}},{"name":" STYLING THE DOCS SO THAT ALL ROUTES ARE SECTIONED ACCORDING TO THEIR ACTIONS","kind":"section_3","identStart":25248,"identEnd":25325,"extentStart":25245,"extentEnd":25471,"fullyQualifiedName":" STYLING THE DOCS SO THAT ALL ROUTES ARE SECTIONED ACCORDING TO THEIR ACTIONS","identUtf16":{"start":{"lineNumber":745,"utf16Col":3},"end":{"lineNumber":745,"utf16Col":80}},"extentUtf16":{"start":{"lineNumber":745,"utf16Col":0},"end":{"lineNumber":761,"utf16Col":0}}},{"name":" IMPORTANT SECTION","kind":"section_1","identStart":25472,"identEnd":25490,"extentStart":25471,"extentEnd":32077,"fullyQualifiedName":" IMPORTANT SECTION","identUtf16":{"start":{"lineNumber":761,"utf16Col":1},"end":{"lineNumber":761,"utf16Col":19}},"extentUtf16":{"start":{"lineNumber":761,"utf16Col":0},"end":{"lineNumber":943,"utf16Col":0}}},{"name":" AUTHENTICATION","kind":"section_2","identStart":25497,"identEnd":25512,"extentStart":25495,"extentEnd":25600,"fullyQualifiedName":" AUTHENTICATION","identUtf16":{"start":{"lineNumber":763,"utf16Col":2},"end":{"lineNumber":763,"utf16Col":17}},"extentUtf16":{"start":{"lineNumber":763,"utf16Col":0},"end":{"lineNumber":766,"utf16Col":0}}},{"name":" JWT TOKEN AUTHENTICATION","kind":"section_2","identStart":25602,"identEnd":25627,"extentStart":25600,"extentEnd":31595,"fullyQualifiedName":" JWT TOKEN AUTHENTICATION","identUtf16":{"start":{"lineNumber":766,"utf16Col":2},"end":{"lineNumber":766,"utf16Col":27}},"extentUtf16":{"start":{"lineNumber":766,"utf16Col":0},"end":{"lineNumber":921,"utf16Col":0}}},{"name":" How it's used","kind":"section_4","identStart":25803,"identEnd":25817,"extentStart":25799,"extentEnd":26450,"fullyQualifiedName":" How it's used","identUtf16":{"start":{"lineNumber":769,"utf16Col":4},"end":{"lineNumber":769,"utf16Col":18}},"extentUtf16":{"start":{"lineNumber":769,"utf16Col":0},"end":{"lineNumber":774,"utf16Col":0}}},{"name":" logging user","kind":"section_3","identStart":26453,"identEnd":26466,"extentStart":26450,"extentEnd":27202,"fullyQualifiedName":" logging user","identUtf16":{"start":{"lineNumber":774,"utf16Col":3},"end":{"lineNumber":774,"utf16Col":16}},"extentUtf16":{"start":{"lineNumber":774,"utf16Col":0},"end":{"lineNumber":802,"utf16Col":0}}},{"name":" implementing oauth2","kind":"section_3","identStart":27205,"identEnd":27225,"extentStart":27202,"extentEnd":28090,"fullyQualifiedName":" implementing oauth2","identUtf16":{"start":{"lineNumber":802,"utf16Col":3},"end":{"lineNumber":802,"utf16Col":23}},"extentUtf16":{"start":{"lineNumber":802,"utf16Col":0},"end":{"lineNumber":836,"utf16Col":0}}},{"name":" update to login route due to OAUTH2","kind":"section_3","identStart":28093,"identEnd":28129,"extentStart":28090,"extentEnd":29398,"fullyQualifiedName":" update to login route due to OAUTH2","identUtf16":{"start":{"lineNumber":836,"utf16Col":3},"end":{"lineNumber":836,"utf16Col":39}},"extentUtf16":{"start":{"lineNumber":836,"utf16Col":0},"end":{"lineNumber":864,"utf16Col":0}}},{"name":" verifying the token (its not tampered with and not expired)","kind":"section_3","identStart":29401,"identEnd":29461,"extentStart":29398,"extentEnd":31354,"fullyQualifiedName":" verifying the token (its not tampered with and not expired)","identUtf16":{"start":{"lineNumber":864,"utf16Col":3},"end":{"lineNumber":864,"utf16Col":63}},"extentUtf16":{"start":{"lineNumber":864,"utf16Col":0},"end":{"lineNumber":917,"utf16Col":0}}},{"name":" testing","kind":"section_3","identStart":31357,"identEnd":31365,"extentStart":31354,"extentEnd":31595,"fullyQualifiedName":" testing","identUtf16":{"start":{"lineNumber":917,"utf16Col":3},"end":{"lineNumber":917,"utf16Col":11}},"extentUtf16":{"start":{"lineNumber":917,"utf16Col":0},"end":{"lineNumber":921,"utf16Col":0}}},{"name":" POSTMAN","kind":"section_2","identStart":31597,"identEnd":31605,"extentStart":31595,"extentEnd":32077,"fullyQualifiedName":" POSTMAN","identUtf16":{"start":{"lineNumber":921,"utf16Col":2},"end":{"lineNumber":921,"utf16Col":10}},"extentUtf16":{"start":{"lineNumber":921,"utf16Col":0},"end":{"lineNumber":943,"utf16Col":0}}},{"name":" environment","kind":"section_3","identStart":31613,"identEnd":31625,"extentStart":31610,"extentEnd":31776,"fullyQualifiedName":" environment","identUtf16":{"start":{"lineNumber":923,"utf16Col":3},"end":{"lineNumber":923,"utf16Col":15}},"extentUtf16":{"start":{"lineNumber":923,"utf16Col":0},"end":{"lineNumber":928,"utf16Col":0}}},{"name":" env variables/access_token","kind":"section_3","identStart":31779,"identEnd":31806,"extentStart":31776,"extentEnd":32077,"fullyQualifiedName":" env variables/access_token","identUtf16":{"start":{"lineNumber":928,"utf16Col":3},"end":{"lineNumber":928,"utf16Col":30}},"extentUtf16":{"start":{"lineNumber":928,"utf16Col":0},"end":{"lineNumber":943,"utf16Col":0}}},{"name":" RELATIONSHIPS","kind":"section_1","identStart":32078,"identEnd":32092,"extentStart":32077,"extentEnd":35550,"fullyQualifiedName":" RELATIONSHIPS","identUtf16":{"start":{"lineNumber":943,"utf16Col":1},"end":{"lineNumber":943,"utf16Col":15}},"extentUtf16":{"start":{"lineNumber":943,"utf16Col":0},"end":{"lineNumber":1017,"utf16Col":0}}},{"name":" QUERY PARAMETERS","kind":"section_1","identStart":35551,"identEnd":35568,"extentStart":35550,"extentEnd":37498,"fullyQualifiedName":" QUERY PARAMETERS","identUtf16":{"start":{"lineNumber":1017,"utf16Col":1},"end":{"lineNumber":1017,"utf16Col":18}},"extentUtf16":{"start":{"lineNumber":1017,"utf16Col":0},"end":{"lineNumber":1063,"utf16Col":0}}},{"name":" LIMIT","kind":"section_3","identStart":35755,"identEnd":35761,"extentStart":35752,"extentEnd":36219,"fullyQualifiedName":" LIMIT","identUtf16":{"start":{"lineNumber":1022,"utf16Col":3},"end":{"lineNumber":1022,"utf16Col":9}},"extentUtf16":{"start":{"lineNumber":1022,"utf16Col":0},"end":{"lineNumber":1033,"utf16Col":0}}},{"name":" SKIP/OFFSET","kind":"section_3","identStart":36222,"identEnd":36234,"extentStart":36219,"extentEnd":36850,"fullyQualifiedName":" SKIP/OFFSET","identUtf16":{"start":{"lineNumber":1033,"utf16Col":3},"end":{"lineNumber":1033,"utf16Col":15}},"extentUtf16":{"start":{"lineNumber":1033,"utf16Col":0},"end":{"lineNumber":1046,"utf16Col":0}}},{"name":" search","kind":"section_3","identStart":36853,"identEnd":36860,"extentStart":36850,"extentEnd":37332,"fullyQualifiedName":" search","identUtf16":{"start":{"lineNumber":1046,"utf16Col":3},"end":{"lineNumber":1046,"utf16Col":10}},"extentUtf16":{"start":{"lineNumber":1046,"utf16Col":0},"end":{"lineNumber":1058,"utf16Col":0}}},{"name":" using spaces in search","kind":"section_3","identStart":37335,"identEnd":37358,"extentStart":37332,"extentEnd":37498,"fullyQualifiedName":" using spaces in search","identUtf16":{"start":{"lineNumber":1058,"utf16Col":3},"end":{"lineNumber":1058,"utf16Col":26}},"extentUtf16":{"start":{"lineNumber":1058,"utf16Col":0},"end":{"lineNumber":1063,"utf16Col":0}}},{"name":" VOTING SYSTEM","kind":"section_1","identStart":37499,"identEnd":37513,"extentStart":37498,"extentEnd":40012,"fullyQualifiedName":" VOTING SYSTEM","identUtf16":{"start":{"lineNumber":1063,"utf16Col":1},"end":{"lineNumber":1063,"utf16Col":15}},"extentUtf16":{"start":{"lineNumber":1063,"utf16Col":0},"end":{"lineNumber":1125,"utf16Col":0}}},{"name":" Composite Keys","kind":"section_3","identStart":37796,"identEnd":37811,"extentStart":37793,"extentEnd":40012,"fullyQualifiedName":" Composite Keys","identUtf16":{"start":{"lineNumber":1071,"utf16Col":3},"end":{"lineNumber":1071,"utf16Col":18}},"extentUtf16":{"start":{"lineNumber":1071,"utf16Col":0},"end":{"lineNumber":1125,"utf16Col":0}}},{"name":" JOINS","kind":"section_1","identStart":40013,"identEnd":40019,"extentStart":40012,"extentEnd":41701,"fullyQualifiedName":" JOINS","identUtf16":{"start":{"lineNumber":1125,"utf16Col":1},"end":{"lineNumber":1125,"utf16Col":7}},"extentUtf16":{"start":{"lineNumber":1125,"utf16Col":0},"end":{"lineNumber":1163,"utf16Col":0}}},{"name":" counting in the route","kind":"section_3","identStart":41084,"identEnd":41106,"extentStart":41081,"extentEnd":41701,"fullyQualifiedName":" counting in the route","identUtf16":{"start":{"lineNumber":1146,"utf16Col":3},"end":{"lineNumber":1146,"utf16Col":25}},"extentUtf16":{"start":{"lineNumber":1146,"utf16Col":0},"end":{"lineNumber":1163,"utf16Col":0}}},{"name":" migrations with alembic","kind":"section_1","identStart":41702,"identEnd":41726,"extentStart":41701,"extentEnd":42348,"fullyQualifiedName":" migrations with alembic","identUtf16":{"start":{"lineNumber":1163,"utf16Col":1},"end":{"lineNumber":1163,"utf16Col":25}},"extentUtf16":{"start":{"lineNumber":1163,"utf16Col":0},"end":{"lineNumber":1186,"utf16Col":0}}},{"name":" CORS","kind":"section_1","identStart":42349,"identEnd":42354,"extentStart":42348,"extentEnd":43579,"fullyQualifiedName":" CORS","identUtf16":{"start":{"lineNumber":1186,"utf16Col":1},"end":{"lineNumber":1186,"utf16Col":6}},"extentUtf16":{"start":{"lineNumber":1186,"utf16Col":0},"end":{"lineNumber":1216,"utf16Col":0}}},{"name":" DEPLOYING THE API","kind":"section_1","identStart":43580,"identEnd":43598,"extentStart":43579,"extentEnd":44197,"fullyQualifiedName":" DEPLOYING THE API","identUtf16":{"start":{"lineNumber":1216,"utf16Col":1},"end":{"lineNumber":1216,"utf16Col":19}},"extentUtf16":{"start":{"lineNumber":1216,"utf16Col":0},"end":{"lineNumber":1231,"utf16Col":0}}},{"name":" DOCKERIZING OUR API","kind":"section_1","identStart":44198,"identEnd":44218,"extentStart":44197,"extentEnd":48582,"fullyQualifiedName":" DOCKERIZING OUR API","identUtf16":{"start":{"lineNumber":1231,"utf16Col":1},"end":{"lineNumber":1231,"utf16Col":21}},"extentUtf16":{"start":{"lineNumber":1231,"utf16Col":0},"end":{"lineNumber":1390,"utf16Col":0}}},{"name":" BUILDING THE IMAGE","kind":"section_2","identStart":45235,"identEnd":45254,"extentStart":45233,"extentEnd":48582,"fullyQualifiedName":" BUILDING THE IMAGE","identUtf16":{"start":{"lineNumber":1260,"utf16Col":2},"end":{"lineNumber":1260,"utf16Col":21}},"extentUtf16":{"start":{"lineNumber":1260,"utf16Col":0},"end":{"lineNumber":1390,"utf16Col":0}}},{"name":" docker compose | CONTAINERS","kind":"section_3","identStart":45460,"identEnd":45488,"extentStart":45457,"extentEnd":47100,"fullyQualifiedName":" docker compose | CONTAINERS","identUtf16":{"start":{"lineNumber":1274,"utf16Col":3},"end":{"lineNumber":1274,"utf16Col":31}},"extentUtf16":{"start":{"lineNumber":1274,"utf16Col":0},"end":{"lineNumber":1339,"utf16Col":0}}},{"name":" DATABASE SETUP IN A CONTAINER","kind":"section_3","identStart":47103,"identEnd":47133,"extentStart":47100,"extentEnd":48582,"fullyQualifiedName":" DATABASE SETUP IN A CONTAINER","identUtf16":{"start":{"lineNumber":1339,"utf16Col":3},"end":{"lineNumber":1339,"utf16Col":33}},"extentUtf16":{"start":{"lineNumber":1339,"utf16Col":0},"end":{"lineNumber":1390,"utf16Col":0}}},{"name":" REPOSITORY FOR IMAGES","kind":"section_1","identStart":48583,"identEnd":48605,"extentStart":48582,"extentEnd":48965,"fullyQualifiedName":" REPOSITORY FOR IMAGES","identUtf16":{"start":{"lineNumber":1390,"utf16Col":1},"end":{"lineNumber":1390,"utf16Col":23}},"extentUtf16":{"start":{"lineNumber":1390,"utf16Col":0},"end":{"lineNumber":1411,"utf16Col":0}}}]}},"copilotInfo":null,"copilotAccessAllowed":false,"csrf_tokens":{"/mankindjnr/markdown-blog/branches":{"post":"j71nDwH3AgmkwCXK9gY8RpO1sotKsTWB3MIY9DQU2zcEXeQ9Fp7d4ymPoie4rP8FhmYrQPfP_pAwLJOKwVGEmQ"},"/repos/preferences":{"post":"m9z9RlNkVhOJY2kV_u-HeYpuykGH8FC6eDpnOF-FQc0iKkdnSKwD007XctgzV2RckNkZkwtZcRBSbXq3lMAaGQ"}}},"title":"markdown-blog/fastapi.md at main  mankindjnr/markdown-blog"}